<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title><![CDATA[ä¸€æœµè¥¿å…°èŠ±]]></title>
    <link>http://broccolii.github.io/</link>
    <atom:link href="/rss2.xml" rel="self" type="application/rss+xml"/>
    <description><![CDATA[ä¸æ±‚æ·±åˆ»,ä½†æ±‚ç®€å•.]]></description>
    <pubDate>Thu, 17 Mar 2016 06:25:50 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title><![CDATA[Core Data, FMDB, Realm æ€§èƒ½å¯¹æ¯”]]></title>
      <link>http://broccolii.github.io/2016/03/16/iOS_database/</link>
      <guid>http://broccolii.github.io/2016/03/16/iOS_database/</guid>
      <pubDate>Tue, 15 Mar 2016 18:26:52 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>iOS æŒä¹…åŒ–å…¶å®ä¹Ÿæ²¡å¤šå°‘é€‰æ‹©.é¢è¯•é¢˜ç»å¸¸ä¼šè¢«é—®åˆ°, ä½†æ˜¯æ— éä¹Ÿå°±ä¸‹é¢å‡ ç§:æ–‡ä»¶å†™å…¥æ²™ç›’, <code>]]>
      </description>
      <content:encoded><![CDATA[<h3 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>iOS æŒä¹…åŒ–å…¶å®ä¹Ÿæ²¡å¤šå°‘é€‰æ‹©.é¢è¯•é¢˜ç»å¸¸ä¼šè¢«é—®åˆ°, ä½†æ˜¯æ— éä¹Ÿå°±ä¸‹é¢å‡ ç§:æ–‡ä»¶å†™å…¥æ²™ç›’, <code>NSUserDefaults</code>, <code>NSKeyedArchiver</code>(å½’æ¡£), <code>SQLite 3</code>, åŸºäº <code>SQLite</code> çš„ä¸€äº›æ•°æ®åº“å°è£…. æœ€è¿‘å·¥ä½œéœ€è¦è¯„ä¼°ä¸€ä¸‹ iOS å¸¸ç”¨çš„å‡ ç§æ•°æ®åº“çš„æ€§èƒ½, æ‰€ä»¥æœ‰äº†è¿™ç¯‡æ–‡ç« .</p>
<h3 id="u4ECB_u7ECD"><a href="#u4ECB_u7ECD" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p><strong>FMDB</strong><br>ç›´æ¥åœ¨ iOS ä¸­ä½¿ç”¨åŸç”Ÿçš„ SQLite API æ—¶, éœ€è¦ä½¿ç”¨å¤§é‡çš„ C è¯­è¨€.è¿™æ ·ä½“éªŒå¹¶ä¸å‹å¥½,æ‰€ä»¥å‡ºç°äº† <a href="https://github.com/ccgus/fmdb" target="_blank" rel="external">FMDB</a> è¿™æ ·ä½¿ç”¨ <code>Objective-C</code> å°è£…çš„ SQLite API çš„æ•°æ®åº“æ¡†æ¶. è¿™æ ·ä½¿ <code>SQLite</code> æ“ä½œæ›´ç®€å•æ˜“æ‡‚.å¹¶ä¸”å®ƒå¯¹äºå¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œè¿›è¡Œäº†å¤„ç†,æ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„.</p>
<p><strong>Realm</strong><br><a href="https://realm.io/cn/" target="_blank" rel="external">Realm</a> æ˜¯ç”± <code>Y Combinator</code> å…¬å¸å­µåŒ–çš„ä¸€æ¬¾æ”¯æŒè¿è¡Œåœ¨æ‰‹æœºã€å¹³æ¿å’Œå¯ç©¿æˆ´è®¾å¤‡ä¸Šçš„åµŒå…¥å¼æ•°æ®åº“(æ—¨åœ¨å–ä»£CoreDataå’ŒSqlite). Realmå¹¶ä¸æ˜¯åŸºäºCore Data,ä¹Ÿä¸æ˜¯åŸºäº SQLite æ‰€æ„å»º ORM çš„.å®ƒæ‹¥æœ‰è‡ªå·±çš„æ•°æ®åº“å­˜å‚¨å¼•æ“,å¯ä»¥é«˜æ•ˆä¸”å¿«é€Ÿåœ°å®Œæˆæ•°æ®åº“çš„æ„å»ºæ“ä½œã€‚ Realm æ”¯æŒiOSã€OS Xï¼ˆObjectiveâ€‘Cå’ŒSwiftï¼‰ä»¥åŠAndroid.Realmæ–‡ä»¶å¯ä»¥è·¨å¹³å°å…±äº«.Realm è¿˜æä¾›äº†<a href="https://realm.io/cn/docs/objc/latest/" target="_blank" rel="external">ä¸­æ–‡æ–‡æ¡£</a>.</p>
<p><strong>Core Data</strong><br><code>Core Data</code> æ˜¯ä¸€ä¸ªæ¨¡å‹å±‚çš„æŠ€æœ¯. Core Data æœ¬èº«æ—¢ä¸æ˜¯æ•°æ®åº“ä¹Ÿä¸æ˜¯æ•°æ®åº“è®¿é—®æ¡†æ¶.ç›¸å,Core Dataæ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•°æ®æ¨¡å‹è§£å†³æ–¹æ¡ˆ.æˆ‘ç®€å•ç†è§£ä¸ºå¯¹æŒä¹…å±‚çš„å°è£…ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯è§†åŒ–å»ºç«‹æ•°æ®æ¨¡å‹,ç®€åŒ–æ•°æ®å­˜å–. Core Dataä¸æ˜¯ä¸€ä¸ª O/RM, ä¹Ÿä¸åƒ FMDB æ˜¯ä¸€ä¸ª SQL wrapper.</p>
<h3 id="u4F7F_u7528_u65B9_u6CD5"><a href="#u4F7F_u7528_u65B9_u6CD5" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><h4 id="FMDB"><a href="#FMDB" class="headerlink" title="FMDB"></a>FMDB</h4><p><strong>é›†æˆ</strong>:æ¨èä½¿ç”¨Cocoapodsè¿›è¡Œå®‰è£…ï¼Œåœ¨Podfileä¸­æ·»åŠ pod â€˜FMDBâ€™å³å¯.</p>
<p>FMDBæœ‰ä¸‰ä¸ªä¸»è¦çš„ç±»</p>
<ul>
<li>FMDatabase: FMDatabase å¯¹è±¡å°±ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„SQLiteæ•°æ®åº“,ç”¨æ¥æ‰§è¡Œ SQLite è¯­å¥.</li>
<li>FMResultSet: å­˜æ”¾ FMDatabase æ‰§è¡ŒæŸ¥è¯¢åçš„ç»“æœé›†.</li>
<li>FMDatabaseQueue: ç”¨äºåœ¨å¤šçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢æˆ–æ›´æ–°ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„.</li>
</ul>
<p><strong>åˆ›å»º</strong>: create database: åœ¨æ²™ç›’å†…åˆ›å»ºä¸€ä¸ª <code>FMDBModel.sqlite</code> æ–‡ä»¶.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSString* dbPath = [[NSString <span class="string">stringWithFormat:</span>@<span class="string">"%@"</span>, [[NSFileManager defaultManager] <span class="string">URLForDirectory:</span>NSDocumentDirectory <span class="string">inDomain:</span>NSUserDomainMask <span class="string">appropriateForURL:</span>nil <span class="string">create:</span>YES <span class="string">error:</span>nil]] <span class="string">stringByAppendingPathComponent:</span>@<span class="string">"FMDBModel.sqlite"</span>];</span><br><span class="line"></span><br><span class="line">FMDatabase* database = [[FMDatabase alloc] <span class="string">initWithPath:</span>dbPath];</span><br></pre></td></tr></table></figure>
<p><code>dbPath</code> çš„è·¯å¾„æœ‰ä¸‰ç§æƒ…å†µ:</p>
<ol>
<li>å…·ä½“æ–‡ä»¶è·¯å¾„: å¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º.</li>
<li>@â€â€: ä¼šåœ¨ä¸´æ—¶ç›®å½•åˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®åº“,å½“ FMDatabase è¿æ¥å…³é—­æ—¶,æ•°æ®åº“è¢«åˆ é™¤.</li>
<li>nil: ä¼šåˆ›å»ºä¸€ä¸ªå†…å­˜ä¸­ä¸´æ—¶æ•°æ®åº“ï¼Œå½“ FMDatabase è¿æ¥å…³é—­æ—¶,æ•°æ®åº“ä¼šè¢«é”€æ¯.</li>
</ol>
<p><strong>æŸ¥</strong>: æŸ¥è¯¢ ID &lt; 1000 çš„æ‰€æœ‰æ•°æ®</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FMResultSet *resultSet = [db <span class="string">executeQuery:</span>[NSString <span class="string">stringWithFormat:</span>@<span class="string">"SELECT * FROM t_messageModel WHERE ID &lt; 1000"</span>]];</span><br></pre></td></tr></table></figure>
<p><strong>å¢</strong>,<strong>åˆ </strong>,<strong>æ”¹</strong> : é™¤äº† <code>executeQuery(æŸ¥è¯¢)</code> å¤–æ‰€æœ‰æ“ä½œéƒ½æ˜¯ <code>executeUpdate(æ›´æ–°)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[db executeUpdate: @"<span class="operator"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_messageModel (sender_id, msg_type, sender_avatar, sender_nickname, msg_id, <span class="keyword">content</span>, operate_time, create_time, conversation_id) <span class="keyword">VALUES</span> (?,?,?,?,?,?,?,?,?)<span class="string">"</span></span></span><br></pre></td></tr></table></figure>
<p>SQLite æœ¬èº«æ”¯æŒäº‹åŠ¡å¤„ç†, FMDBä½œä¸ºsqliteçš„ä¸Šå±‚å°è£…ä¹Ÿå¯¹äº‹åŠ¡è¿›è¡Œäº†æ”¯æŒ.</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">[<span class="keyword">db</span> open]<span class="comment">;</span></span><br><span class="line"><span class="list">[<span class="keyword">db</span> beginTransaction]<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line">BOOL isRollBack = NO<span class="comment">;</span></span><br><span class="line">@try &#123;</span><br><span class="line">   for <span class="list">(<span class="keyword">FMDBMessageModel</span> *model in array)</span> &#123;</span><br><span class="line">       BOOL isInsertSucceed = <span class="list">[<span class="keyword">db</span> executeUpdate:@<span class="string">"INSERT INTO t_messageModel (sender_id, msg_type, sender_avatar, sender_nickname, msg_id, content, operate_time, create_time, conversation_id) VALUES (?,?,?,?,?,?,?,?,?)"</span>,</span><br><span class="line">                               model.sender_id,</span><br><span class="line">                               model.msg_type,</span><br><span class="line">                               model.sender_avatar,</span><br><span class="line">                               model.sender_nickname,</span><br><span class="line">                               @<span class="list">(<span class="keyword">model.msg_id</span>)</span>,</span><br><span class="line">                               model.content,</span><br><span class="line">                               @<span class="list">(<span class="keyword">model.operate_time</span>)</span>,</span><br><span class="line">                               @<span class="list">(<span class="keyword">model.create_time</span>)</span>,</span><br><span class="line">                               model.conversation_id]<span class="comment">;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">@catch <span class="list">(<span class="keyword">NSException</span> *exception)</span> &#123;</span><br><span class="line">   isRollBack = YES<span class="comment">;</span></span><br><span class="line">   <span class="list">[<span class="keyword">db</span> rollback]<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">@finally &#123;</span><br><span class="line">   if <span class="list">(<span class="keyword">!isRollBack</span>)</span> &#123;</span><br><span class="line">       <span class="list">[<span class="keyword">db</span> commit]<span class="comment">;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="list">[<span class="keyword">db</span> close]<span class="comment">;</span></span></span></span></span></span></span></span><br></pre></td></tr></table></figure>
<h4 id="Realm"><a href="#Realm" class="headerlink" title="Realm"></a>Realm</h4><p><a href="https://realm.io/cn/docs/objc/latest/#section" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a><br><strong>é›†æˆ</strong>: æ¨èä½¿ç”¨Cocoapodsè¿›è¡Œå®‰è£…ï¼Œåœ¨Podfileä¸­æ·»åŠ pod â€˜Realmâ€™ å³å¯.<br><strong>è¾…åŠ©å·¥å…·</strong><br>1ã€Realm Browser<br>Realmå®˜æ–¹éå¸¸è´´å¿ƒçš„å‘å¼€å‘è€…æä¾›äº†ä¸€ä¸ªç”¨äºæŸ¥çœ‹å’Œç¼–è¾‘ Realm æ•°æ®çš„å·¥å…· Realm Browser.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_database/RealmBrowser.png" alt=""><br>2ã€Xcode Plugin<br>åœ¨Realmä¸­ä½¿ç”¨åˆ°æœ€å¤šçš„æ˜¯Realm Model(ç»§æ‰¿è‡ªRLMObjectçš„ç±»ï¼Œåé¢æœ‰ä»‹ç»)ã€‚å®˜æ–¹æä¾›äº†ä¸€ä¸ªXcodeçš„æ’ä»¶è®©æˆ‘ä»¬åœ¨åˆ›å»ºæ¨¡å‹å˜å¾—éå¸¸è½»æ¾<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_database/RealmPlugin.png" alt=""><br>ç›´æ¥é€šè¿‡ <code>Alcatraz</code>, æœç´¢ <code>RealmPlugin</code> ç›´æ¥å®‰è£….</p>
<p><strong>åˆ›å»º</strong>: å’Œ <code>FMDB</code> ä¸€æ ·,æœ‰ä¸‰ç§æ–¹å¼åˆ›å»ºæ•°æ®åº“.ä¸€ç§æ˜¯å­˜å‚¨åœ¨é»˜è®¤è·¯å¾„ä¸‹çš„æ•°æ®åº“,ä¸€ç§æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±æŒ‡å®šæ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œåªè¯»å±æ€§,å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨å†…å­˜æ•°æ®åº“.</p>
<ul>
<li>é»˜è®¤Realmæ•°æ®åº“</li>
</ul>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RLMRealm *realm = <span class="string">[RLMRealm defaultRealm]</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è‡ªå®šä¹‰Realmæ•°æ®åº“</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *docPath = [<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject];</span><br><span class="line"><span class="built_in">NSString</span> *dbPath = [docPath stringByAppendingPathComponent:<span class="string">@"db/db.realm"</span>];</span><br><span class="line">RLMRealm *realm = [RLMRealm realmWithPath:dbPath];</span><br><span class="line"><span class="comment">// æˆ–è€… åªè¯»ç±»å‹</span></span><br><span class="line">RLMRealm *realm = [RLMRealm realmWithPath:dbPath readOnly:<span class="literal">YES</span> error:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>å†…å­˜æ•°æ®åº“</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Realm *realm = [RLMRealm <span class="keyword">in</span>MemoryRealmWithIdentifier:@<span class="string">"memoryDatabase"</span>];</span><br></pre></td></tr></table></figure>
<p><strong>Model</strong><br>Realm æ•°æ®æ¨¡å‹æ˜¯åŸºäºæ ‡å‡† Objectiveâ€‘C ç±»æ¥è¿›è¡Œå®šä¹‰çš„ï¼Œä½¿ç”¨å±æ€§æ¥å®Œæˆæ¨¡å‹çš„å…·ä½“å®šä¹‰ã€‚é€šè¿‡ç®€å•çš„ç»§æ‰¿ RLMObject æˆ–è€…ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¨¡å‹ç±»ï¼Œæ‚¨å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Realm æ•°æ®æ¨¡å‹å¯¹è±¡ã€‚Realm æ¨¡å‹å¯¹è±¡åœ¨å½¢å¼ä¸ŠåŸºæœ¬ä¸Šä¸å…¶ä»– Objectiveâ€‘C å¯¹è±¡ç›¸åŒ.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸»é”®</span></span><br><span class="line">+ (<span class="built_in">NSString</span> *)primaryKey &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éœ€è¦æ·»åŠ ç´¢å¼•çš„å±æ€§</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)indexedProperties &#123;&#125;</span><br><span class="line"><span class="comment">//é»˜è®¤å±æ€§å€¼</span></span><br><span class="line">+ (<span class="built_in">NSDictionary</span> *)defaultPropertyValues &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¿½ç•¥çš„å­—æ®µ</span></span><br><span class="line">+ (<span class="built_in">NSArray</span> *)ignoredProperties &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>.m</code> æ–‡ä»¶ä¸­, Realm æä¾›äº†ä»¥ä¸Šæ–¹æ³•ä¾›å¯¹å±æ€§è¿›è¡Œè‡ªå®šä¹‰.</p>
<p><strong>æ•°æ®å¢åˆ æ”¹æŸ¥</strong><br><code>å¯¹å¯¹è±¡çš„æ‰€æœ‰æ›´æ”¹ï¼ˆæ·»åŠ ï¼Œä¿®æ”¹å’Œåˆ é™¤ï¼‰éƒ½å¿…é¡»é€šè¿‡å†™å…¥äº‹åŠ¡(transaction)å®Œæˆã€‚</code><br>1) <em>å¢</em>:</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RLMRealm *realm = <span class="string">[RLMRealm defaultRealm]</span>;</span><br><span class="line"><span class="string">[realm beginWriteTransaction]</span>;</span><br><span class="line"><span class="string">[realm addObject:model]</span>;</span><br><span class="line"><span class="string">[realm commitWriteTransaction]</span>;</span><br></pre></td></tr></table></figure>
<p>2) <em>åˆ </em></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr_selector">[realm beginWriteTransaction]</span>;</span><br><span class="line"><span class="attr_selector">[realm deleteObject:model]</span>;</span><br><span class="line"><span class="comment">// æˆ–è€… åˆ é™¤å…¨éƒ¨</span></span><br><span class="line"><span class="attr_selector">[realm deleteAllObjects]</span>;</span><br><span class="line"><span class="attr_selector">[realm commitWriteTransaction]</span>;</span><br></pre></td></tr></table></figure>
<p>3) <em>æ”¹</em><br>Realm æä¾›äº†ä¸€ç³»åˆ—ç”¨ä»¥æ›´æ–°æ•°æ®çš„æ–¹å¼ï¼Œè¿™äº›æ–¹å¼éƒ½æœ‰ç€å„è‡ªæ‰€é€‚åº”çš„æƒ…æ™¯ã€‚è¯·é€‰æ‹©æœ€ç¬¦åˆæ‚¨å½“å‰éœ€æ±‚çš„æ–¹å¼æ¥ä½¿ç”¨ï¼š</p>
<p>3.1 å†…å®¹ç›´æ¥æ›´æ–°<br>æ‚¨å¯ä»¥åœ¨å†™å…¥äº‹åŠ¡ä¸­é€šè¿‡è®¾ç½®æŸä¸ªå¯¹è±¡çš„å±æ€§ä»è€Œå®Œæˆå¯¹è±¡çš„æ›´æ–°æ“ä½œã€‚</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[realm beginWriteTransaction]</span>;</span><br><span class="line">model.name = @<span class="string">"broccoliii"</span>;</span><br><span class="line"><span class="string">[realm commitWriteTransaction]</span>;</span><br></pre></td></tr></table></figure>
<p>3.2 é€šè¿‡ä¸»é”®æ›´æ–°<br>å¦‚æœæ‚¨çš„æ•°æ®æ¨¡å‹ä¸­è®¾ç½®äº†ä¸»é”®çš„è¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨ <code>+[RLMObject createOrUpdateInRealm:withValue:]</code> æ¥æ›´æ–°å¯¹è±¡ï¼Œæˆ–è€…å½“å¯¹è±¡ä¸å­˜åœ¨æ—¶æ’å…¥æ–°çš„å¯¹è±¡ã€‚</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[realm beginWriteTransaction]</span><span class="comment">;</span></span><br><span class="line"><span class="title">[Model createOrUpdateInRealm:realm withValue:model]</span><span class="comment">;</span></span><br><span class="line"><span class="title">[realm commitWriteTransaction]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>3.3 é€šè¿‡ <code>KVC</code> æ›´æ–°</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RLMResults *models = [RealmMessageModel <span class="literal">all</span>Objects];</span><br><span class="line">[<span class="literal">self</span>.mananger transactionWithBlock:^&#123;</span><br><span class="line">   [models <span class="built_in">set</span>Value:@<span class="string">"broccoliii"</span> <span class="keyword">for</span>KeyPath:@<span class="string">"nickname"</span>];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>4) <em>æŸ¥</em></p>
<p>4.1 æŸ¥è¯¢å…¨éƒ¨æ•°æ®</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">RLMResults *models</span> = [RealmModel allObjects];</span><br><span class="line"><span class="comment">// æˆ–è€… æŒ‡å®šæ•°æ®åº“</span></span><br><span class="line"><span class="constant">RLMResults *models</span> = [RealmModel allObjectsInRealm:realm];</span><br></pre></td></tr></table></figure>
<p>4.2 æ¡ä»¶æŸ¥è¯¢</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RLMResults *results = [RealmModel <span class="string">objectsWhere:</span>@<span class="string">"nickname = 'broccoliii'"</span>];</span><br><span class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨è°“è¯</span></span><br><span class="line">NSPredicate *predicate = [NSPredicate <span class="string">predicateWithFormat:</span>@<span class="string">"nickname = '%@'"</span>, @<span class="string">"broccoliii"</span>];</span><br><span class="line">RLMResults *results = [RealmModel <span class="string">objectsWithPredicate:</span>predicate];</span><br></pre></td></tr></table></figure>
<p>4.3 æ¡ä»¶æ’åº<br>ç­›é€‰å‡ºæ¥çš„ç»“æœæŒ‰ç…§numå­—æ®µè¿›è¡Œé€’å¢æ’åºï¼š</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RLMResults *results = [[RealmModel <span class="string">objectsWhere:</span>@<span class="string">"nickname = 'broccoliii'"</span>] <span class="string">sortedResultsUsingProperty:</span>@<span class="string">"ID"</span> <span class="string">ascending:</span>YES];</span><br></pre></td></tr></table></figure>
<p>4.4 é“¾å¼æŸ¥è¯¢<br>åœ¨ <code>nickname</code> æ˜¯ <code>broccoliii</code> çš„ç»“æœä¸­æŸ¥è¯¢ <code>age</code> ä¸º 23 çš„ç»“æœé›†.</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RLMResults <span class="keyword">*</span>nameResults = [RealmModel objectsWhere:<span class="comment">@"nickname = 'broccoliii'"];</span></span><br><span class="line">RLMResults <span class="keyword">*</span>results = [nameResults objectsWhere:<span class="comment">@"age = 23"];</span></span><br></pre></td></tr></table></figure>
<h4 id="Core_Data"><a href="#Core_Data" class="headerlink" title="Core Data"></a>Core Data</h4><p>æ–°å»ºä¸€ä¸ª Core Data å·¥ç¨‹, åœ¨ <code>Choose a template for your new progect</code> æ—¶, å‹¾é€‰ <code>Use Core Data</code>.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_database/Use_Core_Data.png" alt=""></p>
<p>é¡¹ç›®å»ºç«‹åä¼šå‘ç° Frameworks ä¸­å·²ç»æœ‰äº† CoreData.framework ä¸€é¡¹ï¼Œå¹¶ä¸”è¿˜å¤šäº†ä¸€ä¸ª<em>**</em>.xcdatamodeld æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†æ•°æ®æ¨¡å‹ç»“æ„ï¼Œä½ å¯ä»¥ä½¿ç”¨XCodeå†…ç½®çš„å¯è§†åŒ–å»ºæ¨¡å·¥å…·è¿›è¡Œæ„å»ºã€‚ç‚¹å¼€å®ƒä½ ä¼šå‘ç°å·¦ä¾§æœ‰ä¸‰é¡¹ï¼š<code>Entities</code>ï¼Œ<code>Fetch Request</code>ã€<code>Configurations</code>ã€‚<em>Entities</em>: å¯ä»¥ç®€å•çš„å°† Entity ç†è§£ä¸ºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨. ç‚¹å‡»ä¸‹æ–¹ <code>Add Entity</code> æ–°å¢ <code>Entities</code>. è¡¨ä¸­ <code>Attributes</code> ç›¸å½“äºä¸€å¼ è¡¨çš„åˆ—å±æ€§,å¯ä»¥è®¾ç½®å…¶æ•°æ®ç±»å‹ï¼Œé»˜è®¤å€¼ï¼Œæœ€å¤§æœ€å°å€¼ç­‰ï¼Œç±»ä¼¼æ•°æ®åº“å¯è§†åŒ–å»ºè¡¨. <em>Fetch Request</em> ç›¸å½“äº SQL æŸ¥è¯¢è¯­å¥çš„åŒ…è£…ç±», ç”¨ <code>NSFetchRequest</code> å°è£…ä¸€æ¬¡æ•°æ®è¯·æ±‚, é€šè¿‡ <code>Fetch Request</code> å°† <code>NSFetchRequest</code> ä½œä¸ºæ¨¡æ¿å­˜å‚¨åœ¨è¢«ç®¡ç†å¯¹è±¡æ¨¡å‹. </p>
<p>å› ä¸ºæˆ‘ä»¬åœ¨å·¥ç¨‹åˆ›å»ºæ—¶, å‹¾é€‰äº† <code>Use Core Data</code>, åœ¨ AppDelegate.h ä¸­å¤šäº†å‡ ä¸ª <code>property</code>, <code>method</code></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;CoreData/CoreData.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> : <span class="title">UIResponder</span> &lt;<span class="title">UIApplicationDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIWindow</span> *window;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSManagedObjectContext</span> *managedObjectContext;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSManagedObjectModel</span> *managedObjectModel;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSPersistentStoreCoordinator</span> *persistentStoreCoordinator;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)saveContext;</span><br><span class="line">- (<span class="built_in">NSURL</span> *)applicationDocumentsDirectory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><code>NSManagedObjectModel</code> å¯ä»¥æŠŠå®ƒçœ‹åšä¸ºä¸€ä¸ª Core Data çš„ schemaã€‚ç”Ÿæˆè¿™ä¸ªç±»çš„æ¥æºå°±æ˜¯åœ¨ xCode é‡Œçš„.xcdatamodeldæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯è§†åŒ–çš„å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå®é™…ä¸Šè¿™ä¸ªæ–‡ä»¶ä¹Ÿå°±ç›¸å½“äºæ•°æ®åº“çš„ schemaï¼Œè¿™ä¸ªæ–‡ä»¶ç¼–è¯‘åå°±æ˜¯.momdæˆ–.momæ–‡ä»¶<br><code>NSPersistentStoreCoordinator</code> æ˜¯ä¸€ä¸ªä½äºæœ¬åœ°å­˜å‚¨æ–‡ä»¶ä¸ç¼“å­˜å±‚(NSManagedObjectContext)ä¹‹é—´çš„ä¸€ä¸ªæŒä¹…åŒ–å±‚ï¼Œä»–æ˜¯çœŸå®æ“ä½œæ•°æ®åº“æœ¬åœ°æ–‡ä»¶ã€‚<br><code>NSManagedObjectContext</code> æ˜¯ä¸€ä¸ªè¢«ç®¡ç†æ•°æ®çš„ä¸Šä¸‹æ–‡ï¼Œä»–å®é™…ä¸Šæ˜¯å¯¹ä½ æ‰€æœ‰æ•°æ®åº“æ“ä½œçš„ä¸€ä¸ªç¼“å­˜å±‚ï¼ŒæŠŠä½ æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆç¼“å­˜èµ·æ¥é¿å…å¤§é‡ç£ç›˜ IO é€ æˆä¸æµç•…ï¼Œä½ åœ¨æ“ä½œå®Œæ•°æ®åº“åè°ƒç”¨å…¶saveæ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠä½ çš„æ•°æ®åº“æ“ä½œæäº¤ç»™æŒä¹…åŒ–å±‚(NSPersistentStoreCoordinator)ï¼Œç”±æŒä¹…åŒ–å±‚ä¸€æ¬¡æ€§å†™å…¥æ•°æ®åº“æ–‡ä»¶ã€‚</p>
<p><strong>NSManagedObjectContext åˆ›å»º</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)configureContext &#123;</span><br><span class="line">    _context = [[<span class="built_in">NSManagedObjectContext</span> alloc] initWithConcurrencyType:<span class="built_in">NSPrivateQueueConcurrencyType</span>];</span><br><span class="line">    <span class="built_in">NSPersistentStoreCoordinator</span> *store = [[<span class="built_in">NSPersistentStoreCoordinator</span> alloc] initWithManagedObjectModel:[<span class="built_in">NSManagedObjectModel</span> mergedModelFromBundles:<span class="literal">nil</span>]];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *sqlitePath = [[<span class="built_in">NSSearchPathForDirectoriesInDomains</span>(<span class="built_in">NSDocumentDirectory</span>, <span class="built_in">NSUserDomainMask</span>, <span class="literal">YES</span>) lastObject] stringByAppendingPathComponent:<span class="string">@"t_CoreDataMessageModel.sqlite"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    </span><br><span class="line">    [store addPersistentStoreWithType:<span class="built_in">NSSQLiteStoreType</span> configuration:<span class="literal">nil</span> URL:[<span class="built_in">NSURL</span> fileURLWithPath:sqlitePath] options:<span class="literal">nil</span> error:&amp;error];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,error);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _context<span class="variable">.persistentStoreCoordinator</span> = store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ•°æ®å¢åˆ æ”¹æŸ¥</strong><br>1) <em>å¢</em></p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">- (void)insert:(CoreDataMessageModel *)model &#123;</span><br><span class="line">    CoreDataMessageModel *message = [NSEntityDescription insertNewObjectForEntityForName:@"CoreDataMessageModel" inManagedObjectContext:_context];</span><br><span class="line">    </span><br><span class="line">    message<span class="string">.sender_id</span> = model<span class="string">.sender_id</span>;</span><br><span class="line">    message<span class="string">.msg_type</span> = model<span class="string">.msg_type</span>;</span><br><span class="line">    message<span class="string">.sender_avatar</span> = model<span class="string">.sender_avatar</span>;</span><br><span class="line">    message<span class="string">.sender_nickname</span> = model<span class="string">.sender_nickname</span>;</span><br><span class="line">    message<span class="string">.msg_id</span> = model<span class="string">.msg_id</span>;</span><br><span class="line">    message<span class="string">.content</span> = model<span class="string">.content</span>;</span><br><span class="line">    message<span class="string">.operate_time</span> = model<span class="string">.operate_time</span>;</span><br><span class="line">    message<span class="string">.create_time</span> = model<span class="string">.create_time</span>;</span><br><span class="line">    message<span class="string">.conversation_id</span> = model<span class="string">.conversation_id</span>;</span><br><span class="line">    </span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    [_context save:&amp;error];</span><br><span class="line">    </span><br><span class="line">    if (error) &#123;</span><br><span class="line">        NSLog(@"%@",error);</span><br><span class="line">    &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2) <em>åˆ </em></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="typename">void</span>)deleteMultiple &#123;</span><br><span class="line">    NSFetchRequest *request = [NSFetchRequest <span class="string">fetchRequestWithEntityName:</span>@<span class="string">"CoreDataMessageModel"</span>];</span><br><span class="line">    </span><br><span class="line">    request.predicate = [NSPredicate <span class="string">predicateWithFormat:</span>@<span class="string">"msg_id &gt; %@"</span>,@<span class="string">"0"</span>];</span><br><span class="line">    </span><br><span class="line">    NSArray *resultSet =  [_context <span class="string">executeFetchRequest:</span>request <span class="string">error:</span>nil];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (CoreDataMessageModel *message <span class="keyword">in</span> resultSet) &#123;</span><br><span class="line">        [_context <span class="string">deleteObject:</span>message];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [_context <span class="string">save:</span>nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3) <em>æ”¹</em><br>æ”¹å•æ¡æ•°æ®</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">- (void)updateSingle:(CoreDataMessageModel *)model &#123;</span><br><span class="line">    NSFetchRequest *request = [NSFetchRequest fetchRequestWithEntityName:@"CoreDataMessageModel"];</span><br><span class="line">    request<span class="string">.predicate</span> = [NSPredicate predicateWithFormat:@"msg_id = %@",model<span class="string">.msg_id]</span>;</span><br><span class="line">    </span><br><span class="line">    NSArray *resultSet = [_context executeFetchRequest:request error:nil];</span><br><span class="line">    </span><br><span class="line">    for (CoreDataMessageModel *message in resultSet) &#123;</span><br><span class="line">        message<span class="string">.sender_id</span> = model<span class="string">.sender_id</span>;</span><br><span class="line">        message<span class="string">.msg_type</span> = model<span class="string">.msg_type</span>;</span><br><span class="line">        message<span class="string">.sender_avatar</span> = model<span class="string">.sender_avatar</span>;</span><br><span class="line">        message<span class="string">.sender_nickname</span> = model<span class="string">.sender_nickname</span>;</span><br><span class="line">        message<span class="string">.msg_id</span> = model<span class="string">.msg_id</span>;</span><br><span class="line">        message<span class="string">.content</span> = model<span class="string">.content</span>;</span><br><span class="line">        message<span class="string">.operate_time</span> = model<span class="string">.operate_time</span>;</span><br><span class="line">        message<span class="string">.create_time</span> = model<span class="string">.create_time</span>;</span><br><span class="line">        message<span class="string">.conversation_id</span> = model<span class="string">.conversation_id</span>;</span><br><span class="line">    &#125;</span></span><br><span class="line">    </span><br><span class="line">    [_context save:nil];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ”¹å¤šæ¡æ•°æ®</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)updateMultiple &#123;</span><br><span class="line">    <span class="built_in">NSBatchUpdateRequest</span> *batchUpdate = [<span class="built_in">NSBatchUpdateRequest</span> batchUpdateRequestWithEntityName:<span class="string">@"CoreDataMessageModel"</span>];</span><br><span class="line">    </span><br><span class="line">    batchUpdate<span class="variable">.propertiesToUpdate</span> = @&#123;<span class="string">@"sender_nickname"</span> : <span class="string">@"broccoliii"</span>&#125;;</span><br><span class="line">    batchUpdate<span class="variable">.affectedStores</span> = _context<span class="variable">.persistentStoreCoordinator</span><span class="variable">.persistentStores</span>;</span><br><span class="line"></span><br><span class="line">    batchUpdate<span class="variable">.resultType</span> = <span class="built_in">NSUpdatedObjectsCountResultType</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">@try</span> &#123;</span><br><span class="line">        [_context executeRequest:batchUpdate error:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *exception) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Core Data æ‰¹é‡æ›´æ–°å‡ºé”™: exception %@"</span>, exception);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">@finally</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4) <em>æŸ¥</em></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSArray</span> *)selectSingle &#123;</span><br><span class="line">    <span class="built_in">NSFetchRequest</span> *request = [<span class="built_in">NSFetchRequest</span> fetchRequestWithEntityName:<span class="string">@"CoreDataMessageModel"</span>];</span><br><span class="line">    </span><br><span class="line">    request<span class="variable">.predicate</span> = [<span class="built_in">NSPredicate</span> predicateWithFormat:<span class="string">@"msg_id &lt; %@"</span>,<span class="string">@"10000"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [_context executeFetchRequest:request error:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u6027_u80FD_u6BD4_u8F83"><a href="#u6027_u80FD_u6BD4_u8F83" class="headerlink" title="æ€§èƒ½æ¯”è¾ƒ"></a>æ€§èƒ½æ¯”è¾ƒ</h3><p>æµ‹è¯•æœº: iPhone 6 iOS ç³»ç»Ÿç‰ˆæœ¬: 9.2.1<br>å¾ªç¯æ’å…¥10000æ¬¡ï¼Œæ¯æ¬¡æ’å…¥ä¸€æ¡æ•°æ®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		<span class="number">121634</span> ms;</span><br><span class="line">Realm         		<span class="number">58925</span> ms;</span><br><span class="line">CoreData        	<span class="number">74987</span> ms;</span><br></pre></td></tr></table></figure>
<p>æ‰¹é‡æ’å…¥10000æ¡æ•°æ®ï¼š</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		410 ms<span class="comment">;</span></span><br><span class="line">Realm         		457 ms<span class="comment">;</span></span><br><span class="line">CoreData        	ä¸æ”¯æŒæ‰¹é‡æ“ä½œ<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>å¾ªç¯æ›´æ–°10000æ¬¡ï¼Œæ¯æ¬¡æ›´æ–°ä¸€æ¡æ•°æ®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		<span class="number">5869</span> ms;</span><br><span class="line">Realm         		<span class="number">44761</span> ms;</span><br><span class="line">CoreData        	<span class="number">86231</span> ms;</span><br></pre></td></tr></table></figure>
<p>æ‰¹é‡æ›´æ–°10000æ¡æ•°æ®ä¸ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		<span class="number">48</span> ms;</span><br><span class="line">Realm         		<span class="number">60</span> ms;</span><br><span class="line">CoreData        	<span class="number">90</span> ms;</span><br></pre></td></tr></table></figure>
<p>å¾ªç¯æŸ¥è¯¢10000æ¡æ•°æ®ï¼Œæ¯æ¬¡æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		<span class="number">461</span> ms;</span><br><span class="line">Realm         		<span class="number">547</span> ms;</span><br><span class="line">CoreData        	<span class="number">16072</span> ms;</span><br></pre></td></tr></table></figure>
<p>æ‰¹é‡æŸ¥è¯¢10000æ¡æ•°æ®ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FMDB         		<span class="number">8.6</span> ms;</span><br><span class="line">Realm         		<span class="number">0.2</span> ms;</span><br><span class="line">CoreData        	<span class="number">27</span> ms;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_database/chart.png" alt=""><br>æ³¨é‡Š: CoreData åœ¨ iOS 8 æ‰å¼€å§‹æ”¯æŒæ‰¹é‡æ“ä½œ(æ‰¹é‡æ›´æ–°(Bench Update) <code>NSBatchUpdateRequest</code>)</p>
<h3 id="App__u4F7F_u7528"><a href="#App__u4F7F_u7528" class="headerlink" title="App ä½¿ç”¨"></a>App ä½¿ç”¨</h3><p>å¤šçœ‹é˜…è¯»,æ‰‹æœºæ·˜å®,æ‰‹æœº QQ,å¾®åš, iOS ä¸­çš„ News ä½¿ç”¨äº† FMDB.</p>
<h3 id="IM__u7684_u9700_u6C42"><a href="#IM__u7684_u9700_u6C42" class="headerlink" title="IM çš„éœ€æ±‚"></a>IM çš„éœ€æ±‚</h3><p>IM ä¸­ä½¿ç”¨æ•°æ®åº“ä¸»è¦çš„éœ€æ±‚æ˜¯: å¤§é‡çš„å•æ¬¡å†™å…¥ä¸€æ¡æ•°æ®, å°æ‰¹é‡çš„è¯»å–æ•°æ®ä»¥åŠå°æ‰¹é‡çš„å†™å…¥.</p>
<h3 id="u5404_u81EA_u4F18_u7F3A_u70B9"><a href="#u5404_u81EA_u4F18_u7F3A_u70B9" class="headerlink" title="å„è‡ªä¼˜ç¼ºç‚¹"></a>å„è‡ªä¼˜ç¼ºç‚¹</h3><p><strong>FMDB</strong></p>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯¹å¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„,FMDBæ˜¯è½»é‡çº§çš„æ¡†æ¶ï¼Œä½¿ç”¨çµæ´»ã€‚</td>
<td>ä¸æ”¯æŒ ORM éœ€è¦æ‰‹å†™ SQLite è¯­å¥</td>
</tr>
</tbody>
</table>
<p><strong>Realm</strong></p>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å…¥é—¨é—¨æ§›ä½,æ”¯æŒ NSPredicate, æ”¯æŒ ORM</td>
<td>å…³è”å…³ç³»å¼±, å¼ºåˆ¶å†…çœå®¹é”™æœºåˆ¶å¯¼è‡´å­˜å‚¨æ–‡ä»¶ä¸æ–­å˜å¤§, æ²¡æœ‰ç»†ç²’åŒ–é€šçŸ¥,å¢åŠ åŒ…ä½“ç§¯</td>
</tr>
</tbody>
</table>
<p><strong>Core Data</strong></p>
<table>
<thead>
<tr>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç³»ç»Ÿè‡ªå¸¦, å®˜æ–¹æ”¯æŒ; å¼ºå¤§çš„å…³è”å…³ç³»; ç²¾ç»†åŒ–çš„é€šçŸ¥</td>
<td>å…¥é—¨é—¨æ§›é«˜; ä¸æ”¯æŒæ‰¹é‡æ“ä½œ</td>
</tr>
</tbody>
</table>
<h3 id="u5F15_u7528"><a href="#u5F15_u7528" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h3><p><a href="http://yulingtianxia.com/blog/2014/05/01/chu-shi-core-data-1/" target="_blank" rel="external">yulingtianxiaâ€™s blog</a><br><a href="https://realm.io/cn/docs/objc/latest/#section" target="_blank" rel="external">realm å®˜ç½‘</a><br><a href="http://iiiyu.com/2016/01/19/CoreData-VS-Realm/" target="_blank" rel="external">CoreData VS Realm</a></p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2016/03/16/iOS_database/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[Alfred 2 é…ç½®]]></title>
      <link>http://broccolii.github.io/2016/03/02/Alfred_3_config/</link>
      <guid>http://broccolii.github.io/2016/03/02/Alfred_3_config/</guid>
      <pubDate>Tue, 01 Mar 2016 21:01:46 GMT</pubDate>
      <description>
      <![CDATA[<p>å‘åŒäº‹æ¨è Mac ä¸Šæœ€å¥½ç”¨çš„è½¯ä»¶ Alfred, æ•´ç†ä¸€ä»½æ•™ç¨‹åˆ†äº«ä¸€ä¸‹.</p>
<h2 id="u8D2D_u4E70"><a href="#u8D2D_u4E70" class="headerlink" title="è´­ä¹°"></a>è´­ä¹°</h2><p>å¯ä»¥åœ¨ <a ]]>
      </description>
      <content:encoded><![CDATA[<p>å‘åŒäº‹æ¨è Mac ä¸Šæœ€å¥½ç”¨çš„è½¯ä»¶ Alfred, æ•´ç†ä¸€ä»½æ•™ç¨‹åˆ†äº«ä¸€ä¸‹.</p>
<h2 id="u8D2D_u4E70"><a href="#u8D2D_u4E70" class="headerlink" title="è´­ä¹°"></a>è´­ä¹°</h2><p>å¯ä»¥åœ¨ <a href="https://www.alfredapp.com" target="_blank" rel="external">å®˜ç½‘</a> ç‚¹å‡» <code>Download Alfred 2</code> æˆ–è€…åœ¨ <code>App Store</code> ä¸­ä¸‹è½½åŸºç¡€ç‰ˆ.(æ—¢ç„¶ä½ å·²ç»æœåˆ°äº†è¿™ç¯‡ blog, é‚£ä¹Ÿåº”è¯¥å·²ç»ä¸‹è½½å¥½äº†. å¥½åƒå¾ˆå¤šä½™å“ˆ).</p>
<p>ä½†æ˜¯ä½ ä½¿ç”¨çš„æ˜¯ç ´è§£ç‰ˆ,é­‚æ·¡ğŸ’¢ èµ¶ç´§ä¹°ä¹°ä¹°å‘€!!! -&gt; <code>Buy the Powerpack</code> è´­ä¹°è¯ä¹¦.</p>
<div style="text-align: center"><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/Powerpack_Type.png"><br></div>

<ul>
<li>Single License |å•ä¸€ç”¨æˆ· <code>V2ç‰ˆæœ¬</code> æˆæƒ | 1äºº1Key</li>
<li>Family License |å®¶åº­è£…æˆæƒ | 1äºº1Key</li>
<li>Mega Supporter |å•ä¸€ç”¨æˆ·ç»ˆç”Ÿå…è´¹å‡çº§æˆæƒ | 1äºº1Key</li>
</ul>
<p>å¦‚æœæ²¡æœ‰å…¨å¸å¡æˆ–è€…ä¸æƒ³ç”¨ä½¿ç”¨è‡ªå·±çš„ä¿¡ç”¨å¡ä»˜æ¬¾å¯ä»¥è€ƒè™‘<a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.sO7n0s&amp;id=38691109685&amp;_u=311qkdqcbbc7" target="_blank" rel="external">mou.li</a>(å¹¿å‘Šä¸€å‘)<br>æœ€è¿‘å‡çº§ V3 ç‰ˆæœ¬, åœ¨ 2016 å¹´è´­ä¹°çš„ V2 è¯ä¹¦å¯ä»¥å…è´¹å‡çº§.è¯¦è§ <a href="https://www.alfredapp.com/blog/announcements/alfred-v3-is-coming/" target="_blank" rel="external">å®˜æ–¹ blog</a></p>
<h2 id="u57FA_u672C_u914D_u7F6E"><a href="#u57FA_u672C_u914D_u7F6E" class="headerlink" title="åŸºæœ¬é…ç½®"></a>åŸºæœ¬é…ç½®</h2><p>ç°åœ¨è®©æˆ‘å¼€å§‹é…ç½® <code>Alfred</code> å§</p>
<h3 id="1-_General"><a href="#1-_General" class="headerlink" title="1. General"></a>1. General</h3><div style="text-align: center"><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/General.png"><br></div>

<ul>
<li><code>Starup:</code> è®¾ç½®æ˜¯å¦å¼€æœºå¯åŠ¨</li>
<li><code>Alfred Hotkey:</code> è®¾ç½®å¯åŠ¨çš„çƒ­é”® (å¯ä»¥åœ¨ <code>ç³»ç»Ÿåå¥½è®¾ç½®</code> å…³æ‰ <code>spotlight</code>)</li>
<li><code>Where are you:</code> è®¾ç½®å›½å®¶åæœç´¢å¼•æ“ä¼šæ ¹æ®å›½å®¶ä¸åŒä½¿ç”¨ä¸åŒçš„ç½‘ç«™(æœé²œå’Œå…¶ä»–å›½å®¶ ç¬‘~</li>
</ul>
<h3 id="2-_Features"><a href="#2-_Features" class="headerlink" title="2. Features"></a>2. Features</h3><p><div style="text-align: center"><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/General.png"><br></div></p>
<h5 id="2-1_Default_Results"><a href="#2-1_Default_Results" class="headerlink" title="2.1 Default Results"></a>2.1 Default Results</h5><p><code>Essentials:</code> æœç´¢ç»“æœåªè¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç§: åº”ç”¨,  è”ç³»äºº, ç³»ç»Ÿåå¥½è®¾ç½®, Safari çš„ä¹¦ç­¾, ä¸‹æ–¹ <code>Extras</code> ä¸­è¿˜å¯ä»¥é€‰æ‹©:æ–‡ä»¶å¤¹, æ–‡æœ¬, å‹ç¼©åŒ…, æ–‡æ¡£, å›¾ç‰‡ç­‰ç­‰.</p>
<blockquote>
<p>Note: Alfred works most effciently if you only have â€˜Essentialâ€™ items ticked and use the â€˜openâ€™ keyword to find files, you can also press [spacebar] immediately after activating Alfred to quickly enter the file search mode</p>
</blockquote>
<p>Alfred ä¸­å»ºè®®å¦‚æœåªæœç´¢æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹,å¯ä»¥ä½¿ç”¨ <code>open</code> æˆ– <code>ç©ºæ ¼é”®</code> æ¥æœç´¢,ä½¿æœç´¢æ›´è¿…é€Ÿæ›´å‡†ç¡®.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/open_filename.png" alt=""><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/spacebar_filename.png" alt=""></p>
<h5 id="2-2_File_Search"><a href="#2-2_File_Search" class="headerlink" title="2.2 File Search"></a>2.2 File Search</h5><p><strong>Search</strong></p>
<ul>
<li><code>Quick Search:</code> å¯ç”¨å¿«æ·é”® <code>&#39;</code> æˆ– <code>ç©ºæ ¼é”®</code> ä»£æ›¿ <code>open</code> å…³é”®è¯</li>
<li><code>Opening Files:</code> æ‰“å¼€æ–‡ä»¶; <code>Revealing File:</code> æŸ¥çœ‹æ–‡ä»¶æ‰€åœ¨ä½ç½®; <code>Inside Files</code> æŸ¥æ‰¾æ–‡æœ¬å†…å®¹åŒ…å«æŸ¥è¯¢çš„å…³é”®å­—; <code>File Tags:</code> ç”¨æ¥æŸ¥è¯¢ <code>tag</code> æ–‡ä»¶å¤¹ (ç¬‘ å…¶å®å¹¶ä¸çŸ¥é“è¿™ä¸ªä¸œè¥¿æ€ä¹ˆç”¨</li>
<li><code>Don&#39;t Show:</code> é€‰æ‹©æœç´¢ç»“æœä¸­ä¸æ˜¾ç¤ºå“ªç§ç±»å‹çš„æ–‡ä»¶</li>
<li><code>Result Limit:</code> æœç´¢ç»“æœçš„ä¸ªæ•°<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/File_Search_Search.png" alt=""><br><strong>Navigation</strong><br><strong>Buffer</strong><br><strong>Actions</strong><br><strong>Advanced</strong><h5 id="2-3_Web_Search"><a href="#2-3_Web_Search" class="headerlink" title="2.3 Web Search"></a>2.3 Web Search</h5><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/Web_Search.png" alt=""></li>
</ul>
<p>ä½¿ç”¨å…³é”®è¯è¿›è¡Œä¸€äº›ç½‘ç«™æœç´¢, æœ‰ä¸€äº›é»˜è®¤çš„ç½‘ç«™æ¯”å¦‚: Google, Amazon ç­‰ç­‰.æˆ‘ä»¬æ¥ä¸‹æ¥ç‚¹å‡» <code>Add Custom Search</code> æ·»åŠ ä¸€ä¸ªå…³äº <code>äº¬ä¸œ</code> çš„è‡ªå®šä¹‰æŸ¥è¯¢.</p>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/Add_Custom_Search.png" alt=""></p>
<ul>
<li><code>Search URL:</code> é€šè¿‡ç½‘ç«™æŸ¥è¯¢åŠŸèƒ½,æŸ¥è¯¢åæŸ¥çœ‹æµè§ˆå™¨çš„åœ°å€æ è·å– URL.å½“ä¸­çš„æŸ¥è¯¢å…³é”®è¯ä½¿ç”¨ <code>{query}</code> å˜é‡æ¥ä»£æ›¿.<blockquote>
<p>æ¯”å¦‚: æˆ‘åœ¨äº¬ä¸œæœç´¢ <code>iPhone6s</code>, åœ°å€æ ä¸­çš„é“¾æ¥æ˜¯: <code>http://search.jd.com/Search?keyword=iPhone6s&amp;enc=utf-8&amp;wq=iphone&amp;pvid=tqr7zbli.0jrtpq</code> æ›¿æ¢ <code>iPhone6s</code> -&gt; <code>{query}</code></p>
</blockquote>
</li>
<li><code>Title:</code> åœ¨ Alfred æŸ¥è¯¢æ—¶æ˜¾ç¤ºçš„æç¤ºæ–‡å­—</li>
<li><code>Keyword:</code> æŸ¥è¯¢åŠŸèƒ½çš„å…³é”®è¯,é¿å…ä¸ä¹‹å‰å­˜åœ¨çš„å…³é”®è¯äº§ç”Ÿå†²çª</li>
<li><code>Validation:</code> ç‚¹å‡» <code>Test</code> æ¥æµ‹è¯• <code>Search URL</code> æ˜¯å¦è®¾ç½®æˆåŠŸ</li>
<li>å³ä¾§è¿˜å¯ä»¥æ‹–å…¥ç½‘ç«™ ICON </li>
</ul>
<h5 id="2-10_System"><a href="#2-10_System" class="headerlink" title="2.10 System"></a>2.10 System</h5><p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/System.png" alt=""><br><code>å¸¸è§„ç³»ç»Ÿå‘½ä»¤:</code> å±å¹•ä¿æŠ¤ç¨‹åºã€æ˜¾ç¤ºå›æ”¶ç«™ã€æ¸…ç©ºå›æ”¶ç«™ã€ç™»å‡ºã€ç¡çœ ã€é”å®šã€é‡å¯ã€å…³æœº<br><code>ç¨‹åºç®¡ç†å‘½ä»¤:</code> éšè—ã€å…³é—­ã€å¼ºåˆ¶å…³é—­ã€å…³é—­æ‰€æœ‰åº”ç”¨ç¨‹åº<br><code>ç›˜ç¬¦ç®¡ç†å‘½ä»¤:</code> æ¨å‡ºæŸä¸ªç›˜ç¬¦ã€æ¨å‡ºæ‰€æœ‰ç›˜ç¬¦ã€è®¾ç½®ç›˜ç¬¦é»‘åå•</p>
<h5 id="Terminal_/_Shell"><a href="#Terminal_/_Shell" class="headerlink" title="Terminal / Shell"></a>Terminal / Shell</h5><p>Alfred å¯ä»¥é€šè¿‡è®¾å®šå…³é”®è¯, ç›´æ¥åœ¨ Alfred çš„æœç´¢æ¡†ä¸­è¾“å…¥å‘½ä»¤, ä¸è¿‡é»˜è®¤çš„ç»ˆç«¯æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„.æ¯•ç«Ÿæœ‰æ›´å¥½ç”¨çš„ <code>iTerm</code> åœ¨(ä¸çŸ¥é“ <code>iTerm</code> å¥½çš„åŒå­¦è¯·å‡ºé—¨å³è½¬ <code>Google</code> ä¸€ä¸‹).<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/iTerm.png" alt=""></p>
<p>æˆ‘ä»¬éœ€è¦é€šè¿‡è‡ªå®šä¹‰è„šæœ¬å®ç°. å…ˆè®¾ç½® <code>Application</code> ä¸º <code>Custom</code>, åœ¨ä¸‹é¢å¤åˆ¶ç²˜è´´ä»¥ä¸‹ä»£ç (<a href="https://github.com/stuartcryan/custom-iterm-applescripts-for-alfred" target="_blank" rel="external">å‡ºå¤„</a>):</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">-- This is v0.4 of the custom script <span class="keyword">for</span> AlfredApp <span class="keyword">for</span> iTerm 2.1.1</span><br><span class="line">-- Please see https:<span class="comment">//github.com/stuartcryan/custom-iterm-applescripts-for-alfred/</span></span><br><span class="line">-- <span class="keyword">for</span> the latest changes.</span><br><span class="line"></span><br><span class="line">-- Please <span class="keyword">note</span>, <span class="keyword">if</span> you store the iTerm binary <span class="keyword">in</span> any other location than the Applications Folder</span><br><span class="line">-- please ensure you <span class="keyword">update</span> the <span class="keyword">two</span> locations below (<span class="keyword">in</span> the <span class="keyword">format</span> of : rather than / <span class="keyword">for</span> folder dividers)</span><br><span class="line">-- this gets around issues with AppleScript not handling things well <span class="keyword">if</span> you have <span class="keyword">two</span> iTerm binaries <span class="keyword">on</span> your system... <span class="keyword">which</span> can happen :<span class="literal">D</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">on</span> alfred_script(q)</span><br><span class="line">	<span class="keyword">if</span> application <span class="string">"iTerm"</span> is running then</span><br><span class="line">		<span class="keyword">run</span> script "</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">run</span> &#123;q&#125;</span><br><span class="line">				tell application \<span class="string">":Applications:iTerm.app\"</span></span><br><span class="line">					activate</span><br><span class="line">					try</span><br><span class="line">						<span class="keyword">set</span> myterm to the first terminal</span><br><span class="line">					<span class="keyword">on</span> <span class="keyword">error</span></span><br><span class="line">						<span class="keyword">set</span> myterm to (make new terminal)</span><br><span class="line">					end try</span><br><span class="line">					tell myterm</span><br><span class="line">						<span class="keyword">set</span> mysession to (launch session \<span class="string">"Default Session\"</span>)</span><br><span class="line">						tell mysession to write text <span class="literal">q</span></span><br><span class="line">					end tell</span><br><span class="line">				end tell</span><br><span class="line">			end <span class="keyword">run</span></span><br><span class="line">		" with parameters &#123;q&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		<span class="keyword">run</span> script "</span><br><span class="line">			<span class="keyword">on</span> <span class="keyword">run</span> &#123;q&#125;</span><br><span class="line">				tell application \<span class="string">":Applications:iTerm.app\"</span></span><br><span class="line">					activate</span><br><span class="line">					tell the first terminal</span><br><span class="line">						tell the last session to write text <span class="literal">q</span></span><br><span class="line">					end tell</span><br><span class="line">				end tell</span><br><span class="line">			end <span class="keyword">run</span></span><br><span class="line">		" with parameters &#123;q&#125;</span><br><span class="line">	end <span class="keyword">if</span></span><br><span class="line">end alfred_script</span><br></pre></td></tr></table></figure>
<h3 id="Workflows"><a href="#Workflows" class="headerlink" title="Workflows"></a>Workflows</h3><h3 id="Appearance"><a href="#Appearance" class="headerlink" title="Appearance"></a>Appearance</h3><p>Appearance æ ‡ç­¾é¡µé‡Œ,æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ›´å¤šé¢„ç½®çš„ä¸»é¢˜æ¨¡å¼.å¦‚æœè¿™äº›ä½ è¿˜æ˜¯ä¸å¤Ÿæ»¡æ„,å¯ä»¥é€‰æ‹©è‡ªè¡Œåˆ›å»ºæˆ–å‰å¾€ <a href="http://www.packal.org/theme-list" target="_blank" rel="external">packal</a> ä¸‹è½½.</p>
<h3 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h3><p>ä¸€äº›æ–°ç‰¹æ€§çš„è®¾ç½®:<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Alfred_3_config/Advanced.png" alt=""></p>
<h3 id="Remote"><a href="#Remote" class="headerlink" title="Remote"></a>Remote</h3><p>Alfred Remote åœ¨ iOS ç«¯å”®ä»· Â¥30.0, è¿˜æœªè´­ä¹°æµ‹è¯•.</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2016/03/02/Alfred_3_config/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[Auto Layout ç»˜åˆ¶æµç¨‹]]></title>
      <link>http://broccolii.github.io/2016/03/02/Autolayout_flow/</link>
      <guid>http://broccolii.github.io/2016/03/02/Autolayout_flow/</guid>
      <pubDate>Tue, 01 Mar 2016 21:01:46 GMT</pubDate>
      <description>
      <![CDATA[<p>å’Œæœ‹å‹è®¨è®º <code>layout</code> å’Œ <code>constraint</code> ä¹‹é—´çš„å…³ç³», å‘ç°è‡ªå·±å¹¶ä¸æ˜¯å¾ˆç†è§£ <code>constraint</code> å¸ƒå±€é¡µé¢çš„é¡ºåº. </p>
<h3 id="Auto_Layout__u7ED8_u5]]>
      </description>
      <content:encoded><![CDATA[<p>å’Œæœ‹å‹è®¨è®º <code>layout</code> å’Œ <code>constraint</code> ä¹‹é—´çš„å…³ç³», å‘ç°è‡ªå·±å¹¶ä¸æ˜¯å¾ˆç†è§£ <code>constraint</code> å¸ƒå±€é¡µé¢çš„é¡ºåº. </p>
<h3 id="Auto_Layout__u7ED8_u5236_u6D41_u7A0B"><a href="#Auto_Layout__u7ED8_u5236_u6D41_u7A0B" class="headerlink" title="Auto Layout ç»˜åˆ¶æµç¨‹"></a>Auto Layout ç»˜åˆ¶æµç¨‹</h3><p>Auto Layout æ˜¾ç¤ºä¸€ä¸ª view æ—¶, ä¼šç»è¿‡ <code>update constraints -&gt; layout views -&gt; display</code> è¿™ä¸‰æ­¥. è¯¦æƒ…è¯·ç‚¹<a href="http://stackoverflow.com/questions/20609206/setneedslayout-vs-setneedsupdateconstraints-and-layoutifneeded-vs-updateconstra" target="_blank" rel="external">Stackoverflow</a> å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><div style="text-align: center"><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Autolayout_flow/constraint_layoutSubview_display.png"><br></div></p>
<blockquote>
<p>å¼•ç”¨è‡ª:<a href="http://objccn.io/issue-3-5/" target="_blank" rel="external">objc.io å…ˆè¿›çš„è‡ªåŠ¨å¸ƒå±€å·¥å…·ç®±</a><br>ç¬¬ä¸€æ­¥ï¼šupdate constraints,å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªâ€œè®¡é‡ä¼ é€’ (measurement pass)â€.è¿™æ˜¯è‡ªä¸‹è€Œä¸Šï¼ˆä»å­è§†å›¾åˆ°çˆ¶è§†å›¾ï¼‰å‘ç”Ÿçš„,å®ƒä¸ºå¸ƒå±€å‡†å¤‡å¥½å¿…è¦çš„ä¿¡æ¯,è€Œè¿™äº›å¸ƒå±€å°†åœ¨å®é™…è®¾ç½®è§†å›¾çš„ frame æ—¶è¢«ä¼ é€’è¿‡å»å¹¶è¢«ä½¿ç”¨.ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setNeedsUpdateConstraints</code> æ¥è§¦å‘è¿™ä¸ªæ“ä½œ.åŒæ—¶,ä½ å¯¹çº¦æŸæ¡ä»¶ç³»ç»Ÿåšå‡ºçš„ä»»ä½•æ”¹å˜éƒ½å°†è‡ªåŠ¨è§¦å‘è¿™ä¸ªæ–¹æ³•.æ— è®ºå¦‚ä½•,é€šçŸ¥è‡ªåŠ¨å¸ƒå±€å…³äºè‡ªå®šä¹‰è§†å›¾ä¸­ä»»ä½•å¯èƒ½å½±å“å¸ƒå±€çš„æ”¹å˜æ˜¯éå¸¸æœ‰ç”¨çš„.è°ˆåˆ°è‡ªå®šä¹‰è§†å›¾,ä½ å¯ä»¥åœ¨è¿™ä¸ªé˜¶æ®µé‡å†™ <code>updateConstraints</code> æ¥ä¸ºä½ çš„è§†å›¾å¢åŠ éœ€è¦çš„æœ¬åœ°çº¦æŸ.</p>
<p>ç¬¬äºŒæ­¥ï¼šlayout views,è¿™æ˜¯ä¸ªè‡ªä¸Šè€Œä¸‹ï¼ˆä»çˆ¶è§†å›¾åˆ°å­è§†å›¾ï¼‰çš„è¿‡ç¨‹,è¿™ç§å¸ƒå±€æ“ä½œå®é™…ä¸Šæ˜¯é€šè¿‡è®¾ç½® frameï¼ˆåœ¨ OS X ä¸­ï¼‰æˆ–è€… center å’Œ boundsï¼ˆåœ¨ iOS ä¸­ï¼‰å°†çº¦æŸæ¡ä»¶ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆåº”ç”¨åˆ°è§†å›¾ä¸Š.ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ setNeedsLayout æ¥è§¦å‘ä¸€ä¸ªæ“ä½œè¯·æ±‚,è¿™å¹¶ä¸ä¼šç«‹åˆ»åº”ç”¨å¸ƒå±€,è€Œæ˜¯åœ¨ç¨åå†è¿›è¡Œå¤„ç†.å› ä¸ºæ‰€æœ‰çš„å¸ƒå±€è¯·æ±‚å°†ä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªå¸ƒå±€æ“ä½œä¸­å»,æ‰€ä»¥ä½ ä¸éœ€è¦ä¸ºç»å¸¸è°ƒç”¨è¿™ä¸ªæ–¹æ³•è€Œæ‹…å¿ƒ.</p>
<p>ç¬¬ä¸‰æ­¥ï¼šdisplay,å°† view æ¸²æŸ“åˆ°å±å¹•ä¸Š,å®ƒä¸æ˜¯å¦ä½¿ç”¨ Auto Layout æ— å…³,å…¶æ“ä½œæ˜¯ä»ä¸Šå‘ä¸‹(ä»çˆ¶è§†å›¾åˆ°å­è§†å›¾),é€šè¿‡è°ƒç”¨ <code>setNeedsDisplay</code> è§¦å‘.</p>
</blockquote>
<p>åœ¨å›¾ä¸­æˆ‘ä»¬çœ‹è§,<code>layout views</code> ä¼šè§¦å‘ <code>updating constraints</code>, ä»è€Œè§¦å‘æ–°çš„ä¸€è½®ç»˜åˆ¶. åŸå› æ˜¯: å½“ <code>layoutSubviews</code> è¢«è°ƒç”¨æ—¶, ä¼šè§¦å‘ <code>updateConstraintsIfNeeded</code>, å¦‚æœè¿›è¡Œäº† <code>constraint</code> ä¿®æ”¹çš„æ“ä½œ, é‚£ä¹ˆä¼šè°ƒç”¨ <code>updating constraints</code>. è¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆ <code>UIView</code> åŠ¨ç”»ä¸­,å¦‚æœä¿®æ”¹äº† <code>constraint</code> éœ€è¦è°ƒç”¨ <code>layoutIfNeeded</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹äº†çº¦æŸ</span></span><br><span class="line">UIView.animateWithDuration(<span class="number">1.0</span>) &#123;</span><br><span class="line">    aniamtionView.layoutIfNeeded()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h3><p>ç³»ç»Ÿæä¾›äº†å‡ ä¸ªå…³äº <code>constraint</code> çš„æ–¹æ³• åˆ†åˆ«æ˜¯</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setNeedsUpdateConstraints</span><span class="params">()</span> &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>å½“ä¸€ä¸ª view çš„æŸä¸ªå±æ€§å‘ç”Ÿæ”¹å˜,å¹¶ä¸”å¯èƒ½å½±å“åˆ° <code>constraint</code> æ—¶. æ­¤æ–¹æ³•æ ‡è®°çš„ <code>constraints</code> ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹æ›´æ–°ï¼Œç³»ç»Ÿç„¶åè°ƒç”¨ <code>updateConstraints</code>.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">needsUpdateConstraints</span><span class="params">()</span> -&gt; <span class="title">Bool</span> &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç³»ç»Ÿé€šè¿‡è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼åˆ¤æ–­ <code>constraint</code> æ˜¯å¦éœ€è¦æ›´æ–°.</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateConstraintsIfNeeded</span><span class="params">()</span> &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç«‹å³æ›´æ–°è¢«æ ‡è®° <code>setNeedsUpdateConstraints</code> çš„ <code>constraint</code></p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">updateConstraints</span><span class="params">()</span> &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰ view æ—¶,æˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•åšçº¦æŸä¿®æ”¹è¿›è¡Œç›¸åº”çš„æ“ä½œ.åœ¨ <code>viewDidLoad</code> ä¹‹å, <code>viewWillLayoutSubviews</code> ä¹‹å‰è°ƒç”¨ <strong>æ³¨æ„: é‡å†™è¿™ä¸ªæ–¹æ³•æ—¶,ä¸€å®šè¦è°ƒç”¨ super.updateConstraints()</strong></p>
<p>æ ‡è®° view çš„ <code>setNeedsUpdateConstraints</code>,åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»ç³»ç»Ÿè°ƒç”¨ <code>needsUpdateConstraints</code> æ ¹æ®è¿”å›å€¼, ä¼šè§¦å‘ <code>updateConstraints</code>, ç„¶åæ›´æ–°çº¦æŸ. <code>updateConstraintsIfNeeded</code> åˆ™æ˜¯ç«‹å³æ›´æ–°æ‰€æœ‰è¢«æ ‡è®°çš„ <code>constraint</code>.</p>
<h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><p>å…³äº <code>Layout</code> ä¹Ÿæœ‰ç±»ä¼¼ <code>constraint</code> çš„å‡ ä¸ªæ–¹æ³•</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setNeedsLayout</span><span class="params">()</span> &#123;&#125;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">layoutIfNeeded</span><span class="params">()</span> &#123;&#125; </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">layoutSubviews</span><span class="params">()</span> &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç³»ç»Ÿä¼šåœ¨ <code>RunLoop</code> å‘¨æœŸä¸­çš„æŸä¸ªæ—¶åˆ»è‡ªåŠ¨è°ƒç”¨ <code>layoutSubviews</code>.å¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ <code>layoutSubviews</code>, åªéœ€è¦é‡å†™è¯¥æ–¹æ³•. <strong>æ­¤æ—¶å¹¶ä¸ä¼šå‘ç”Ÿå±å¹•ç»˜åˆ¶.</strong></p>
<blockquote>
<p>The default implementation of this method does nothing on iOS 5.1 and earlier. Otherwise, the default implementation uses any constraints you have set to determine the size and position of any subviews.</p>
<p>Subclasses can override this method as needed to perform more precise layout of their subviews. You should override this method only if the autoresizing and constraint-based behaviors of the subviews do not offer the behavior you want. You can use your implementation to set the frame rectangles of your subviews directly.</p>
<p>You should not call this method directly. If you want to force a layout update, call the setNeedsLayout method instead to do so prior to the next drawing update. If you want to update the layout of your views immediately, call the layoutIfNeeded method.</p>
</blockquote>
<p>å®˜æ–¹æ–‡æ¡£ä¸­è¯´æ˜,ä¸è¦ç›´æ¥è°ƒç”¨æ­¤æ–¹æ³•.å¦‚æœä½ æƒ³å¼ºåˆ¶æ›´æ–°å¸ƒå±€,å…ˆè°ƒç”¨ <code>setNeedsLayout</code> æ–¹æ³•æ¥ç€ç«‹å³è°ƒç”¨ <code>layoutIfNeeded</code>.</p>
<p>ä»¥ä¸‹å‡ ç§æƒ…å†µç³»ç»Ÿä¼šè°ƒç”¨<code>layoutSubviews</code>:</p>
<ul>
<li><code>addSubview</code> ä¼šè§¦å‘ <code>layoutSubviews</code></li>
<li>ä¿®æ”¹äº† view çš„ frame ä¼šè§¦å‘è‡ªèº«ä»¥åŠçˆ¶è§†å›¾çš„ <code>layoutSubviews</code>.</li>
<li>æ»šåŠ¨ä¸€ä¸ª UIScrollView ä¼šè§¦å‘ <code>layoutSubviews</code></li>
<li>æ—‹è½¬ Screen ä¼šè§¦å‘ view ä¸Šçš„ <code>layoutSubviews</code> äº‹ä»¶</li>
</ul>
<h3 id="display"><a href="#display" class="headerlink" title="display"></a>display</h3><p>å…³äº <code>display</code> å°±åªæœ‰ä¸¤ä¸ªæ–¹æ³•</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">drawRect</span><span class="params">(rect: CGRect)</span></span> &#123;&#125;</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">setNeedsDisplay</span><span class="params">()</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹æ‰€ä»¥æ²¡æœ‰ <code>ifNeeded</code> æ–¹æ³•æ˜¯å› ä¸º <code>display</code> çš„ç»˜åˆ¶å‘¨æœŸæ˜¯ 1/60 ç§’. å…³äº <code>drawRect</code> çš„ä¸€äº›é—®é¢˜å¯ä»¥çœ‹ä¸€ä¸‹ <a href="http://bihongbo.com/2016/01/03/memoryGhostdrawRect/" target="_blank" rel="external">å†…å­˜æ¶é¬¼drawRect</a></p>
<p><strong>Q&amp;A</strong><br>é—®: ä½¿ç”¨ Auto Layout ä¹‹åä»€ä¹ˆæ—¶å€™æ‰èƒ½è·å¾—æ­£ç¡®çš„ frame?<br>ç­”: <code>viewDidLayoutSubviews</code> ä¹‹å</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2016/03/02/Autolayout_flow/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[ä½¿ç”¨ CocoaPods ç®¡ç†ç§æœ‰åº“]]></title>
      <link>http://broccolii.github.io/2016/02/04/CocoaPods_private_library/</link>
      <guid>http://broccolii.github.io/2016/02/04/CocoaPods_private_library/</guid>
      <pubDate>Thu, 04 Feb 2016 04:52:39 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="u914D_u7F6E_-podspec__u6587_u4EF6"><a href="#u914D_u7F6E_-podspec__u6587_u4EF6" class="headerlink" title="é…ç½® .podspec æ–‡ä»¶"></a>é…ç½® .po]]>
      </description>
      <content:encoded><![CDATA[<h3 id="u914D_u7F6E_-podspec__u6587_u4EF6"><a href="#u914D_u7F6E_-podspec__u6587_u4EF6" class="headerlink" title="é…ç½® .podspec æ–‡ä»¶"></a>é…ç½® .podspec æ–‡ä»¶</h3><h5 id="1-__u521B_u5EFA_-podspec__u6587_u4EF6"><a href="#1-__u521B_u5EFA_-podspec__u6587_u4EF6" class="headerlink" title="1. åˆ›å»º .podspec æ–‡ä»¶"></a>1. åˆ›å»º .podspec æ–‡ä»¶</h5><p>é¦–å…ˆåœ¨ç»ˆç«¯è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod spec create &lt;name&gt;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºä¸€ä¸ª <code>&lt;name&gt;.podspec</code> æ–‡ä»¶,åˆ›å»ºçš„æ–‡ä»¶æ˜¯åˆå§‹åŒ–æ¨¡æ¿,ä¸è¿‡æˆ‘ä»¬å¹¶ä¸éœ€è¦ç”¨åˆ°é‚£ä¹ˆå¤šé…ç½®.<br>å¦‚æœæœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹å¯ä»¥åœ¨<a href="https://guides.cocoapods.org/making/specs-and-specs-repo.html" target="_blank" rel="external">CocoaPods å®˜ç½‘</a>æŸ¥çœ‹.ä¸‹é¢æ˜¯æˆ‘ä¿®æ”¹è¿‡çš„</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Pod:</span><span class="symbol">:Spec</span>.new <span class="keyword">do</span> |s|</span><br><span class="line"></span><br><span class="line">  s.name         = <span class="string">"PrivateLibrary"</span></span><br><span class="line">  s.version      = <span class="string">"0.0.1"</span>                  <span class="comment">#ç‰ˆæœ¬å·</span></span><br><span class="line">  s.summary      = <span class="string">"ç§æœ‰åº“çš„æè¿°"</span></span><br><span class="line"></span><br><span class="line">  s.description  = &lt;&lt;-<span class="constant">DESC</span></span><br><span class="line">                   ç§æœ‰åº“çš„æè¿°</span><br><span class="line">                   <span class="constant">DESC</span></span><br><span class="line"></span><br><span class="line">  s.homepage     = <span class="string">"https://github.com/broccolii/blog_demo_PrivateLibrary"</span></span><br><span class="line">  s.license      = &#123; <span class="symbol">:type</span> =&gt; <span class="string">"MIT"</span>, <span class="symbol">:file</span> =&gt; <span class="string">"LICENSE"</span> &#125;</span><br><span class="line">  s.author       = &#123; <span class="string">"broccoliii"</span> =&gt; <span class="string">"broccoliii@163.com"</span> &#125;</span><br><span class="line">  s.platform     = <span class="symbol">:ios</span>, <span class="string">"8.0"</span></span><br><span class="line">  s.source       = &#123; <span class="symbol">:git</span> =&gt; <span class="string">"https://github.com/broccolii/blog_demo_PrivateLibrary.git"</span>, <span class="symbol">:tag</span> =&gt; <span class="string">"0.0.1"</span> &#125;</span><br><span class="line">  s.source_files  = <span class="string">"SourceCode/*"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å¦‚æœç§æœ‰åº“ä¸­ä½¿ç”¨äº† ç³»ç»Ÿç³»ç»Ÿçš„ Framework å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ  </span></span><br><span class="line">  <span class="comment"># s.framework  = "SomeFramework" </span></span><br><span class="line">  <span class="comment"># s.frameworks = "SomeFramework", "AnotherFramework"</span></span><br><span class="line"></span><br><span class="line">  s.requires_arc = <span class="keyword">true</span> <span class="comment">#å¼€å¯ ARC</span></span><br><span class="line">  <span class="comment"># s.dependency "&lt;library name&gt;", "~&gt; &lt;version code&gt;" #è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–çš„ä¸€äº›ç¬¬ä¸‰æ–¹åº“</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ åªéœ€è¦å¯¼å…¥ä¸€éƒ¨åˆ†æ–‡ä»¶å¯ä»¥è¯•ä¸€ä¸‹ <code>subspec</code>, <a href="https://guides.cocoapods.org/syntax/podspec.html#subspec" target="_blank" rel="external">å®˜ç½‘æ•™ç¨‹</a>. è¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯:å¦‚æœä¸»é¢˜éƒ¨åˆ†æ·»åŠ çš„ä¾èµ–åº“(dependency).å¯ä»¥ä½¿ç”¨ <code>default_subspec</code> å¤„ç†.</p>
<h5 id="2-__u9A8C_u8BC1_-podspec"><a href="#2-__u9A8C_u8BC1_-podspec" class="headerlink" title="2. éªŒè¯ .podspec"></a>2. éªŒè¯ .podspec</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib lint &lt;name.podspec&gt;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®æç¤ºæ”¹æ‰ <code>ERROR</code>,ç›´åˆ° <code>pass</code></p>
<h3 id="u5EFA_u7ACB_spec_repository_28_u79C1_u6709_u4E2D_u5FC3_u4ED3_u5E93_29"><a href="#u5EFA_u7ACB_spec_repository_28_u79C1_u6709_u4E2D_u5FC3_u4ED3_u5E93_29" class="headerlink" title="å»ºç«‹ spec repository(ç§æœ‰ä¸­å¿ƒä»“åº“)"></a>å»ºç«‹ spec repository(ç§æœ‰ä¸­å¿ƒä»“åº“)</h3><p>æ–‡ä»¶ç»“æ„å¦‚ä¸‹,å¦‚æœæœ‰ä¸å¤ªæ˜ç™½çš„,å¯ä»¥æŸ¥çœ‹<a href="https://github.com/broccolii/blog_demo_Specs" target="_blank" rel="external">blog_demo_Specs</a></p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ Specs  </span><br><span class="line">    â””â”€â”€ <span class="string">[LibraryName]</span>  </span><br><span class="line">        â””â”€â”€ <span class="string">[VERSION_CODE]</span>  </span><br><span class="line">            â””â”€â”€ <span class="string">[LibraryName.podspec]</span></span><br></pre></td></tr></table></figure>
<h3 id="u4FEE_u6539_podfile"><a href="#u4FEE_u6539_podfile" class="headerlink" title="ä¿®æ”¹ podfile"></a>ä¿®æ”¹ podfile</h3><p>ä¿®æ”¹ podfile </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> <span class="string">'https://github.com/broccolii/blog_demo_PrivateLibrary.git'</span></span><br><span class="line">pod <span class="string">'LibraryName'</span></span><br></pre></td></tr></table></figure>
<p>æ¥ç€</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<p><em>PS:</em> å¦‚æœæƒ³æŠŠè‡ªå·±å†™çš„åº“æ”¯æŒ CocoaPods,å¯ä»¥çœ‹ä¸€ä¸‹<a href="http://yulingtianxia.com/blog/2014/05/26/publish-your-pods-on-cocoapods-with-trunk/" target="_blank" rel="external">Publish Your Pods on CocoaPods with Trunk</a></p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2016/02/04/CocoaPods_private_library/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[UITableView æ€§èƒ½ä¼˜åŒ–]]></title>
      <link>http://broccolii.github.io/2016/01/26/UITableView_Optimization/</link>
      <guid>http://broccolii.github.io/2016/01/26/UITableView_Optimization/</guid>
      <pubDate>Tue, 26 Jan 2016 15:31:22 GMT</pubDate>
      <description>
      <![CDATA[<p>æœ€è¿‘é¢è¯•é—®åˆ°å…³äº UITableView çš„ä¼˜åŒ–,æ„Ÿè§‰è‡ªå·±å›ç­”çš„ä¸æ˜¯ç‰¹åˆ«å¥½,åˆšå¥½é¡¹ç›®ä¸Šçº¿éœ€è¦ä¼˜åŒ–ä¸€éƒ¨åˆ†ä»£ç .æ‰€ä»¥åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†å¤§é‡ blog,æ€»ç»“äº†ä¸€äº›å…³äº UITableView å®ç”¨çš„ä¼˜åŒ–æŠ€å·§.</p>
<h3 id="UITableView__u91CD_u7528_u]]>
      </description>
      <content:encoded><![CDATA[<p>æœ€è¿‘é¢è¯•é—®åˆ°å…³äº UITableView çš„ä¼˜åŒ–,æ„Ÿè§‰è‡ªå·±å›ç­”çš„ä¸æ˜¯ç‰¹åˆ«å¥½,åˆšå¥½é¡¹ç›®ä¸Šçº¿éœ€è¦ä¼˜åŒ–ä¸€éƒ¨åˆ†ä»£ç .æ‰€ä»¥åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†å¤§é‡ blog,æ€»ç»“äº†ä¸€äº›å…³äº UITableView å®ç”¨çš„ä¼˜åŒ–æŠ€å·§.</p>
<h3 id="UITableView__u91CD_u7528_u673A_u5236"><a href="#UITableView__u91CD_u7528_u673A_u5236" class="headerlink" title="UITableView é‡ç”¨æœºåˆ¶"></a>UITableView é‡ç”¨æœºåˆ¶</h3><p>UITableView æœ€æ ¸å¿ƒçš„éƒ¨åˆ†å°±æ˜¯ UITableViewCell çš„é‡ç”¨æœºåˆ¶(åˆå­¦è€…å¿…é—®é¢è¯•é¢˜.é€šä¿—çš„è¯´: UITableView æœ‰ä¸€ä¸ª Cell å¯¹è±¡çš„é‡ç”¨æ± ,å…¶ä¸­å­˜æ”¾ç€å½“å‰é¡µé¢æ˜¾ç¤ºçš„ Cell(åœ¨æŸäº›è®¾å¤‡ä¸Š,å¯èƒ½ä¼šå†å¤šå‡ ä¸ª.å½“ UITableView æ»šåŠ¨æ—¶,ç¦»å¼€å±å¹•çš„ Cell ä¼šè¢«æ”¾åˆ°é‡ç”¨æ± ä¸­.æœ‰æ–°çš„ Cell è¦æ˜¾ç¤º,åˆ™åˆä»é‡ç”¨æ± ä¸­å–.è¿™æ ·çš„å¥½å¤„æ˜¾è€Œæ˜“è§,å¦‚æœ UITableView æœ‰ä¸€ä¸‡è¡Œ,æˆ‘ä»¬ä¸éœ€è¦çœŸçš„å»åˆ›å»ºä¸€ä¸‡ä¸ª Cell å¯¹è±¡.</p>
<h3 id="u7F13_u5B58_u9AD8_u5EA6"><a href="#u7F13_u5B58_u9AD8_u5EA6" class="headerlink" title="ç¼“å­˜é«˜åº¦"></a>ç¼“å­˜é«˜åº¦</h3><p>å¦‚æœæˆ‘ä»¬çš„ UITableViewCell æœ‰å¤æ‚çš„åŠ¨æ€é«˜åº¦,é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç¼“å­˜æ¯ä¸ª Cell çš„é«˜åº¦.å› ä¸º UITableView æ˜¯ç»§æ‰¿ UIScrollView,éœ€è¦å…ˆç¡®å®š contentSize.æ—¢ç„¶æˆ‘ä»¬çš„ Cell éœ€è¦åŠ¨æ€è®¡ç®—é«˜åº¦çš„,å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸‡ä¸ª Cell, é‚£ä¹ˆåœ¨åˆ›å»º UITableView æ—¶ <code>- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath;</code> ä¼šè¢«è°ƒç”¨ä¸€ä¸‡æ¬¡å“¦.å¦‚æœä½  reload ä¸€ä¸‹,åˆæ˜¯ä¸€ä¸‡æ¬¡å“¦~.å½“ UITableView æ»šåŠ¨æ—¶,åˆä¼šè°ƒç”¨ <code>- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath;</code> æ—¢ç„¶è¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨é‚£ä¹ˆå¤šæ¬¡,æˆ‘ä»¬å¯ä»¥åœ¨ç½‘ç»œåˆ° UITableView çš„æ•°æ®æºæ—¶,è®¡ç®—å‡ºä¸€ä¸ª Cell é«˜åº¦æ•°ç»„.</p>
<h3 id="u900F_u660E_u56FE_u5C42"><a href="#u900F_u660E_u56FE_u5C42" class="headerlink" title="é€æ˜å›¾å±‚"></a>é€æ˜å›¾å±‚</h3><p>é€æ˜å›¾å±‚å¯¹æ¸²æŸ“æ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“,å› ä¸ºæ··åˆ(blending)æ˜¯æ¸²æŸ“ä¸­æœ€æ…¢çš„æ“ä½œ,ç³»ç»Ÿä¼šå°†é€æ˜å›¾å±‚ä¸ä¸‹é¢çš„è§†å›¾æ··åˆèµ·æ¥è®¡ç®—å¹¶ç»˜åˆ¶å›¾å±‚å±æ€§,å‡å°‘é€æ˜å›¾å±‚å¹¶ä½¿ç”¨ä¸é€æ˜çš„å›¾å±‚æ¥æ›¿ä»£å®ƒä»¬,åœ¨ä¸é€æ˜çš„è§†å›¾é‡Œæ ‡æ˜ opaque å±æ€§ä»¥é¿å…æ— ç”¨çš„ Alpha é€šé“åˆæˆ,å¯ä»¥å¤§é‡æé«˜ GPU çš„è®¡ç®—é€Ÿåº¦.<br>å¯ä»¥é€šè¿‡ instrument çš„ Core Animation ä¸­å¼€å¯ Color Blended Layers<br>,ç„¶åçº¢è‰²çš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹æ¶ˆç­çš„åŒºåŸŸ.<br><img src="" alt=""></p>
<h3 id="u51CF_u5C11_u79BB_u5C4F_u6E32_u67D3"><a href="#u51CF_u5C11_u79BB_u5C4F_u6E32_u67D3" class="headerlink" title="å‡å°‘ç¦»å±æ¸²æŸ“"></a>å‡å°‘ç¦»å±æ¸²æŸ“</h3><p>CALayer çš„ borderã€åœ†è§’ã€é˜´å½±ã€é®ç½©(mask),CAShapeLayer çš„çŸ¢é‡å›¾å½¢æ˜¾ç¤º,é€šå¸¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“(offscreen rendering).ä¸ä¹‹ç›¸å¯¹çš„æ˜¯å½“å‰å±å¹•æ¸²æŸ“(On-Screen Rendering),æŒ‡çš„æ˜¯æ¸²æŸ“æ“ä½œæ˜¯ç”¨äºåœ¨å½“å‰å±å¹•æ˜¾ç¤ºçš„ç¼“å†²åŒºè¿›è¡Œ.ç¦»å±æ¸²æŸ“éœ€è¦å¤šæ¬¡åˆ‡æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒ,å…ˆæ˜¯ä»å½“å‰å±å¹•(On-Screen)åˆ‡æ¢åˆ°ç¦»å±(Off-Screen),ç­‰åˆ°ç¦»å±æ¸²æŸ“ç»“æŸä»¥å,å°†ç¦»å±ç¼“å†²åŒºçš„æ¸²æŸ“ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Šåˆéœ€è¦å°†ä¸Šä¸‹æ–‡ç¯å¢ƒä»ç¦»å±åˆ‡æ¢åˆ°å½“å‰å±å¹•,è€Œä¸Šä¸‹æ–‡ç¯å¢ƒçš„åˆ‡æ¢æ˜¯ä¸€é¡¹é«˜å¼€é”€çš„åŠ¨ä½œ.<br>é€šå¸¸æˆ‘ä»¬ä¼šä¸€ä¸ª view è®¾ç½®é˜´å½±ä¼šä½¿ç”¨ <code>shadowoffset</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UIView *diamondView = [[UIView alloc] init];</span><br><span class="line">diamondView.layer.shadowOffset = CGSizeMake(<span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">diamondView.layer.shadowRadius = <span class="number">5.0f</span>;</span><br><span class="line">diamondView.layer.shadowOpacity = <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šè§¦å‘ç¦»å±æ¸²æŸ“é€ æˆä¸å¿…è¦çš„å¼€é”€,é‚£ä¹ˆæ—¢è¦å®ç°é˜´å½±å›¾å±‚,åˆè¦å‡å°‘ç¦»å±æ¸²æŸ“,æé«˜æ€§èƒ½çš„è¯.æœ‰ä»€ä¹ˆæ›´å¥½çš„æ–¹å¼ä¹ˆ?</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">UIView</span> *diamondView = [[UIView alloc] init]<span class="comment">;</span></span><br><span class="line"><span class="label">diamondView.layer.shadowPath</span> = [UIBezierPath <span class="keyword">bezierPathWithRect:CGRectMake(diamondView.bounds.origin.x </span>+ <span class="number">1</span>, diamondView.<span class="keyword">bounds.origin.y </span>+ <span class="number">1</span>, diamondView.<span class="keyword">bounds.size.width, </span>diamondView.<span class="keyword">bounds.size.height)].CGPath;</span><br><span class="line"></span><span class="label">imageView.layer.shadowOpacity</span> = <span class="number">0</span>.<span class="number">5</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ <code>shadowPath</code> åªé€‚ç”¨äºç»™è§„åˆ™çš„çŸ©å½¢ç”Ÿæˆé˜´å½±è·¯å¾„.å¦‚æœæˆ‘ä»¬è¿«ä¸å¾—å·²è¦ä½¿ç”¨ <code>shadowoffset</code>,å¯ä»¥å°è¯•å¼€å¯ CALayer.shouldRasterize å±æ€§, å›¾åƒå°†ä¼šè¢«ç¼“å­˜èµ·æ¥å¹¶ç»˜åˆ¶åˆ°å®é™…å›¾å±‚çš„ contents å’Œå­å›¾å±‚.å°†åŸæœ¬åœ¨ GPU ä¸­çš„ä¸€äº›å·¥ä½œè®© CPU æ¥åš,è®©ä¸¤è€…è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡.ä½†æ˜¯è¿™å¹¶ä¸æ˜¯æœ‰ä¸€ä¸ªå…¨ä¼˜è§£,å› ä¸ºå…‰æ …åŒ–åŸå§‹å›¾åƒéœ€è¦æ—¶é—´,è€Œä¸”ä¼šæ¶ˆè€—é¢å¤–çš„å†…å­˜.æ‰€ä»¥ä¸€å®šè¦é¿å…åœ¨å†…å®¹ä¸æ–­å˜åŠ¨çš„å›¾å±‚ä¸Šä½¿ç”¨,ä¸ç„¶ç¼“å­˜çš„ä¼˜åŠ¿å°†è¡ç„¶æ— å­˜.</p>
<h3 id="u6309_u9700_u52A0_u8F7D_Cell"><a href="#u6309_u9700_u52A0_u8F7D_Cell" class="headerlink" title="æŒ‰éœ€åŠ è½½ Cell"></a>æŒ‰éœ€åŠ è½½ Cell</h3><p>å½“å¿«é€Ÿæ»‘åŠ¨ UITableView çš„æ—¶å€™,è®¡ç®—å‡ºå°†è¦æ»šåŠ¨åˆ°çš„ Cell å¼€å§‹é¢„åŠ è½½,åœ¨æ»šåŠ¨è¿‡ç¨‹ä¸­çš„ Cell é€‰æ‹©ä¸åŠ è½½,è¿™æ ·å¯ä»¥æå¤§çš„æé«˜æµç•…åº¦,åŒæ—¶ä¹Ÿä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯,è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¤§é‡ç™½è‰²çš„ Cell.ç®€å•å®ç°äº†ä¸‹:<br>å…ˆç›‘å¬ ScrollView çš„æ»šåŠ¨äº‹ä»¶ </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scroll view delegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MainTableViewController</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¼€å§‹æ»‘åŠ¨</span></span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">scrollViewWillBeginDragging</span><span class="params">(scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line">        targetRect = <span class="literal">nil</span></span><br><span class="line">        loadImageForVisibleCells()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†è¦ç»“æŸæ‹–æ‹½</span></span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">scrollViewWillEndDragging</span><span class="params">(scrollView: UIScrollView, withVelocity velocity: CGPoint, targetContentOffset: UnsafeMutablePointer&lt;CGPoint&gt;)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> rect = <span class="type">CGRect</span>(x: targetContentOffset.memory.x, y: targetContentOffset.memory.y, width: scrollView.bounds.width, height: scrollView.bounds.height)</span><br><span class="line">        targetRect = <span class="type">NSValue</span>(<span class="type">CGRect</span>: rect)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">scrollViewDidEndDecelerating</span><span class="params">(scrollView: UIScrollView)</span></span> &#123;</span><br><span class="line">        targetRect = <span class="literal">nil</span></span><br><span class="line">        loadImageForVisibleCells()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åˆ¤æ–­æ˜¯å¦ä¸ºç›®æ ‡ Cell é€‰æ‹©æ€§çš„åŠ è½½ Subview</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MainTableViewController</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">setupCell</span><span class="params">(cell: MainTableViewCell, atIndexPath indexPath: NSIndexPath)</span></span> &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ˜¯ ç›®æ ‡ cell  å¦‚æœä¸æ˜¯çš„è¯ è¿›è¡Œå›¾ç‰‡æ“ä½œ</span></span><br><span class="line">        <span class="keyword">var</span> imageURL: <span class="type">NSURL</span>? = cell.imgContent.sd_imageURL()</span><br><span class="line">        <span class="keyword">let</span> currentURL = tableViewDataArr[indexPath.row]</span><br><span class="line">        <span class="keyword">if</span> imageURL == <span class="literal">nil</span> &#123;</span><br><span class="line">            imageURL = <span class="type">NSURL</span>(string: <span class="string">""</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> !(imageURL!.isEqual(currentURL)) &#123;</span><br><span class="line">            cell.imgContent.alpha = <span class="number">0.0</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> manager = <span class="type">SDWebImageManager</span>.sharedManager()</span><br><span class="line">            <span class="keyword">let</span> cellFrame = tableView.rectForRowAtIndexPath(indexPath)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> shouldLoadImage = <span class="literal">true</span></span><br><span class="line">            <span class="comment">// ç›®æ ‡ cell åœ¨å±å¹•ä¸­æ˜¾ç¤º</span></span><br><span class="line">            <span class="keyword">if</span> targetRect != <span class="literal">nil</span> &amp;&amp; <span class="type">CGRectIntersectsRect</span>(targetRect.<span class="type">CGRectValue</span>(), cellFrame) &#123;</span><br><span class="line">                <span class="keyword">let</span> cache = manager.imageCache</span><br><span class="line">                <span class="keyword">let</span> key = manager.cacheKeyForURL(tableViewDataArr[indexPath.row])</span><br><span class="line">                <span class="keyword">if</span> cache.imageFromMemoryCacheForKey(key) == <span class="literal">nil</span> &#123;</span><br><span class="line">                    shouldLoadImage = <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> shouldLoadImage &#123;</span><br><span class="line">                cell.imgContent.sd_setImageWithURL(tableViewDataArr[indexPath.row], placeholderImage: <span class="literal">nil</span>, completed: &#123; (image, <span class="type">ErrorType</span>, cacheType, imageURL) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">if</span> imageURL.isEqual(<span class="keyword">self</span>.tableViewDataArr[indexPath.row]) &#123;</span><br><span class="line">                        <span class="type">UIView</span>.animateWithDuration(<span class="number">0.25</span>, animations: &#123; () -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">                            cell.imgContent.alpha = <span class="number">1.0</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">loadImageForVisibleCells</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> visiblesCells = tableView.visibleCells <span class="keyword">as</span>! [<span class="type">MainTableViewCell</span>]</span><br><span class="line">        <span class="keyword">for</span> cell <span class="keyword">in</span> visiblesCells &#123;</span><br><span class="line">            <span class="keyword">let</span> indexPath = tableView.indexPathForCell(cell)</span><br><span class="line">            setupCell(cell, atIndexPath: indexPath!)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="tip"><a href="#tip" class="headerlink" title="tip"></a>tip</h3><ol>
<li>å‡å°‘ Cell ä¸­çš„ Subview çš„æ•°é‡</li>
<li>å°½å¯èƒ½ä½¿ç”¨é™æ€ cell</li>
<li>ä½¿ç”¨<code>rowHeight</code>, <code>sectionFooterHeight</code> å’Œ <code>sectionHeaderHeight</code>æ¥è®¾å®šå›ºå®šçš„é«˜åº¦</li>
<li>å‡å°‘ Cell çš„ç§ç±»,è¿‡å¤šçš„ CellIndentifier ä½¿ Cell çš„é‡ç”¨æ± ä¸­å­˜åœ¨å¤§é‡çš„ Cell å®ä¾‹å¯¹è±¡.</li>
</ol>
]]></content:encoded>
      <comments>http://broccolii.github.io/2016/01/26/UITableView_Optimization/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[ReactiveCocoa æ•´ç†]]></title>
      <link>http://broccolii.github.io/2015/12/31/ReactiveCocoa_exploration/</link>
      <guid>http://broccolii.github.io/2015/12/31/ReactiveCocoa_exploration/</guid>
      <pubDate>Wed, 30 Dec 2015 19:52:39 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="ReactiveCocoa__u662F_u4EC0_u4E48"><a href="#ReactiveCocoa__u662F_u4EC0_u4E48" class="headerlink" title="ReactiveCocoa æ˜¯ä»€ä¹ˆ"></a>React]]>
      </description>
      <content:encoded><![CDATA[<h3 id="ReactiveCocoa__u662F_u4EC0_u4E48"><a href="#ReactiveCocoa__u662F_u4EC0_u4E48" class="headerlink" title="ReactiveCocoa æ˜¯ä»€ä¹ˆ"></a>ReactiveCocoa æ˜¯ä»€ä¹ˆ</h3><p><a href="https://github.com/ReactiveCocoa/ReactiveCocoa" target="_blank" rel="external">ReactiveCocoa</a>ï¼ˆç®€ç§°ä¸ºRACï¼‰,æ˜¯ç”± Github å¼€æºçš„ä¸€ä¸ªåº”ç”¨äºiOSå’ŒOSå¼€å‘çš„æ–°æ¡†æ¶.æ˜¯ä¸€ä¸ª iOS ä¸­çš„å‡½æ•°å¼å“åº”å¼ç¼–ç¨‹æ¡†æ¶.(æ³¨: æ–‡æœ¬ä¾‹å­ä½¿ç”¨ ReactiveCocoa 2.5)</p>
<h3 id="ReactiveCocoa__u7684_u4F5C_u7528"><a href="#ReactiveCocoa__u7684_u4F5C_u7528" class="headerlink" title="ReactiveCocoa çš„ä½œç”¨"></a>ReactiveCocoa çš„ä½œç”¨</h3><p>åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­,æˆ‘ä»¬éœ€è¦ç›‘å¬ä¸åŒçš„äº‹ä»¶,å¹¶ä½œå‡ºååº”,ä¾‹å¦‚å¯¹ <code>UIButton</code> çš„ç‚¹å‡»äº‹ä»¶ä½¿ç”¨ <code>TA</code> æ¨¡å¼,å¯¹ <code>UIScrollView</code> çš„æ»šåŠ¨äº‹ä»¶ä½¿ç”¨ <code>delegate</code>,å¯¹å±æ€§å˜åŒ–ç›‘å¬ä½¿ç”¨ <code>KVO</code>.é‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šæƒ³èƒ½ä¸èƒ½ä½¿ç”¨åŒä¸€çš„æ ‡å‡†? <code>ReactiveCocoa</code> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ã€ç»Ÿä¸€çš„æ–¹æ³•æ¥è¿™äº›è¡Œä¸º.å®ƒå¯ä»¥æŠŠè¦å¤„ç†çš„äº‹æƒ…,å’Œç›‘å¬çš„äº‹æƒ…çš„ä»£ç æ”¾åœ¨ä¸€èµ·,ä¾¿äºæˆ‘ä»¬ç®¡ç†ä»£ç ,éå¸¸ç¬¦åˆæˆ‘ä»¬å¼€å‘ä¸­<code>é«˜èšåˆ,ä½è€¦åˆ</code>çš„æ€æƒ³.</p>
<h3 id="u7F16_u7A0B_u8303_u5F0F_3A__u51FD_u6570_u5F0F_u7F16_u7A0B_/__u54CD_u5E94_u5F0F_u7F16_u7A0B"><a href="#u7F16_u7A0B_u8303_u5F0F_3A__u51FD_u6570_u5F0F_u7F16_u7A0B_/__u54CD_u5E94_u5F0F_u7F16_u7A0B" class="headerlink" title="ç¼–ç¨‹èŒƒå¼: å‡½æ•°å¼ç¼–ç¨‹ / å“åº”å¼ç¼–ç¨‹"></a>ç¼–ç¨‹èŒƒå¼: å‡½æ•°å¼ç¼–ç¨‹ / å“åº”å¼ç¼–ç¨‹</h3><p><em>ReactiveCocoaè¢«æè¿°ä¸ºå‡½æ•°å“åº”å¼ç¼–ç¨‹ï¼ˆFRPï¼‰æ¡†æ¶,ä½¿ç”¨ FRP æœ‰ä¸¤ä¸ªå¥½å¤„: ç›´è§‚å’Œçµæ´».</em><br><strong>å‡½æ•°å¼ç¼–ç¨‹(Functional Programming)</strong><br>å‡½æ•°å¼ç¼–ç¨‹(functional programming)ç®€å•çš„æ¥è¯´å°±æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå‹,ä¸»è¦æ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨.å‡½æ•°ç¼–ç¨‹è¯­è¨€æœ€é‡è¦çš„åŸºç¡€æ˜¯ Î» æ¼”ç®—(lambda calculus),è€Œä¸” Î» æ¼”ç®—çš„å‡½æ•°å¯ä»¥æ¥å—å‡½æ•°å½“ä½œè¾“å…¥å’Œè¾“å‡º.å‡½æ•°å¼ç¼–ç¨‹æ›´åŠ å¼ºè°ƒç¨‹åºæ‰§è¡Œçš„ç»“æœè€Œéæ‰§è¡Œçš„è¿‡ç¨‹,å€¡å¯¼åˆ©ç”¨è‹¥å¹²ç®€å•çš„æ‰§è¡Œå•å…ƒè®©è®¡ç®—ç»“æœä¸æ–­æ¸è¿›,é€å±‚æ¨å¯¼å¤æ‚çš„è¿ç®—,è€Œä¸æ˜¯è®¾è®¡ä¸€ä¸ªå¤æ‚çš„æ‰§è¡Œè¿‡ç¨‹.<br>é˜®ä¸€å³°è€å¸ˆæœ‰ä¸€ä¸ªå…³äº<a href="http://www.ruanyifeng.com/blog/2012/04/functional_programming.html" target="_blank" rel="external">å‡½æ•°å¼ç¼–ç¨‹</a>çš„ä¾‹å­,å¦‚ä¸‹:</p>
<blockquote>
<p>ä¸¾ä¾‹æ¥è¯´,ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªæ•°å­¦è¡¨è¾¾å¼ï¼š</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span> + <span class="number">2</span>) * <span class="number">3</span> - <span class="number">4</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æˆ‘ä»¬å¯èƒ½ä¼šè¿™æ ·å†™:</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable"><span class="keyword">var</span> a</span> = <span class="number">1</span> + <span class="number">2</span></span><br><span class="line"><span class="variable"><span class="keyword">var</span> b</span> = a * <span class="number">3</span>ã€€ã€€</span><br><span class="line"><span class="variable"><span class="keyword">var</span> c</span> = b - <span class="number">4</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ä½¿ç”¨å‡½æ•°,æˆ‘ä»¬å¯ä»¥æŠŠè¿ç®—è¿‡ç¨‹å®šä¹‰ä¸ºä¸åŒçš„å‡½æ•°,ç„¶åå†™æˆä¸‹é¢è¿™æ ·ï¼š</p>
</blockquote>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="literal">result</span> = subtract(multiply(add(<span class="number">1</span>,<span class="number">2</span>), <span class="number">3</span>), <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™å°±æ˜¯å‡½æ•°å¼ç¼–ç¨‹</p>
</blockquote>
<p><strong>å“åº”å¼ç¼–ç¨‹(Reactive Programming).</strong><br>å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„ç¼–ç¨‹èŒƒå¼.è¿™æ„å‘³ç€å¯ä»¥åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆæ–¹ä¾¿åœ°è¡¨è¾¾é™æ€æˆ–åŠ¨æ€çš„æ•°æ®æµ,è€Œç›¸å…³çš„è®¡ç®—æ¨¡å‹ä¼šè‡ªåŠ¨å°†å˜åŒ–çš„å€¼é€šè¿‡æ•°æ®æµè¿›è¡Œä¼ æ’­.æˆ‘ä»¬çœ‹ä¸€ä¸‹åˆšåˆšé˜®è€å¸ˆçš„ä»£ç  <code>var b = a * 3</code> å¦‚æœ <code>a</code> çš„å€¼ä» 3 å˜æˆäº† 5, é‚£ä¹ˆ <code>b</code> çš„å€¼ä¼šéšç€ <code>a</code> çš„å˜åŒ–è€Œå˜åŒ–. <code>b</code> çš„å€¼å°±ä» 9 å˜ä¸ºäº† 15.</p>
<h3 id="ReactiveCocoa__u57FA_u672C_u6982_u5FF5"><a href="#ReactiveCocoa__u57FA_u672C_u6982_u5FF5" class="headerlink" title="ReactiveCocoa åŸºæœ¬æ¦‚å¿µ"></a>ReactiveCocoa åŸºæœ¬æ¦‚å¿µ</h3><p><strong>RACSignal</strong><br>ReactiveCocoa çš„æ ¸å¿ƒå°±æ˜¯ RACSignal,ä¹Ÿå°±æ˜¯ä¿¡å·,æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºä¿¡å· <code>createSignal</code>,å¹¶å‘é€ <code>sendNext</code> è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ,å½“ä¿¡å·å®Œæˆåæˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>sendCompleted</code>,æˆ‘ä»¬åŒæ—¶ç”¨ <code>dispose</code> æ–¹æ³•é”€æ¯å®ƒ .å½“ç„¶å¦‚æœä¿¡å·å› ä¸ºå‘ç”Ÿé”™è¯¯è€Œç»ˆæ­¢,ä¹Ÿå¯ä»¥å‘é€é”™è¯¯ä¿¡å· <code>sendError</code>.å½“æˆ‘ä»¬ä½¿ç”¨äº† <code>sendCompleted</code> å’Œ <code>sendError</code> å°±ä¸èƒ½ç»§ç»­å‘é€ <code>sendNext</code>,å› ä¸ºä¿¡å·å·²ç»ç»ˆæ­¢ç»“æŸ.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¿¡å·</span></span><br><span class="line">RACSignal *signal = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">	<span class="comment">// å‘é€ä¿¡å·</span></span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"ä¸‹ä¸€æ­¥"</span>];</span><br><span class="line">   [subscriber <span class="string">sendError:</span>[NSError <span class="keyword">new</span>]];</span><br><span class="line">   [subscriber sendCompleted];</span><br><span class="line">   <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">   <span class="keyword">return</span> [RACDisposable <span class="string">disposableWithBlock:</span>^&#123;</span><br><span class="line">      <span class="comment">// ä¿¡å·è¢«é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line">   &#125;];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹å›¾æ‰€ç¤º: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ RACSignal å¯ä»¥æ¥æ›¿ä»£ iOS ä¸­ä¼ ç»Ÿçš„ Delegate,Block,Target Action,KVO,Notification.</p>
<div style="text-align: center"><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/ReactiveCocoa_exploration/RACSignal.jpg"><br></div>

<p>åˆ›å»ºäº†ä¸€ä¸ªä¿¡å·,éœ€è¦æœ‰è®¢é˜…è€…æ¥æ¥å—å®ƒ,å¦åˆ™å®ƒå°±æ˜¯ä¸€ä¸ªå¾…æ¿€æ´»çš„çŠ¶æ€.å¯ä»¥ä½¿ç”¨ <code>subscribeNext:</code> æ¿€æ´»ä¿¡å·.æ­¤æ—¶æœ‰äº†è®¢é˜…è€…,æ‰ä¼šå‘ç”Ÿ <code>sendNext:</code>, <code>sendError:</code>, <code>sendCompleted</code>. æ‰€ä»¥ä¸€ä¸ªä¿¡å·çš„æ­£ç¡®æµç¨‹åº”è¯¥æ˜¯ 1. åˆ›å»ºä¿¡å·,2. è®¢é˜…ä¿¡å·, 3. å‘é€ä¿¡å·.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¢é˜…ä¿¡å·</span></span><br><span class="line">[signal <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ next æ“ä½œ</span></span><br><span class="line">&#125; <span class="string">error:</span>^(NSError *error) &#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ error æ“ä½œ</span></span><br><span class="line">&#125; <span class="string">completed:</span>^&#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ complete æ“ä½œ</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>RACSubscriber</strong><br>æˆ‘ä»¬ç°åœ¨å¯¹ä¿¡å·çš„äº§ç”Ÿå’Œå‘é€æœ‰äº†ä¸€äº›äº†è§£, åœ¨ ReactiveCocoa ä¸­,å…¶å®å¹¶ä¸å­˜åœ¨ä¸€ä¸ªè®¢é˜…è€…çš„å®ä¾‹,å‡¡æ˜¯å®ç° <code>RACSubscriber</code> åè®®çš„ç±»éƒ½å¯ä»¥ä½œä¸ºè®¢é˜…è€….<br>åè®®é‡Œæœ‰å››ä¸ªæ–¹æ³•</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@protocol</span> RACSubscriber &lt;NSObject&gt;</span><br><span class="line"><span class="annotation">@required</span></span><br><span class="line"></span><br><span class="line">- (<span class="typename">void</span>)<span class="string">sendNext:</span>(id)value;</span><br><span class="line">- (<span class="typename">void</span>)<span class="string">sendError:</span>(NSError *)error;</span><br><span class="line">- (<span class="typename">void</span>)sendCompleted;</span><br><span class="line">- (<span class="typename">void</span>)<span class="string">didSubscribeWithDisposable:</span>(RACCompoundDisposable *)disposable;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@end</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>-sendNext:</code>,<code>-sendError:</code> å’Œ <code>-sendCompleted</code>,åˆšåˆšæˆ‘ä»¬ç”¨äºå‘é€äº†ä¸åŒç±»å‹çš„ä¿¡å·, è€Œ <code>didSubscribeWithDisposable:</code> ç”¨äºæ¥æ”¶ä»£è¡¨æŸæ¬¡è®¢é˜…çš„ disposable å¯¹è±¡,å‘Šè¯‰è®¢é˜…è€…ä½ è®¢é˜…äº†å“ªäº›ä¿¡å·.æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿”å›çš„ <code>RACDisposable</code> æ‰‹åŠ¨å–æ¶ˆè®¢é˜…è€…</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">RACDisposable *disposable = [signal <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ next æ“ä½œ</span></span><br><span class="line">&#125; <span class="string">error:</span>^(NSError *error) &#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ error æ“ä½œ</span></span><br><span class="line">&#125; <span class="string">completed:</span>^&#123;</span><br><span class="line">   <span class="comment">// æ¥æ”¶ complete æ“ä½œ</span></span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨å–æ¶ˆè®¢é˜…è€…    </span></span><br><span class="line">[disposable dispose];</span><br></pre></td></tr></table></figure>
<p>RACSignal é»˜è®¤æ›¿æˆ‘ä»¬å®ç°äº† <code>RACSubscriber</code> åè®®,ç‚¹è¿› RACSignal çš„æºç å¯ä»¥åœ¨ <code>@implementation RACSignal (Subscription)</code> çœ‹åˆ°,å®ç°è®¢é˜…è€…çš„æ–¹æ³•.è¿™é‡Œæœ‰ä¸€ä¸ªä¸ <code>RACSubscriber</code> åè®®åŒåçš„ <code>RACSubscriber</code>ç±».è¿™ä¸ <code>NSObject</code> åè®®ä¸ <code>NSObject</code>ç±»åŒåç±»ä¼¼. <code>RACSubscriber</code> ç±»å°±æ˜¯çœŸæ­£çš„è®¢é˜…è€…,ä¸è¿‡åœ¨ ReactiveCocoa ä¸­,å€¾å‘äºéšè—è®¢é˜…è€…,è®©ç¨‹åºå‘˜åªå…³æ³¨ä¿¡å·å°±å¯ä»¥äº†.</p>
<p><strong>RACDisposable</strong><br>RACDisposable ç”¨äºå–æ¶ˆè®¢é˜…ä¸èµ„æºæ¸…ç†(cancellation and resource cleanup).å½“ä¿¡å·å‘é€å®Œæˆæˆ–å‘é€é”™è¯¯çš„æ—¶å€™,å°±ä¼šè‡ªåŠ¨è§¦å‘ <code>[disposable dispose];</code>.</p>
<p><strong>RACSubject</strong><br>RACSubject æ˜¯ä¸€ä¸ªå¯ä»¥æ‰‹åŠ¨æ§åˆ¶çš„ä¿¡å·,æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ RACSignal çš„å¯å˜ç‰ˆæœ¬.RACSubject ç»§æ‰¿è‡ª RACSignal ,æ‰€ä»¥å®ƒå¯ä»¥ä½œä¸ºä¿¡å·æºè¢«è®¢é˜…è€…è®¢é˜…,åŒæ—¶,å®ƒåˆå®ç°äº† RACSubscriber åè®®,æ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ä½œä¸ºè®¢é˜…è€…è®¢é˜…å…¶ä»–ä¿¡å·æº. RACSubject å¯ä»¥çœ‹ä½œæ˜¯ä¿¡å·çš„ä¸€ä¸ªå¯å˜ä½“(variant),å°±åƒNSMutableArrayä¹‹äºNSArray.å®ƒå¯¹äºæ¡¥æ¥(bridging)éRACä»£ç åˆ°ä¿¡å·ä¸­å»(into the world of signals)éå¸¸æœ‰ç”¨.RACSubject çš„åŠŸèƒ½éå¸¸å¼ºå¤§,ä½†æ˜¯å¤ªè¿‡çµæ´»,ä¹Ÿæ­£æ˜¯å› ä¸ºå¦‚æ­¤,æˆ‘ä»¬åªæœ‰åœ¨è¿«ä¸å¾—å·²çš„æƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨å®ƒ.</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="name">RACSubject</span> *<span class="atom">signal</span> = [<span class="name">RACSubject</span> <span class="atom">subject</span>];</span><br><span class="line">[<span class="atom">signal</span> <span class="atom">subscribeNext</span>:^(<span class="atom">id</span> <span class="atom">x</span>) &#123;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[<span class="atom">signal</span> <span class="atom">sendNext</span>:@<span class="string">"signal"</span>];</span><br></pre></td></tr></table></figure>
<p><strong>RACSequence</strong><br>RACSequence ç±»å¯ä»¥ç®€å•çœ‹åšæ˜¯ ReactiveCocoa çš„ NSArray, ReactiveCocoaä½¿ç”¨ <code>rac_sequence</code> æ–¹æ³•,å¯ä»¥ä½¿ Objective-C ä¸­çš„é›†åˆç±»ï¼ˆcollection classesï¼‰ç›´æ¥è½¬æ¢ä¸ºRACSequence æ¥ä½¿ç”¨</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">NSArray</span> *numbers = <span class="annotation">@[<span class="variable">@1</span>,<span class="variable">@2</span>,<span class="variable">@3</span>,<span class="variable">@4</span>]</span>;</span><br><span class="line">[numbers.rac_sequence.signal <span class="symbol">subscribeNext:</span>^(id x) &#123;</span><br><span class="line"><span class="regexp">//</span> éå†æ•°ç»„</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>RACScheduler</strong><br>RACScheduler åœ¨ ReactiveCocoa ä¸­ç±»ä¼¼ GCD çš„é˜Ÿåˆ—,æ˜¯ç®¡ç†çº¿ç¨‹çš„ä¸€ä¸ªç±».è´Ÿè´£ ReactiveCocoa ä¸­è®©ä¿¡å·å‘å‡ºçš„äº‹ä»¶åœ¨çº¿ç¨‹ä¸­ç©¿æ¢­,å°¤å…¶æ˜¯æƒ³æ›´æ–° UI å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­çš„æ—¶å€™,å¯ä»¥è®©äº‹ä»¶ç›´æ¥ä»å…¶ä»–çº¿ç¨‹è·³åˆ°ä¸»çº¿ç¨‹.æœ¬è´¨ä¸Šå®ƒæ˜¯åŸºäº GCD çš„ä¸²è¡Œé˜Ÿåˆ—å®ç°,å¹¶ä¸”æ”¯æŒå–æ¶ˆæ“ä½œ.</p>
<p><strong>RACMulticastConnection</strong><br>RACMulticastConnection æ˜¯ä¸€ä¸ªåœ¨ä»»æ„æ•°é‡è®¢é˜…è€…ä¹‹é—´å…±äº«çš„ä¸€ä¸ªè®¢é˜…è€…(subscription).<br>ä¿¡å·åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å†·çš„,æ¯å½“æ·»åŠ ä¸€ä¸ªæ–°çš„è®¢é˜…,ä¿¡å·çš„ block å°±ä¼šè¢«è°ƒç”¨ä¸€æ¬¡,å¦‚æœ block ä¸­å®ç°çš„æ˜¯ç½‘ç»œè¯·æ±‚,é‚£ä¹ˆä¼šå‘ç”Ÿå¤šæ¬¡è¯·æ±‚.(è¿™é‡Œä¸ replay ä¸åŒçš„æ˜¯,replay æ˜¯ä¼šäº§ç”Ÿå¤šæ¬¡ä¿¡å·,ä¸è¿‡åªå‘é€ç¬¬ä¸€æ¬¡çš„,è€Œ RACMulticastConnection åªä¼šäº§ç”Ÿä¸€æ¬¡)</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"ç½‘ç»œè¯·æ±‚"</span>);</span><br><span class="line">   [subscriber sendNext:<span class="string">@"signal"</span>];</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">RACMulticastConnection *connect = [signal publish];</span><br><span class="line"></span><br><span class="line">[connect<span class="variable">.signal</span> subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[connect<span class="variable">.signal</span> subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.è¿æ¥,æ¿€æ´»ä¿¡å·</span></span><br><span class="line">[connect connect];</span><br></pre></td></tr></table></figure>
<h3 id="ReactiveCocoa__u4E2D_u7684_u5E38_u7528_u5F02_u6B65_u5904_u7406"><a href="#ReactiveCocoa__u4E2D_u7684_u5E38_u7528_u5F02_u6B65_u5904_u7406" class="headerlink" title="ReactiveCocoa ä¸­çš„å¸¸ç”¨å¼‚æ­¥å¤„ç†"></a>ReactiveCocoa ä¸­çš„å¸¸ç”¨å¼‚æ­¥å¤„ç†</h3><ul>
<li>Delegate (æœ‰å±€é™,åªèƒ½å–ä»£æ²¡æœ‰è¿”å›å€¼çš„ä»£ç†æ–¹æ³•)</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="keyword">self</span> rac_signalForSelector:<span class="keyword">@selector</span>(textFieldDidBeginEditing:)</span><br><span class="line"> fromProtocol:<span class="class"><span class="keyword">@protocol</span>(<span class="title">UITextFieldDelegate</span>)]</span></span><br><span class="line"> subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line"><span class="comment">// ä»£ç†æ–¹æ³•</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>Target-Action</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[button rac_signalForControlEvents:UIControlEventTouchUpInside]</span></span><br><span class="line"> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">// ç‚¹å‡»äº‹ä»¶  </span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>KVO</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[RACObserve<span class="list">(<span class="keyword">scrollView</span>, contentOffset)</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">// ç›‘å¬ scrollView çš„åç§»é‡</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Notification</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[NSNotificationCenter defaultCenter]</span> rac_addObserverForName:UIApplicationDidEnterBackgroundNotification object:nil]</span> subscribeNext:^<span class="list">(<span class="keyword">NSNotification</span> * notification)</span> <span class="collection">&#123;</span><br><span class="line">// æ”¶åˆ°é€šçŸ¥ </span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å®šæ—¶å™¨</li>
</ul>
<p>1.å»¶è¿Ÿä¸€æ®µæ—¶é—´åå†åšæŸä»¶äº‹</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr_selector">[[RACScheduler mainThreadScheduler]</span> <span class="tag">afterDelay</span><span class="pseudo">:2</span> <span class="tag">schedule</span>:^&#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>2.æ¯ä¸ªä¸€å®šé•¿åº¦æ—¶é—´åšä¸€ä»¶äº‹</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[RACSignal interval:1 onScheduler:<span class="collection">[RACScheduler mainThreadScheduler]</span>]</span>subscribeNext:^<span class="list">(<span class="keyword">NSDate</span> * date)</span> <span class="collection">&#123;</span><br><span class="line">// do something</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æ‰‹åŠ¿</li>
</ul>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UITapGestureRecognizer *tap = <span class="comment">[<span class="comment">[UITapGestureRecognizer alloc]</span> init]</span>;</span><br><span class="line"><span class="comment">[<span class="comment">[tap rac_gestureSignal]</span> subscribeNext:^(UITapGestureRecognizer * tap) &#123;</span><br><span class="line">// æ‰‹åŠ¿æ“ä½œ</span><br><span class="line">&#125;]</span>;</span><br><span class="line"><span class="comment">[self.view addGestureRecognizer:tap]</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ–‡æœ¬æ¡†æ–‡å­—æ”¹å˜ </li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[textField rac_textSignal]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="u5B8F_u5B9A_u4E49"><a href="#u5B8F_u5B9A_u4E49" class="headerlink" title="å®å®šä¹‰"></a>å®å®šä¹‰</h3><p><strong>RAC()</strong> å¯ä»¥å°† RACSignal å‘å‡ºäº‹ä»¶çš„å€¼èµ‹ç»™æŸä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RAC(self.labelView,<span class="keyword">text</span>) = <span class="keyword">textField</span>.rac_textSignal;</span><br></pre></td></tr></table></figure>
<p><strong>RACObserve()</strong> æ–°å»ºä¸€ä¸ª <code>RACSignal</code> å¹¶å¯¹å¯¹è±¡çš„å±æ€§çš„å€¼è¿›è¡Œè§‚å¯Ÿ</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[RACObserve<span class="list">(<span class="keyword">textField</span>, text)</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">// å½“ text å‘ç”Ÿæ”¹å˜æ—¶,ä¼šæ¥æ”¶åˆ°ä¿¡å·</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>RACTuplePack</strong> æŠŠæ•°æ®åŒ…è£…æˆ RACTuple ç±»å‹</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RACTuple *tuple = RACTuplePack(<span class="constant">@10</span>,<span class="constant">@20</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>RACTupleUnpack</strong> æŠŠ RACTuple ç±»å‹è§£åŒ…</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// num1 = 10, num2 = 20</span></span><br><span class="line">RACTupleUnpack(<span class="built_in">NSNumber</span> *num1,<span class="built_in">NSNumber</span> *num2) = tuple;</span><br></pre></td></tr></table></figure>
<p><strong>@weakify(Obj) / @strongify(Obj)</strong><br>ç”¨æ¥ç”Ÿæˆ <code>__weakçš„self_weak_å˜é‡</code> å’Œ <code>__strongçš„selfæŒ‡é’ˆæŒ‡å‘self_weak</code> ç”¨æ¥å¤„ç† block è°ƒç”¨ä¸­çš„ å¾ªç¯å¼•ç”¨.å®ç°ç»†èŠ‚å¯ä»¥å‚è€ƒ <a href="http://blog.sunnyxx.com/2014/03/06/rac_1_macros/" target="_blank" rel="external">sunnyxx å¤§ç¥çš„ ç¥å¥‡çš„Macros</a></p>
<h3 id="u5E38_u7528_u64CD_u4F5C"><a href="#u5E38_u7528_u64CD_u4F5C" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h3><p>ä¾‹å­æ‘˜è‡ª<a href="http://www.jianshu.com/p/e10e5ca413b7" target="_blank" rel="external">æœ€å¿«è®©ä½ ä¸Šæ‰‹ReactiveCocoaä¹‹è¿›é˜¶ç¯‡</a> å’Œ <a href="http://ios.jobbole.com/82356/" target="_blank" rel="external">è¿™æ ·å¥½ç”¨çš„ReactiveCocoa,æ ¹æœ¬åœä¸ä¸‹æ¥</a>(PS: å¦‚æœçŸ¥é“åŸæ–‡åœ°å€è¯·å‘ŠçŸ¥ :) )</p>
<h5 id="u6620_u5C04"><a href="#u6620_u5C04" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h5><ul>
<li>map å°†ä¿¡å·çš„å€¼æ˜ å°„æˆä¸€ä¸ªæ–°å€¼</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UITextField</span> *textField= [[<span class="built_in">UITextField</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">30</span>)];</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.view</span> addSubview:textField];</span><br><span class="line">    </span><br><span class="line">[[[textField rac_textSignal] map:^<span class="keyword">id</span>(<span class="keyword">id</span> value) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">@"map è¿‡çš„å€¼"</span>;</span><br><span class="line">&#125;] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">  <span class="comment">// å¤„ç† map ä¹‹åçš„å€¼</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>flattenMap å°†ä¿¡å·æ˜ å°„æˆæ–°çš„ä¿¡å·</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">   NSLog<span class="list">(@<span class="string">"ç¬¬ä¸€æ­¥æ“ä½œ"</span>)</span><span class="comment">;</span></span><br><span class="line">   <span class="collection">[subscriber sendNext:@<span class="string">"ç¬¬äºŒæ­¥æ“ä½œ"</span>]</span><span class="comment">;</span></span><br><span class="line">   <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">   return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> flattenMap:<span class="comment">^RACStream</span> *<span class="list">(<span class="keyword">NSString*</span> value)</span> <span class="collection">&#123;</span><br><span class="line">   return <span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">       NSLog<span class="list">(@<span class="string">"ç°åœ¨è¿›è¡Œçš„æ˜¯: %@"</span>,value)</span><span class="comment">;</span></span><br><span class="line">       <span class="collection">[subscriber sendNext:@<span class="string">"æ“ä½œå®Œæ¯•"</span>]</span><span class="comment">;</span></span><br><span class="line">       <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">       return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">   &#125;</span>]</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">   // x = æ“ä½œå®Œæ¯•</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="u7EC4_u5408"><a href="#u7EC4_u5408" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h4><ul>
<li>concat æŒ‰é¡ºåºæ‹¼æ¥ä¿¡å·,å¹¶ä¸”æœ‰é¡ºåºåœ°æ¥æ”¶ä¿¡å·</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signalA = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"æˆ‘å…ˆåšå®Œæ‰èƒ½åš B"</span>];</span><br><span class="line">   [subscriber sendCompleted];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line">RACSignal *signalB = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"æˆ‘è¦ç­‰ A åšå®Œäº†æ‰èƒ½å¼€å§‹"</span>];</span><br><span class="line">   [subscriber sendCompleted];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line">[[signalA <span class="string">concat:</span>signalB] <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">   <span class="comment">// è¾“å‡º</span></span><br><span class="line">   <span class="comment">// æˆ‘å…ˆåšå®Œæ‰èƒ½åš B</span></span><br><span class="line">   <span class="comment">// æˆ‘è¦ç­‰ A åšå®Œäº†æ‰èƒ½å¼€å§‹</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>then ç”¨äºè¿æ¥å¤šä¸ªä¿¡å·å½“å‰ä¸€ä¸ªä¿¡å·ç»“æŸ,å¼€å§‹ä¸‹ä¸€ä¸ªä¿¡å·.</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[<span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">   NSLog<span class="list">(@<span class="string">"ç¬¬ä¸€æ­¥"</span>)</span><span class="comment">;</span></span><br><span class="line">   <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">   return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> then:<span class="comment">^RACSignal</span> *<span class="collection">&#123;</span><br><span class="line">   return <span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">       NSLog<span class="list">(@<span class="string">"ç¬¬äºŒæ­¥"</span>)</span><span class="comment">;</span></span><br><span class="line">       <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">       return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">   &#125;</span>]</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> then:<span class="comment">^RACSignal</span> *<span class="collection">&#123;</span><br><span class="line">   return <span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">       NSLog<span class="list">(@<span class="string">"ç¬¬ä¸‰æ­¥"</span>)</span><span class="comment">;</span></span><br><span class="line">       <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">       return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">   &#125;</span>]</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> subscribeCompleted:<span class="comment">^&#123;</span><br><span class="line">   NSLog(@"ç¬¬å››æ­¥");</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>merge å°†å¤šä¸ªä¿¡å·åˆå¹¶ä¸ºä¸€ä¸ª,ä»»ä½•ä¸€ä¸ªä¿¡å·å‘å‡ºå°±ä¼šè°ƒç”¨</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber sendNext:@<span class="string">"ä¿¡å·ä¸€"</span>];</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">nil</span>;</span><br><span class="line">&#125;];</span><br><span class="line">RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber sendNext:@<span class="string">"ä¿¡å·äºŒ"</span>];</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">nil</span>;</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line"><span class="string">[[RACSignal merge:@[signalA, signalB]]</span> subscribeNext:^(id x) &#123;</span><br><span class="line">  </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>zipWith å°†å¤šä¸ªä¿¡å·åˆå¹¶ä¸ºä¸€ä¸ªå¤šä¸ªä¿¡å·å‘å‡ºå°±ä¼šè°ƒç”¨,æ¥å—çš„å€¼ä¸ºä¸€ä¸ªå…ƒç»„</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signalA = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"signalA"</span>];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line">RACSignal *signalB = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"signalB"</span>];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line">[[signalA <span class="string">zipWith:</span>signalB] <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">   </span><br><span class="line">   NSLog(@<span class="string">"%@"</span>,x);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>reduce æŠŠä¿¡å·å‘å‡ºå…ƒç»„çš„å€¼èšåˆæˆä¸€ä¸ªå€¼</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signalA = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"signalA"</span>];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">RACSignal *signalB = [RACSignal <span class="string">createSignal:</span>^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">   [subscriber <span class="string">sendNext:</span>@<span class="string">"signalB"</span>];</span><br><span class="line">   <span class="keyword">return</span> nil;</span><br><span class="line">&#125;];</span><br><span class="line">[[RACSignal <span class="string">combineLatest:</span>@[sugarSignal, waterSignal] <span class="string">reduce:</span>^id (NSString *str1, NSString *str2)&#123;</span><br><span class="line">   <span class="keyword">return</span> [str1 <span class="string">stringByAppendingString:</span>str2];</span><br><span class="line">&#125;] <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">	<span class="comment">// è¾“å‡º "str1str2"</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h4 id="u8FC7_u6EE4"><a href="#u8FC7_u6EE4" class="headerlink" title="è¿‡æ»¤"></a>è¿‡æ»¤</h4><ul>
<li>filter è¿‡æ»¤ä¿¡å·</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[textField rac_textSignal]</span> filter:<span class="comment">^BOOL</span><span class="list">(<span class="keyword">id</span> value)</span> <span class="collection">&#123;</span><br><span class="line">   return textField.text.length &gt; <span class="number">6</span> ? YES : NO;</span><br><span class="line">&#125;</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">  // ä¹‹åå½“ textField.text çš„é•¿åº¦å¤§äºå…­ä½æ‰ä¼šæ¥æ”¶åˆ°ä¿¡å·</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ignore å¿½ç•¥å®ŒæŸäº›å€¼çš„ä¿¡</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[textField rac_textSignal]</span> ignore:@<span class="string">"æˆ‘æ˜¯è¢«å¿½ç•¥çš„å€¼"</span>]</span> </span><br><span class="line">subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>distinctUntilChanged åªæœ‰å½“ä¸ä¸Šä¸€ä¸ªä¿¡å·å€¼ä¸åŒæ—¶,æ‰ä¼šå‘å‡ºä¿¡å·</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[textField rac_textSignal]</span> distinctUntilChanged]</span> </span><br><span class="line">subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>take å– N æ¬¡çš„ä¿¡å·</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RACSubject *signal = [RACSubject subject];</span><br><span class="line">[[signal <span class="string">take:</span><span class="number">1</span>] <span class="string">subscribeNext:</span>^(id x) &#123;</span><br><span class="line">	<span class="comment">// åªä¼šæ¥å—ä¸€æ¬¡ä¿¡å·</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[signal <span class="string">sendNext:</span>@<span class="number">1</span>];</span><br><span class="line">[signal <span class="string">sendNext:</span>@<span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>takeLast å–æœ€å N æ¬¡çš„ä¿¡å·,è®¢é˜…è€…å¿…é¡»è°ƒç”¨å®Œæˆ.</li>
</ul>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">RACSubject *signal = <span class="comment">[RACSubject subject]</span>;</span><br><span class="line"><span class="comment">[<span class="comment">[signal takeLast:1]</span> subscribeNext:^(id x) &#123;</span><br><span class="line">	// åªä¼šæ¥å—æœ€åä¸€æ¬¡ä¿¡å·</span><br><span class="line">&#125;]</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">[signal sendNext:@1]</span>;</span><br><span class="line"><span class="comment">[signal sendNext:@2]</span>;</span><br><span class="line"><span class="comment">[signal sendCompleted]</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>takeUntil ç›‘å¬ä¿¡å·ç›´åˆ°æŸä¸ªä¿¡å·æ‰§è¡Œå®Œæˆ</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr_selector">[[textField rac_textSignal]</span> <span class="tag">takeUntil</span><span class="pseudo">:self</span><span class="class">.rac_willDeallocSignal</span>];</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¼•ç”¨<a href="http://limboy.me/ios/2014/06/06/deep-into-reactivecocoa2.html" target="_blank" rel="external">limboy å¤§ç¥çš„ä¸€ä¸ªä¾‹å­</a><br>å®ƒçš„å¸¸ç”¨åœºæ™¯ä¹‹ä¸€æ˜¯å¤„ç†cellçš„buttonçš„ç‚¹å‡»äº‹ä»¶,æ¯”å¦‚ç‚¹å‡»Cellçš„è¯¦æƒ…æŒ‰é’®,éœ€è¦pushä¸€ä¸ªVC,å°±å¯ä»¥è¿™æ ·:</p>
</blockquote>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[cell.detailButton</span><br><span class="line">    rac_signalForControlEvents:UIControlEventTouchUpInside]</span></span><br><span class="line">    takeUntil:cell.rac_prepareForReuseSignal]</span></span><br><span class="line">    subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">        // generate and push ViewController</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>skip è·³è¿‡ N ä¸ªä¿¡å·</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[textField rac_textSignal]</span> skip:1]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>takeUntilBlock:(BOOL (^)(id x)) å¯¹äºæ¯ä¸ªä¿¡å·çš„å€¼,è¿è¡Œblock,å½“blockè¿”å›YESæ—¶åœæ­¢.</li>
<li>takeWhileBlock:(BOOL (^)(id x)) å¯¹äºæ¯ä¸ªä¿¡å·çš„å€¼,è¿è¡Œblock,å½“blockè¿”å›NOæ—¶åœæ­¢.</li>
<li>skipUntilBlock:(BOOL (^)(id x)) å¯¹äºæ¯ä¸ªä¿¡å·çš„å€¼,è¿è¡Œblock,å½“blockè¿”å›YESæ—¶åœæ­¢è·³è¿‡.</li>
<li>skipWhileBlock:(BOOL (^)(id x)) å¯¹äºæ¯ä¸ªä¿¡å·çš„å€¼,è¿è¡Œblock,å½“blockè¿”å›NOæ—¶åœæ­¢è·³è¿‡.</li>
</ul>
<h4 id="u79E9_u5E8F"><a href="#u79E9_u5E8F" class="headerlink" title="ç§©åº"></a>ç§©åº</h4><ul>
<li>doNext æ‰§è¡Œ Next ä¹‹å‰,ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªBlock</li>
<li>doCompleted æ‰§è¡Œ sendCompleted ä¹‹å‰,ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªBlock</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[<span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">  <span class="collection">[subscriber sendNext:@<span class="number">1</span>]</span><span class="comment">;</span></span><br><span class="line">  <span class="collection">[subscriber sendCompleted]</span><span class="comment">;</span></span><br><span class="line">  return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> doNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">// æ‰§è¡Œ<span class="collection">[subscriber sendNext:@<span class="number">1</span>]</span><span class="comment">;ä¹‹å‰ä¼šè°ƒç”¨è¿™ä¸ªBlock</span></span><br><span class="line">  NSLog<span class="list">(@<span class="string">"doNext"</span>)</span><span class="comment">;;</span></span><br><span class="line">&#125;</span>]</span> doCompleted:<span class="comment">^&#123;</span><br><span class="line">   // æ‰§è¡Œ[subscriber sendCompleted];ä¹‹å‰ä¼šè°ƒç”¨è¿™ä¸ªBlock</span><br><span class="line">  NSLog(@"doCompleted");;</span><br><span class="line"></span><br><span class="line">&#125;</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line"></span><br><span class="line">  NSLog<span class="list">(@<span class="string">"%@"</span>,x)</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="u65F6_u95F4"><a href="#u65F6_u95F4" class="headerlink" title="æ—¶é—´"></a>æ—¶é—´</h4><ul>
<li>timeout è¶…æ—¶</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">   return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> timeout:10 onScheduler:<span class="collection">[RACScheduler currentScheduler]</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span> error:^<span class="list">(<span class="keyword">NSError</span> *error)</span> <span class="collection">&#123;</span><br><span class="line">   // åç§’åè°ƒç”¨</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>interval å®šæ—¶</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[RACSignal interval:1 onScheduler:<span class="collection">[RACScheduler currentScheduler]</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>delay å»¶è¿Ÿè°ƒç”¨ sendNext</li>
</ul>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="collection">[<span class="collection">[<span class="collection">[RACSignal createSignal:<span class="comment">^RACDisposable</span> *<span class="list">(<span class="keyword">id&lt;RACSubscriber&gt;</span> subscriber)</span> <span class="collection">&#123;</span><br><span class="line">   <span class="collection">[subscriber sendNext:@<span class="string">"signal"</span>]</span><span class="comment">;</span></span><br><span class="line">   return <span class="literal">nil</span><span class="comment">;</span></span><br><span class="line">&#125;</span>]</span> delay: <span class="number">10</span>]</span> subscribeNext:^<span class="list">(<span class="keyword">id</span> x)</span> <span class="collection">&#123;</span><br><span class="line">   // <span class="number">10</span> ç§’åæ¥æ”¶</span><br><span class="line">&#125;</span>]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="u91CD_u590D"><a href="#u91CD_u590D" class="headerlink" title="é‡å¤"></a>é‡å¤</h4><ul>
<li>retry é‡è¯•,åªè¦å¤±è´¥,å°±ä¼šé‡æ–°æ‰§è¡Œåˆ›å»ºä¿¡å·ä¸­çš„block,ç›´åˆ°æˆåŠŸ.</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__block <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">[[[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">       <span class="keyword">if</span> (i == <span class="number">10</span>) &#123;</span><br><span class="line">           [subscriber sendNext:@<span class="number">1</span>];</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="built_in">NSLog</span>(<span class="string">@"æ¥æ”¶åˆ°é”™è¯¯"</span>);</span><br><span class="line">           [subscriber sendError:<span class="literal">nil</span>];</span><br><span class="line">       &#125;</span><br><span class="line">       i++;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;] retry] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line"></span><br><span class="line">&#125; error:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<ul>
<li>replay é‡æ”¾,å½“ä¸€ä¸ªä¿¡å·è¢«å¤šæ¬¡è®¢é˜…,åªå‘é€ç¬¬ä¸€æ¬¡çš„æ•°æ®</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">RACSignal *signal = [[RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line"> 	<span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">1</span>; </span><br><span class="line">	[subscriber sendNext:@(a)];</span><br><span class="line">	a ++;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;] replay];</span><br><span class="line">    </span><br><span class="line">[signal subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"ç¬¬ä¸€ä¸ªè®¢é˜…è€…%@"</span>,x);</span><br><span class="line">&#125;];</span><br><span class="line">    </span><br><span class="line">[signal subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">   <span class="built_in">NSLog</span>(<span class="string">@"ç¬¬äºŒä¸ªè®¢é˜…è€…%@"</span>,x);</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¤ä¸ªè¾“å‡ºéƒ½ä¸º 1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>throttle èŠ‚æµ,å½“æŸä¸ªä¿¡å·å‘é€æ¯”è¾ƒé¢‘ç¹æ—¶å¯ä»¥éš”ä¸€æ®µæ—¶é—´è·å–ä¿¡å·çš„æœ€æ–°å†…å®¹</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åç§’å†…ä¸æ¥å—ä»»ä½•ä¿¡å·å†…å®¹,åç§’åè·å–æœ€åå‘é€çš„ä¿¡å·å†…å®¹</span></span><br><span class="line"><span class="attr_selector">[[[RACSubject subject]</span> <span class="tag">throttle</span><span class="pseudo">:10</span>] <span class="tag">subscribeNext</span>:^(id x) &#123;</span><br><span class="line">   </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h4 id="u8865_u5145"><a href="#u8865_u5145" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h4><p>å¬äº†<a href="https://github.com/DeveloperLx" target="_blank" rel="external">DeveloperLx</a>å…³äº ReactiveCocoa çš„åˆ†äº«,è®°å½•ä¸€ä¸‹ä¸€ä¸ªä¼˜åŒ–å³æ—¶æœç´¢çš„ä»£ç æ®µ,å¾ˆå€¼å¾—å­¦ä¹ .</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UITextField</span> * textField = [[<span class="built_in">UITextField</span> alloc]init];</span><br><span class="line">textField<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> cyanColor];</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.view</span> addSubview:textField];</span><br><span class="line">   </span><br><span class="line">@weakify(<span class="keyword">self</span>);</span><br><span class="line">[textField mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">  @strongify(<span class="keyword">self</span>);</span><br><span class="line">  make<span class="variable">.size</span><span class="variable">.mas_equalTo</span>(<span class="built_in">CGSizeMake</span>(<span class="number">180</span>, <span class="number">40</span>));</span><br><span class="line">  make<span class="variable">.center</span><span class="variable">.equalTo</span>(<span class="keyword">self</span><span class="variable">.view</span>);</span><br><span class="line">&#125;];</span><br><span class="line"><span class="comment">//throttle åé¢æ˜¯ä¸ªæ—¶é—´ è¡¨ç¤ºrac_textSignalå‘é€æ¶ˆæ¯ï¼Œ0.3ç§’å†…æ²¡æœ‰å†æ¬¡å‘é€å°±ä¼šç›¸åº”ï¼Œè‹¥æ˜¯0.3å†…åˆå‘é€æ¶ˆæ¯äº†ï¼Œä¾¿ä¼šåœ¨æ–°çš„ä¿¡æ¯å¤„é‡æ–°è®¡æ—¶</span></span><br><span class="line"><span class="comment">//distinctUntilChanged è¡¨ç¤ºä¸¤ä¸ªæ¶ˆæ¯ç›¸åŒçš„æ—¶å€™ï¼Œåªä¼šå‘é€ä¸€ä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="comment">//ignore è¡¨ç¤ºå¦‚æœæ¶ˆæ¯å’Œignoreåé¢çš„æ¶ˆæ¯ç›¸åŒï¼Œåˆ™ä¼šå¿½ç•¥æ‰è¿™æ¡æ¶ˆæ¯ï¼Œä¸è®©å…¶å‘é€</span></span><br><span class="line">[[[[[[textField<span class="variable">.rac_textSignal</span> throttle:<span class="number">0.3</span>] distinctUntilChanged] ignore:<span class="string">@""</span>] map:^<span class="keyword">id</span>(<span class="keyword">id</span> value) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> [RACSignal createSignal:^RACDisposable *(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//  network request</span></span><br><span class="line">      [subscriber sendNext:value];</span><br><span class="line">      [subscriber sendCompleted];</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class="line">          </span><br><span class="line">          <span class="comment">//  cancel request</span></span><br><span class="line">      &#125;];</span><br><span class="line">  &#125;];</span><br><span class="line">&#125;]switchToLatest] subscribeNext:^(<span class="keyword">id</span> x) &#123;</span><br><span class="line">  </span><br><span class="line">  LxDBAnyVar(x);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åšç»™æœåŠ¡å™¨å‡å°äº†å¾ˆå¤šçš„å‹åŠ›ï¼Œæ›´æ˜¯èŠ‚çœäº†æˆ‘ä»¬å¤§é‡çš„ä»£ç ã€‚ å…¶ä¸­æˆ‘ä»¬ç”¨mapå»ºç«‹äº†ä¸€ä¸ªæ–°çš„ä¿¡å·ï¼Œæˆ‘ä»¬çŸ¥é“textFieldçš„æ”¹å˜æ˜¯ä¸€ä¸ªä¿¡å·ï¼Œ mapå°±æ˜¯åœ¨è¿™ä¸ªä¿¡å·ä¸Šï¼ŒåˆåŠ äº†ä¸€ä¸ªä¿¡å·ï¼Œå³signal of signalsã€‚<br>è®¢é˜…è€…æ‰€æ‰“å°çš„æ¶ˆæ¯xåˆ™æ˜¯ï¼Œmapå‘å‡ºçš„ä¿¡å·ã€‚æˆ‘ä»¬å¯ä»¥å†mapä¸­å‘é€æ–°çš„ä¿¡å·ï¼Œä»¥åŠå–æ¶ˆä¿¡å·disposable.<br>å½“æˆ‘ä»¬ç”¨mapå‘é€ä¿¡å·çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ™éœ€è¦ä½¿ç”¨ switchToLatestè¿™ä¸ªå‚æ•°æ¥è·å–æœ€åä¸€ä¸ªä¿¡å·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€åæ‰€æ‰“å°çš„xï¼Œå°±æ˜¯mapæœ€åå‘é”™çš„è¿™ä¸ªä¿¡å·ã€‚</p>
<h3 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h3><p>æœªå®Œå¾…ç»­</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/12/31/ReactiveCocoa_exploration/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[iOS9 ä¸­çš„ 3D Touch]]></title>
      <link>http://broccolii.github.io/2015/11/06/iOS9_3D_Touch/</link>
      <guid>http://broccolii.github.io/2015/11/06/iOS9_3D_Touch/</guid>
      <pubDate>Fri, 06 Nov 2015 00:52:23 GMT</pubDate>
      <description>
      <![CDATA[<p>Apple å‘å¸ƒäº† iPhone 6s / 6s Plus,ä¸ºäº† 3D Touch è¿™ä¸ªåŠŸèƒ½æ–°æ¬¾ iPhone å˜å¾—æ›´é‡æ›´åš.æœç„¶æ˜¯ <code>å”¯ä¸€çš„ä¸åŒ,æ˜¯å¤„å¤„éƒ½ä¸åŒ</code>(ç¬‘.è®©æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•ä¸€ä¸‹.</p>
<h4 id="Peek_/_Pop"><a href]]>
      </description>
      <content:encoded><![CDATA[<p>Apple å‘å¸ƒäº† iPhone 6s / 6s Plus,ä¸ºäº† 3D Touch è¿™ä¸ªåŠŸèƒ½æ–°æ¬¾ iPhone å˜å¾—æ›´é‡æ›´åš.æœç„¶æ˜¯ <code>å”¯ä¸€çš„ä¸åŒ,æ˜¯å¤„å¤„éƒ½ä¸åŒ</code>(ç¬‘.è®©æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•ä¸€ä¸‹.</p>
<h4 id="Peek_/_Pop"><a href="#Peek_/_Pop" class="headerlink" title="Peek / Pop"></a>Peek / Pop</h4><p>Peek: è½»å‹,æ“ä½œèƒ½è®©ç”¨æˆ·åœ¨ä¸ç¦»å¼€å½“å‰ç•Œé¢çš„æƒ…å†µä¸‹é¢„è§ˆå†…å®¹.<br>Pop: åˆ™æ˜¯å½“ç”¨æˆ·åœ¨ peek å¼¹å‡ºçš„è§†å›¾ä¸ŠåŠ é‡æŒ‰å‹åŠ›åº¦,æ˜¾ç¤ºæ›´è¯¦ç»†çš„å†…å®¹.</p>
<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ª UITableViewController çš„ä¸»é¡µé¢</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - UITableViewDateSource</span></span><br><span class="line"><span class="keyword">let</span> <span class="type">CellIdentifier</span> = <span class="string">"TableViewCell"</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MainViewController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, numberOfRowsInSection section: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">tableView</span><span class="params">(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath)</span></span> -&gt; <span class="type">UITableViewCell</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> cell = tableView.dequeueReusableCellWithIdentifier(<span class="type">CellIdentifier</span>, forIndexPath: indexPath)</span><br><span class="line">        cell.textLabel!.text = <span class="string">"ç¬¬ <span class="subst">\(indexPath.row)</span> è¡Œ Cell"</span></span><br><span class="line">        <span class="keyword">return</span> cell</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸‹,ç‚¹å‡» Cell ç„¶åå¼¹å‡ºä¸€ä¸ªé¢„è§ˆè§†å›¾<br><img src="https://github.com/broccolii/broccolii.github.io/raw/master/images/iOS9_3D_Touch/Peek.png" alt=""></p>
<p>.å…ˆè®© MainViewControler å®ç° <code>UIViewControllerPreviewingDelegate</code> åè®®</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - UIViewControllerPreviewingDelegate</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MainViewController</span>: <span class="title">UIViewControllerPreviewingDelegate</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è½»æŒ‰ é¢„è§ˆç•Œé¢</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(previewingContext: UIViewControllerPreviewing, viewControllerForLocation location: CGPoint)</span></span> -&gt; <span class="type">UIViewController</span>? &#123;</span><br><span class="line">        <span class="keyword">guard</span> #available(iOS <span class="number">9.0</span>, *) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">debugPrint</span>(<span class="string">"åªæ”¯æŒ iOS 9.0 ä»¥ä¸Šç‰ˆæœ¬"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> indexPath = tableView.indexPathForRowAtPoint(location) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> originRect = tableView.cellForRowAtIndexPath(indexPath)!.frame</span><br><span class="line">        previewingContext.sourceRect = view.convertRect(originRect, fromView: tableView)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/// è¿™é‡Œä¸èƒ½ç›´æ¥è·å–åˆ° æ§ä»¶ è¿˜æœªåˆ›å»º</span></span><br><span class="line">        <span class="keyword">let</span> previewVC = storyboard!.instantiateViewControllerWithIdentifier(<span class="string">"PreviewViewController"</span>) <span class="keyword">as</span>! <span class="type">PreviewViewController</span></span><br><span class="line">        previewVC.previewText = <span class="string">"ä½ ç‚¹å‡»äº† <span class="subst">\(indexPath.row)</span> è¡Œ Cell"</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> previewVC</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡æŒ‰ è¿›å…¥é¡µé¢</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">previewingContext</span><span class="params">(previewingContext: UIViewControllerPreviewing, commitViewController viewControllerToCommit: UIViewController)</span></span> &#123;</span><br><span class="line"><span class="comment">//        å¯ä»¥é€‰æ‹©è·³è½¬æ­£å¸¸ä¸šåŠ¡æµç¨‹çš„ç•Œé¢</span></span><br><span class="line"><span class="comment">//        performSegueWithIdentifier("gotoDetailViewController", sender: nil)</span></span><br><span class="line">        <span class="comment">// ä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥ä½¿ç”¨ preview view controller </span></span><br><span class="line">        showViewController(viewControllerToCommit, sender: <span class="literal">nil</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>æ–¹æ³•ä¸€(Peek): ç”¨æ¥æ˜¾ç¤ºé¢„è§ˆè§†å›¾,é€šè¿‡ <code>location</code> åˆ¤æ–­ç‚¹å‡»äº†å“ªä¸€ä¸ª cell.åœ¨ iOS9 ä¸­æä¾›äº† <code>sourceRect</code> å±æ€§,å¯ä»¥è·å–ç›®æ ‡ Rect,è·å¾—æ›´å¥½çš„å¼¹å‡ºæ•ˆæœ.è¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ <code>previewVC</code> çš„æ§ä»¶è¿˜æœªåˆ›å»ºæ˜¯ nil. å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ§ä»¶èµ‹å€¼,éœ€è¦é€šè¿‡ä¸€ä¸ªå±æ€§,åœ¨ <code>viewDidLoad</code> ä¸­èµ‹å€¼.</li>
<li>æ–¹æ³•äºŒ(Pop): é‡å‡»è¿›å…¥ä¸‹ä¸€ä¸ªé¡µé¢,æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯.è¿™é‡Œå¯ä»¥é€‰æ‹©è·³è½¬åŸæœ¬çš„ä¸šåŠ¡é€»è¾‘,ä¹Ÿå¯ä»¥ç›´æ¥è¿›å…¥ previewVC.</li>
</ol>
<h4 id="Preview_Action"><a href="#Preview_Action" class="headerlink" title="Preview Action"></a>Preview Action</h4><p>åœ¨ peek å¼¹å‡ºé¢„è§ˆè§†å›¾æ—¶,å¯ä»¥ä¸Šæ»‘æ˜¾ç¤ºå‡ ä¸ªæŒ‰é’®,è®©ç”¨æˆ·åšä¸€äº›å¿«é€Ÿæ“ä½œ.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS9_3D_Touch/Preview_Action.png" alt=""></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - preview action</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">PreviewViewController</span> </span>&#123;</span><br><span class="line">    <span class="preprocessor">@available</span>(iOS <span class="number">9.0</span>, *)</span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">previewActionItems</span><span class="params">()</span></span> -&gt; [<span class="type">UIPreviewActionItem</span>] &#123;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">let</span> action1 = <span class="type">UIPreviewAction</span>(title: <span class="string">"action1"</span>, style: .<span class="type">Default</span>) &#123; (action, viewController) -&gt; <span class="type">Void</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">debugPrint</span>(action)</span><br><span class="line">            <span class="built_in">debugPrint</span>(viewController)</span><br><span class="line">            <span class="built_in">debugPrint</span>(<span class="string">"taped action1"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/// ä¼šå¤šä¸€ä¸ª å°å‹¾å‹¾ ğŸ˜Š</span></span><br><span class="line">        <span class="keyword">let</span> action2 = <span class="type">UIPreviewAction</span>(title: <span class="string">"action2"</span>, style: .<span class="type">Selected</span>) &#123; <span class="number">_</span>,<span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">debugPrint</span>(<span class="string">"taped action2"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/// ä¼šå˜çº¢è‰²</span></span><br><span class="line">        <span class="keyword">let</span> action3 = <span class="type">UIPreviewAction</span>(title: <span class="string">"action3"</span>, style: .<span class="type">Destructive</span>) &#123; <span class="number">_</span>,<span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">debugPrint</span>(<span class="string">"taped action3"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [action1, action2, action3]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Home_Screen_Quick_Action"><a href="#Home_Screen_Quick_Action" class="headerlink" title="Home Screen Quick Action"></a>Home Screen Quick Action</h4><p>3D Touch è¿˜å¯ä»¥ç”¨åœ¨ App ICON ä¸Š. æŒ‰å‹ä¼šæ˜¾ç¤º Quick Action,å½“ç”¨æˆ·é€‰æ‹©å…¶ä¸­çš„ Action Itemï¼ŒApp å¯åŠ¨å¹¶è·³è½¬åˆ°ç›¸åº”çš„ç•Œé¢.è¿™ä¸€è¿‡ç¨‹ç›¸å½“äºåœ¨PCä¸Šé¢çš„å³é”®å¿«æ·èœå•çš„åŠŸèƒ½.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS9_3D_Touch/Home_Screen_Quick_Action.png" alt=""><br>Quick Action ä¸»è¦åˆ†æˆ <code>é™æ€å¿«é€Ÿé€‰é¡¹(Static quick actions)</code> å’Œ <code>åŠ¨æ€å¿«é€Ÿé€‰é¡¹(Dynamic quick actions)</code>:</p>
<ul>
<li><code>åŠ¨æ€å¿«é€Ÿé€‰é¡¹(Dynamic quick actions)</code> åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡åŠ è½½åº”ç”¨åå¯ç”¨ã€‚ä½¿ç”¨ UIApplicationShortcutItemã€UIMutableApplicationShortcutItem ä»¥åŠ UIApplicationShortcutIcon ç±»å’Œç›¸å…³çš„APIæ¥å®šä¹‰ åŠ¨æ€å¿«é€Ÿé€‰é¡¹ ã€‚ä½¿ç”¨ shortcutItems å±æ€§æ¥æ·»åŠ åŠ¨æ€å¿«é€Ÿé€‰é¡¹åˆ°åº”ç”¨å…±äº«çš„ UIApplication å¯¹è±¡ä¸­ã€‚</li>
<li><code>é™æ€å¿«é€Ÿé€‰é¡¹(Static quick actions)</code>: å½“ç”¨æˆ·å®‰è£…å®Œåº”ç”¨åç«‹å³å°±èƒ½ä½¿ç”¨ã€‚åœ¨åº”ç”¨çš„ Info.plist æ–‡ä»¶ä¸­çš„UIApplicationShortcutItems æ•°ç»„ä¸­å®šä¹‰ é™æ€å¿«é€Ÿé€‰é¡¹ã€‚</li>
</ul>
<p>åŠ¨æ€å¿«é€Ÿé€‰é¡¹åªéœ€è¦åœ¨ <code>func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?)</code> ä¸­æ·»åŠ ç›¸åº”çš„ <code>shortcutItems</code> å°±å¯ä»¥äº†.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">addShortcutItems</span><span class="params">(application: UIApplication)</span></span> &#123;</span><br><span class="line">   <span class="keyword">guard</span> #available(iOS <span class="number">9.0</span>, *) <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 9.1 è¿˜æœ‰æ›´å¤šå¥½ç©çš„ icon type</span></span><br><span class="line">   <span class="keyword">let</span> itemIcon1 = <span class="type">UIApplicationShortcutIcon</span>(type: .<span class="type">Location</span>)</span><br><span class="line">   <span class="keyword">let</span> item1 = <span class="type">UIMutableApplicationShortcutItem</span>(type: <span class="string">"type1"</span>, localizedTitle: <span class="string">"itemIcon1"</span>, localizedSubtitle: <span class="literal">nil</span>, icon: itemIcon1, userInfo: <span class="literal">nil</span>)</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">let</span> itemIcon2 = <span class="type">UIApplicationShortcutIcon</span>(type: .<span class="type">Share</span>)</span><br><span class="line">   <span class="keyword">let</span> item2 = <span class="type">UIMutableApplicationShortcutItem</span>(type: <span class="string">"type2"</span>, localizedTitle: <span class="string">"itemIcon2"</span>, localizedSubtitle: <span class="literal">nil</span>, icon: itemIcon2, userInfo: <span class="literal">nil</span>)</span><br><span class="line">   </span><br><span class="line">   application.shortcutItems = [item1,item2]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ <code>func application(application: UIApplication, performActionForShortcutItem shortcutItem: UIApplicationShortcutItem, completionHandler: (Bool) -&gt; Void)</code> ä¸­å“åº”ç”¨æˆ·çš„æ“ä½œ,è¿›è¡Œé¡µé¢è·³è½¬</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">@available</span>(iOS <span class="number">9.0</span>, *)</span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, performActionForShortcutItem shortcutItem: UIApplicationShortcutItem, completionHandler: <span class="params">(Bool)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> handled = <span class="literal">false</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> shortcutItem.type == <span class="string">"type1"</span> &#123;</span><br><span class="line">       <span class="comment">// å¤„ç†é¡µé¢è·³è½¬</span></span><br><span class="line">       handled = <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> shortcutItem.type == <span class="string">"type1"</span> &#123;</span><br><span class="line">       handled = <span class="literal">true</span></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   completionHandler(handled)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™æ€å¿«é€Ÿé€‰é¡¹éœ€è¦åœ¨info.plistä¸­æ·»åŠ ä»¥ä¸‹é¡¹ï¼š<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS9_3D_Touch/Static_quick_actions.jpg" alt=""><br><strong>PS: æœ€å¤šå¯ä»¥æ˜¾ç¤º4ä¸ªæ ‡ç­¾ï¼›é™æ€æ ‡ç­¾ä¼˜å…ˆçº§é«˜äºåŠ¨æ€æ ‡ç­¾ï¼›</strong></p>
<h4 id="u68C0_u6D4B_u662F_u5426_u652F_u6301_3D_Touch"><a href="#u68C0_u6D4B_u662F_u5426_u652F_u6301_3D_Touch" class="headerlink" title="æ£€æµ‹æ˜¯å¦æ”¯æŒ 3D Touch"></a>æ£€æµ‹æ˜¯å¦æ”¯æŒ 3D Touch</h4><p>iOS æä¾›äº† <code>forceTouchCapability</code> ç”¨æ¥åˆ¤æ–­ 3D Touch çš„å¯ç”¨æ€§.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">ensure3DTouch</span><span class="params">()</span></span>&#123;</span><br><span class="line">   <span class="keyword">guard</span> #available(iOS <span class="number">9.0</span>, *) <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="built_in">debugPrint</span>(<span class="string">"åªæ”¯æŒ iOS 9.0 ä»¥ä¸Šç‰ˆæœ¬"</span>)</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">guard</span> traitCollection.forceTouchCapability == .<span class="type">Available</span> <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="built_in">debugPrint</span>(<span class="string">"ä¸æ”¯æŒ 3D Touch"</span>)</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   registerForPreviewingWithDelegate(<span class="keyword">self</span>, sourceView: view)</span><br><span class="line">   <span class="built_in">debugPrint</span>(<span class="string">"æ”¯æŒ 3D Touch"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="PS_3A__u5982_u679C_u624B_u5934_u6CA1_u6709_u652F_u6301_3D_Touch__u7684_u8BBE_u5907_2C_u53EF_u4EE5_u4F7F_u7528_SBShortcutMenuSimulator__u8FD9_u4E2A_u63D2_u4EF6_28_u9ED1_u79D1_u6280"><a href="#PS_3A__u5982_u679C_u624B_u5934_u6CA1_u6709_u652F_u6301_3D_Touch__u7684_u8BBE_u5907_2C_u53EF_u4EE5_u4F7F_u7528_SBShortcutMenuSimulator__u8FD9_u4E2A_u63D2_u4EF6_28_u9ED1_u79D1_u6280" class="headerlink" title="PS: å¦‚æœæ‰‹å¤´æ²¡æœ‰æ”¯æŒ 3D Touch çš„è®¾å¤‡,å¯ä»¥ä½¿ç”¨ <a href=" https:="" github.com="" deskconnect="" sbshortcutmenusimulator"="">SBShortcutMenuSimulator</a> è¿™ä¸ªæ’ä»¶(é»‘ç§‘æŠ€">PS: å¦‚æœæ‰‹å¤´æ²¡æœ‰æ”¯æŒ 3D Touch çš„è®¾å¤‡,å¯ä»¥ä½¿ç”¨ <a href="https://github.com/DeskConnect/SBShortcutMenuSimulator" target="_blank" rel="external">SBShortcutMenuSimulator</a> è¿™ä¸ªæ’ä»¶(é»‘ç§‘æŠ€</h6><p><a href="https://github.com/broccolii/3DTouchDemo" target="_blank" rel="external">Demo åœ°å€</a></p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/11/06/iOS9_3D_Touch/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[iOS9 ä¸­çš„ CoreSpotlight]]></title>
      <link>http://broccolii.github.io/2015/10/02/iOS9_CoreSpotlight/</link>
      <guid>http://broccolii.github.io/2015/10/02/iOS9_CoreSpotlight/</guid>
      <pubDate>Fri, 02 Oct 2015 00:52:23 GMT</pubDate>
      <description>
      <![CDATA[<p>Apple å‘å¸ƒäº† iOS9 æ–°ç³»ç»Ÿ,å…¶ä¸­æœ‰ä¸€é¡¹æ–°åŠŸèƒ½ <code>CoreSpotlight</code> å¯ä»¥ä½¿ iPhone çš„ Spotlight è®¿é—® App å†…çš„ä¿¡æ¯,åœ¨æ­¤ä¹‹å‰åªèƒ½é€šè¿‡ App åæ¥æœç´¢ App.è®©æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•ä¸€ä¸‹.</p>
<h4 id="u4]]>
      </description>
      <content:encoded><![CDATA[<p>Apple å‘å¸ƒäº† iOS9 æ–°ç³»ç»Ÿ,å…¶ä¸­æœ‰ä¸€é¡¹æ–°åŠŸèƒ½ <code>CoreSpotlight</code> å¯ä»¥ä½¿ iPhone çš„ Spotlight è®¿é—® App å†…çš„ä¿¡æ¯,åœ¨æ­¤ä¹‹å‰åªèƒ½é€šè¿‡ App åæ¥æœç´¢ App.è®©æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•ä¸€ä¸‹.</p>
<h4 id="u4F7F_u7528_CoreSpotlight"><a href="#u4F7F_u7528_CoreSpotlight" class="headerlink" title="ä½¿ç”¨ CoreSpotlight"></a>ä½¿ç”¨ CoreSpotlight</h4><p> <strong>å¯¼å…¥ CoreSpotlight Framework</strong><br> å…ˆå¯¼å…¥ <code>CoreSpotlight.framework</code><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS9_CoreSpotlight/CoreSpotlight.png" alt=""><br>å’Œ <code>MobileCoreServices.framework</code><br><img src="https://github.com/broccolii/broccolii.github.io/raw/master/images/iOS9_CoreSpotlight/MobileCoreServices.png" alt=""><br><strong>åˆ›å»ºç´¢å¼•æ•°æ®</strong><br>å…ˆåˆ›å»ºä¸€ä¸ªç”¨æˆ· UITableView çš„æ•°æ® Model</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpotlightModel</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> image: <span class="type">UIImage</span>!</span><br><span class="line">    <span class="keyword">var</span> text: <span class="type">String</span>!</span><br><span class="line">    <span class="keyword">var</span> detailText: <span class="type">String</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">createRandomData</span>() -&gt; <span class="title">SpotlightModel</span> </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> model = <span class="type">SpotlightModel</span>()</span><br><span class="line">        model.image = <span class="type">UIImage</span>(named: <span class="string">"image<span class="subst">\(arc4random()</span> % 3)"</span>)</span><br><span class="line">        model.detailText = <span class="string">"detailText<span class="subst">\(arc4random()</span> % 100)"</span></span><br><span class="line">        model.text = <span class="string">"text<span class="subst">\(arc4random()</span> % 300)"</span></span><br><span class="line">        <span class="keyword">return</span> model</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å°† <code>SpotlightModel</code> å¯¹è±¡ä¿å­˜åˆ° CoreSpotlight ä¸­</strong><br>åˆ›å»ºæˆ‘ä»¬éœ€è¦è¢«æœç´¢åˆ°æ•°æ®</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">lazy var tableViewData: [SpotlightModel] = &#123;</span><br><span class="line">   var arr = [<span class="link_label">SpotlightModel</span>](<span class="link_url"></span>)</span><br><span class="line">   for _ in 0..<span class="xml"><span class="tag">&lt;<span class="title">30</span> &#123;</span><br><span class="line">       <span class="attribute">arr.append</span>(<span class="attribute">SpotlightModel.createRandomData</span>())</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="attribute">return</span> <span class="attribute">arr</span></span><br><span class="line">&#125;()</span></span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åˆ†åˆ«ä½¿ç”¨ <code>CSSearchableItem</code> ä¿å­˜å•ä¸ª model å¯¹è±¡çš„ä¿¡æ¯, ç„¶åé€šè¿‡<code>CSSearchableItemAttributeSet</code> è¿™ä¸ªé›†åˆç±»åŠ å…¥åˆ° <code>CSSearchableIndex.defaultSearchableIndex()</code> ä¸­å», è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code>CoreSpotlight</code>,æœç´¢åˆ°æˆ‘ä»¬æä¾›çš„å…ƒæ•°æ®äº†.</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">func addToCoreSpotlight() &#123;</span><br><span class="line">   <span class="keyword">var</span> searchableItems = [CSSearchableItem]()</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span> model <span class="keyword">in</span> tableViewData &#123;</span><br><span class="line">       <span class="keyword">let</span> attri = CSSearchableItemAttributeSet(<span class="attribute">itemContentType</span>: kUTTypeMessage as String)</span><br><span class="line">       </span><br><span class="line">       attri.title = <span class="string">"title"</span> </span><br><span class="line">       attri.contentDescription = <span class="string">"contentDescription"</span></span><br><span class="line">       attri.thumbnailData = UIImageJPEGRepresentation(UIImage(<span class="attribute">named</span>: <span class="string">"image0"</span>)!, <span class="number">0.9</span>)</span><br><span class="line">       attri.supportsPhoneCall = <span class="literal">true</span></span><br><span class="line">       attri.supportsNavigation = <span class="literal">true</span></span><br><span class="line">       attri.phoneNumbers = [<span class="string">"phone"</span>]</span><br><span class="line">       attri.emailAddresses = [<span class="string">"email"</span>]</span><br><span class="line">       attri.keywords = [<span class="string">"keywords"</span>]</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">let</span> searchableItem = CSSearchableItem(<span class="attribute">uniqueIdentifier</span>: model.text, <span class="attribute">domainIdentifier</span>: <span class="string">"com.broccoli"</span>, <span class="attribute">attributeSet</span>: attri)</span><br><span class="line">       searchableItems.append(searchableItem)</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   CSSearchableIndex.defaultSearchableIndex<span class="function"><span class="params">()</span>.<span class="title">indexSearchableItems</span><span class="params">(searchableItems)</span> &#123; <span class="params">(error)</span> -&gt;</span> Void <span class="keyword">in</span></span><br><span class="line">       debugPrint(error)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>uniqueIdentifier: åœ¨åº”ç”¨ç¨‹åºä¸­è¿™ä¸ªå€¼æ˜¯å”¯ä¸€çš„ï¼Œç”±äºè¿™ä¸ªå¯ä»¥ç”¨äºç´¢å¼•çš„æ›´æ–°ã€åˆ é™¤ç´¢å¼•æ˜¯å”¯ä¸€çš„ï¼Œæ¨èä½¿ç”¨UUIDæˆ–è€…æ˜¯æœç´¢çš„æ¡ç›®çš„ä¸»é”®ã€‚</li>
<li>domainIdentifier: ä¸€ä¸ªå¯é€‰çš„æ ‡è¯†ç¬¦ï¼Œç”¨æ¥è¡¨ç¤ºitemçš„åŸŸ(domain)æˆ–è€…æ‰€æœ‰è€…ï¼Œè¿™ä¸ªå¯èƒ½ç”¨ä¸€ä¸ªè´¦æˆ·çš„é‚®ç®±ä½œä¸ºidentifieræ¥ç´¢å¼•æ•°æ®ï¼Œå¹¶ä¸”å½“è´¦æˆ·åˆ é™¤çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™ä¸ªæ¥åˆ é™¤æ•°æ®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹domainIdentifieråº”è¯¥æ˜¯è¿™ç§æ ¼å¼<account-id>.<mailbox-id>å¹¶ä¸”ä¸èƒ½åŒ…å«æ—¶é—´ã€‚</mailbox-id></account-id></li>
<li>expirationDate: è¿‡æœŸçš„æ—¥æœŸï¼Œé»˜è®¤è¿‡æœŸçš„æ—¥æœŸæ˜¯ä¸€ä¸ªæœˆ</li>
</ol>
</blockquote>
<p><strong>å“åº”ç”¨æˆ·ç‚¹å‡»äº‹ä»¶</strong><br>ç°åœ¨è¿è¡Œä¸€ä¸‹ç¨‹åºæœç´¢ <code>title</code> æ˜¯ä¸æ˜¯å¯ä»¥çœ‹åˆ° App ä¸­çš„æ•°æ®.<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS9_CoreSpotlight/ScreenShot.png" alt=""></p>
<p>ä½†æ˜¯ç‚¹å‡»ä¹‹åæˆ‘ä»¬åªèƒ½åˆ° App çš„ä¸»é¡µ,æˆ‘ä»¬å¯ä»¥åœ¨ <code>UIApplicationDelegate</code> ä¸­é€šè¿‡ <code>SearchID</code> è‡ªå®šä¹‰è·³è½¬åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„é¡µé¢</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">application</span><span class="params">(application: UIApplication, continueUserActivity userActivity: NSUserActivity, restorationHandler: <span class="params">([AnyObject]?)</span></span></span> -&gt; <span class="type">Void</span>) -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">   <span class="keyword">let</span> <span class="type">SearchID</span> = userActivity.userInfo?[<span class="string">"kCSSearchableItemActivityIdentifier"</span>] <span class="keyword">as</span>! <span class="type">String</span></span><br><span class="line">   <span class="keyword">let</span> navigationController = (window?.rootViewController <span class="keyword">as</span>! <span class="type">UINavigationController</span>)</span><br><span class="line">   navigationController.popToRootViewControllerAnimated(<span class="literal">false</span>)</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;â€‹</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/broccolii/SpotlightDemo" target="_blank" rel="external">Demo åœ°å€</a></p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/10/02/iOS9_CoreSpotlight/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[iOS ä¸­çš„ UIView å’Œ CALayer]]></title>
      <link>http://broccolii.github.io/2015/04/21/iOS_UIView_CALayer/</link>
      <guid>http://broccolii.github.io/2015/04/21/iOS_UIView_CALayer/</guid>
      <pubDate>Tue, 21 Apr 2015 03:34:21 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="UIView__u548C_CALayer"><a href="#UIView__u548C_CALayer" class="headerlink" title="UIView å’Œ CALayer"></a>UIView å’Œ CALayer</h3><p><str]]>
      </description>
      <content:encoded><![CDATA[<h3 id="UIView__u548C_CALayer"><a href="#UIView__u548C_CALayer" class="headerlink" title="UIView å’Œ CALayer"></a>UIView å’Œ CALayer</h3><p><strong>UIView å¯ä»¥å“åº”äº‹ä»¶</strong><br>ç‚¹è¿› UIView.h æ–‡ä»¶,å¯ä»¥çœ‹åˆ° UIView : UIResponder.UIView æ˜¯ç»§æ‰¿ UIResponder çš„,åœ¨ iOS ä¸­ UIResponder åšä¸ºå“åº”ç³»ç»Ÿä¸­äº‹ä»¶çš„ä¼ é€’è€…å’Œå¤„ç†è€…,æä¾›äº†å¤§é‡äº‹ä»¶å¤„ç†çš„æ¥å£,æ¯”å¦‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesMoved:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesEnded:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br><span class="line">- (<span class="keyword">void</span>)touchesCancelled:(nullable <span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(nullable <span class="built_in">UIEvent</span> *)event;</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠå…³äºç¬¬ä¸€å“åº”è€…çš„ä¸€äº›æ–¹æ³•:</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"> (<span class="constant">BOOL</span>)canBecomeFirstResponder;    <span class="regexp">//</span> default is <span class="constant">NO</span></span><br><span class="line"></span>-<span class="ruby"> (<span class="constant">BOOL</span>)becomeFirstResponder;</span><br><span class="line"></span>-<span class="ruby"> (<span class="constant">BOOL</span>)canResignFirstResponder;    <span class="regexp">//</span> default is <span class="constant">YES</span></span><br><span class="line"></span>-<span class="ruby"> (<span class="constant">BOOL</span>)resignFirstResponder;</span><br><span class="line"></span>-<span class="ruby"> (<span class="constant">BOOL</span>)isFirstResponder;</span></span><br></pre></td></tr></table></figure>
<p><strong>UIView æ˜¯ CALayer çš„ delegate</strong><br>æˆ‘ä»¬ç»§ç»­çœ‹ UIView.h æ–‡ä»¶,æ‰¾åˆ° <code>layer</code> å±æ€§.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>,<span class="keyword">strong</span>)                 <span class="built_in">CALayer</span>  *layer;              <span class="comment">// returns view's layer. Will always return a non-nil value. view is layer's delegate</span></span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šä¸­æœ‰ä¸€å¥ <strong>â€œview is layerâ€™s delegateâ€</strong>,æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª UIView çš„å­ç±» <code>CustomView</code> å¹¶åœ¨ <code>- (void)drawRect:(CGRect)rect</code> æ‰“æ–­ç‚¹,åœ¨å·¦ä¾§çš„å¯ä»¥çœ‹åˆ° CustomView ä½œä¸ºä¸€ä¸ª CALayerDelegate å‡ºç°,<br><img src="https://github.com/broccolii/broccolii.github.io/raw/master/images/iOS_UIView_CALayer/CALayerDelegate.png" alt=""></p>
<p><strong>ä¸¤è€…çš„è”ç³»</strong><br>UIView å†…å®¹çš„ç»˜åˆ¶å’Œæ˜¾ç¤ºéƒ½æ˜¯é  <code>layer</code> å±æ€§æä¾›,è€Œè§†å›¾çš„ç‚¹å‡»äº‹ä»¶åˆ™æ˜¯é€šè¿‡çˆ¶ç±» UIResponder æ¥æ¥æ”¶å¤„ç†.ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«å¯ä»¥çœ‹ä¸€ä¸‹<a href="http://www.jianshu.com/p/079e5cf0f014" target="_blank" rel="external">è¯¦è§£CALayer å’Œ UIViewçš„åŒºåˆ«å’Œè”ç³»</a></p>
<h3 id="frame__u548C_bounds"><a href="#frame__u548C_bounds" class="headerlink" title="frame å’Œ bounds"></a>frame å’Œ bounds</h3><p>ä¸ºäº†æ›´å¥½äº†ç†è§£ <code>frame</code> å’Œ <code>bounds</code>,æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€å¼ å›¾:<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/CAlayer_frame.jpg" alt=""></p>
<ol>
<li>UIView çš„ center ç›´æ¥è°ƒç”¨ rootLayer çš„ position </li>
<li>UIView çš„ bounds ç›´æ¥è°ƒç”¨ rootLayer çš„ bounds</li>
<li>UIView çš„ frame ç›´æ¥è°ƒç”¨ rootLayer çš„ frame</li>
<li>rootLayer çš„ frame åˆæ˜¯ <code>anchorPoint</code>, <code>position</code>, <code>bounds</code>, <code>transform</code> å››ä¸ªå±æ€§çš„æ´¾ç”Ÿå±æ€§<br>æ—¢ç„¶ä¹ä¹å½’ä¸€,æœ€åéƒ½æ˜¯è¿™å››ä¸ªå±æ€§åœ¨å½±å“ç€ frame çš„å¤§å°.æˆ‘ä»¬å…ˆä» <code>anchorPoint</code> å’Œ <code>position</code> ç€æ‰‹,å› ä¸º <code>position</code> æ˜¯ <code>anchorPoint</code> åœ¨ superLayer ä¸Šçš„æŠ•å½±åæ ‡.<br><strong>anchorPoint</strong><br><code>anchorPoint</code> (é”šç‚¹) é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªå›ºå®šç‚¹,åœ¨åš transform æ—¶,ä¼šä»¥ <code>anchorPoint</code> ä½œä¸ºå›ºå®šç‚¹æ—‹è½¬.åœ¨ iOS ä¸­,anchorPoint çš„å€¼æ˜¯ä»¥ç›¸å¯¹ bounds çš„æ¯”ä¾‹å€¼æ¥ç¡®å®šçš„.é»˜è®¤æ˜¯(0.5ï¼Œ0.5),å¦‚æœè§‰å¾—å¤ªæŠ½è±¡å¯ä»¥çœ‹ä¸‹å›¾:</li>
</ol>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/layer_coords_anchorpoint_position_2x-2.png" alt=""><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/anchorpoint2.jpg" alt=""></p>
<p><strong>position</strong><br><code>position</code> çš„å®šä¹‰æ˜¯ <code>The position in the superlayer that the anchor point of the layer&#39;s bounds rect is aligned t</code> position æ˜¯ layer ç›¸å¯¹ superLayer åæ ‡ç©ºé—´çš„ä½ç½®.æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸‹,æˆ‘ä»¬æ˜¯ä¸€æ¡å¾ˆå¤§å¾ˆå¤§çš„é‚®è½®åœåœ¨å¤§è¥¿æ´‹ä¸Š,æˆ‘ä»¬å‘é™†åœ°å‘é€çš„åæ ‡å°±æ˜¯èˆ¹é”šçš„ä½ç½®.èˆ¹é”šçš„ä½ç½®åªèƒ½æ˜¯ç›¸å¯¹äºèˆ¹èº«æ¥è¯´çš„,ç±»æ¯” <code>anchorPoint çš„å€¼æ˜¯ä»¥ç›¸å¯¹ bounds çš„æ¯”ä¾‹å€¼æ¥ç¡®å®šçš„</code>.æ˜¯ä¸æ˜¯å¾ˆå¥½ç†è§£å‘¢(æ‚è„¸é€ƒ<br>PS: è¿™æœ‰ä¸€ç¯‡æ›´å¥½çš„æ–‡ç«  <a href="http://wonderffee.github.io/blog/2013/10/13/understand-anchorpoint-and-position/" target="_blank" rel="external">å½»åº•ç†è§£positionä¸anchorPoint</a></p>
<p><strong>bounds</strong><br>bounds åˆ†ä¸ºä¸¤éƒ¨åˆ†: origin å’Œ size.bounds.size å®šä¹‰äº†å›¾å±‚çš„å¤§å°,bounds.origin å´å¹¶ä¸è¡¨ç¤ºå›¾å±‚çš„ä½ç½®,è€Œæ˜¯å®šäº†å†…éƒ¨åæ ‡ç³»çš„åŸç‚¹.é‚£ä»€ä¹ˆæ˜¯å†…éƒ¨åæ ‡ç³»çš„åŸç‚¹å‘¢?æŒ‡çš„æ˜¯å›¾å±‚å†…éƒ¨å­å›¾å±‚çš„åæ ‡ç³»,å°±æ˜¯è¯´å¦‚æœä¿®æ”¹äº† bounds.origin çš„è‡ªèº«ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–,ä½†æ˜¯åœ¨å…¶å†…éƒ¨çš„å­å›¾å±‚ä¼šå‘ç”Ÿä½ç§».</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span> *lightGrayView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">lightGrayView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.view</span> addSubview:lightGrayView];</span><br><span class="line">    </span><br><span class="line"><span class="built_in">UIView</span> *orangeView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">25</span>, <span class="number">25</span>, <span class="number">50</span>, <span class="number">50</span>)];</span><br><span class="line">orangeView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">[lightGrayView addSubview:orangeView];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/bounds_demo1.png" alt=""><br>ä¿®æ”¹ bounds è¿½åŠ ä»¥ä¸‹ä»£ç <br><code>lightGrayView.layer.bounds = CGRectMake(20, 20, 100, 100);</code><br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/bounds_demo2.png" alt=""></p>
<p><strong>transform</strong><br>ä¸ºä»€ä¹ˆ <code>transform</code> ä¼šå½±å“ frame å‘¢? è®©æˆ‘ä»¬æ¥åŠ¨æ‰‹è¯•ä¸€ä¸‹å§</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIView</span> *redView = [[<span class="built_in">UIView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">redView<span class="variable">.backgroundColor</span> = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">[<span class="keyword">self</span><span class="variable">.view</span> addSubview:redView];</span><br><span class="line">redView<span class="variable">.transform</span> = <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_4);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"redView.frame : --- %@"</span>, <span class="built_in">NSStringFromCGRect</span>(redView<span class="variable">.frame</span>));</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"redView.bounds : --- %@"</span>, <span class="built_in">NSStringFromCGRect</span>(redView<span class="variable">.bounds</span>));</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"redView.layer.frame : --- %@"</span>, <span class="built_in">NSStringFromCGRect</span>(redView<span class="variable">.layer</span><span class="variable">.frame</span>));</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"redView.layer.bounds : --- %@"</span>, <span class="built_in">NSStringFromCGRect</span>(redView<span class="variable">.layer</span><span class="variable">.frame</span>));</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redView.frame : --- <span class="expansion">&#123;&#123;<span class="number">79.289321881345259</span>, <span class="number">79.289321881345245</span>&#125;, &#123;<span class="number">141.42135623730951</span>, <span class="number">141.42135623730951</span>&#125;&#125;</span></span><br><span class="line">redView.bounds : --- <span class="expansion">&#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">100</span>, <span class="number">100</span>&#125;&#125;</span></span><br><span class="line">redView.layer.frame : --- <span class="expansion">&#123;&#123;<span class="number">79.289321881345259</span>, <span class="number">79.289321881345245</span>&#125;, &#123;<span class="number">141.42135623730951</span>, <span class="number">141.42135623730951</span>&#125;&#125;</span></span><br><span class="line">redView.layer.bounds : --- <span class="expansion">&#123;&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, &#123;<span class="number">100</span>, <span class="number">100</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>frame çš„å¤§å°æ˜¯ä¸€ä¸ªåŒ…å«äº†ç»è¿‡è½¬æ¢åçš„é¡¶ç‚¹çš„æœ€å°çŸ©å½¢,å¦‚ä¸‹å›¾ç°æ¡†æ‰€ç¤º:<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/iOS_UIView_CALayer/transform_demo.png" alt=""></p>
<p>é‚£ä¹ˆ frame å’Œè¿™å››ä¸ªå±æ€§ä¹‹é—´åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»å‘¢? åœ¨ä¸è€ƒè™‘ transform çš„æƒ…å†µä¸‹æ˜¯(ä¸‰è§’å‡½æ•°å®åœ¨æ˜¯å¤ªéš¾äº†å•Š!æ‘”:</p>
<blockquote>
<p>frame.origin.x = position.x - anchorPoint.x * bounds.size.width<br>frame.origin.y = position.y - anchorPoint.y * bounds.size.height<br>frame.size.width = bounds.size.width<br>frame.size.height = bounds.size.height</p>
</blockquote>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/04/21/iOS_UIView_CALayer/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[Objective-C ä¸­çš„ Runtime]]></title>
      <link>http://broccolii.github.io/2015/02/19/Objective-C_Runtime/</link>
      <guid>http://broccolii.github.io/2015/02/19/Objective-C_Runtime/</guid>
      <pubDate>Thu, 19 Feb 2015 08:31:53 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="Runtime__u662F_u4EC0_u4E48"><a href="#Runtime__u662F_u4EC0_u4E48" class="headerlink" title="Runtime æ˜¯ä»€ä¹ˆ"></a>Runtime æ˜¯ä»€ä¹ˆ</h3><p>Obje]]>
      </description>
      <content:encoded><![CDATA[<h3 id="Runtime__u662F_u4EC0_u4E48"><a href="#Runtime__u662F_u4EC0_u4E48" class="headerlink" title="Runtime æ˜¯ä»€ä¹ˆ"></a>Runtime æ˜¯ä»€ä¹ˆ</h3><p>Objective-C æ˜¯åŸºäº C è¯­è¨€åŠ å…¥äº†é¢å‘å¯¹è±¡ç‰¹æ€§å’Œæ¶ˆæ¯è½¬å‘æœºåˆ¶çš„åŠ¨æ€è¯­è¨€,å› æ­¤å®ƒå°½å¯èƒ½åœ°å°†ä¸€äº›å·¥ä½œä»ç¼–è¯‘é“¾æ¥æ¨è¿Ÿåˆ°è¿è¡Œæ—¶.è¿™æ„å‘³ç€ä»…ä»…æœ‰ç¼–è¯‘å™¨æ˜¯ä¸å¤Ÿçš„,è¿˜éœ€è¦ä¸€å¥—è¿è¡Œæ—¶ç³»ç»Ÿæ¥æ‰§è¡Œç¼–è¯‘åçš„ä»£ç .è¿™ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªç”¨ C å’Œæ±‡ç¼–å†™çš„ Runtime åº“,å®ƒæ˜¯ Objective-C ä½œä¸ºä¸€é—¨åŠ¨æ€è¯­è¨€çš„æ˜¯åŸºç¡€.è™½ç„¶è¿™äº›ç‰¹æ€§åœ¨å¼€å‘ä¸­ä½¿ç”¨çš„è¾ƒå°‘ï¼Œä½†æ˜¯ç†è§£ Objective-C çš„ Runtime æœºåˆ¶å¯ä»¥å¸®æˆ‘ä»¬æ›´å¥½çš„äº†è§£è¿™ä¸ªè¯­è¨€,åˆç†çš„è¿ç”¨è¿˜èƒ½åœ¨ç³»ç»Ÿå±‚é¢ä¸Šè§£å†³ä¸€äº›æŠ€æœ¯é—®é¢˜.<br>ä½ å¯ä»¥<a href="http://opensource.apple.com/tarballs/objc4/" target="_blank" rel="external">è¿™é‡Œ</a>åœ¨ä¸‹è½½åˆ° Apple ç»´æŠ¤çš„ Runtime æºç ,å¼€å§‹æˆ‘ä»¬çš„æ¢ç´¢.</p>
<h3 id="Runtime_NSObject_/_Class"><a href="#Runtime_NSObject_/_Class" class="headerlink" title="Runtime NSObject / Class"></a>Runtime NSObject / Class</h3><p>æˆ‘ä»¬æ‰“å¼€åˆšåˆšä¸‹è½½çš„æºç ,é€‰æ‹© NSObject.h è¿™ä¸ªæ–‡ä»¶.æˆ‘ä»¬å¯ä»¥çœ‹åˆ° NSObject å°±æ˜¯ä¸€ä¸ªåŒ…å« isa æŒ‡é’ˆçš„ç»“æ„ä½“:</p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="class"><span class="keyword">interface</span> <span class="title">NSObject</span> &lt;<span class="title">NSObject</span>&gt; &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">Class</span> <span class="title">isa</span>  <span class="title">OBJC_ISA_AVAILABILITY</span>;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åœ¨ Objective-C è¯­è¨€çš„å†…éƒ¨,æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåä¸º isa çš„æŒ‡é’ˆ,æŒ‡å‘è¯¥å¯¹è±¡çš„ç±».æ¯ä¸€ä¸ªç±»æè¿°äº†ä¸€ç³»åˆ—å®ƒçš„å®ä¾‹çš„ç‰¹ç‚¹,åŒ…æ‹¬æˆå‘˜å˜é‡çš„åˆ—è¡¨,æˆå‘˜å‡½æ•°çš„åˆ—è¡¨ç­‰.æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥æ¥å—æ¶ˆæ¯,è€Œå¯¹è±¡èƒ½å¤Ÿæ¥æ”¶çš„æ¶ˆæ¯åˆ—è¡¨æ˜¯ä¿å­˜åœ¨å®ƒæ‰€å¯¹åº”çš„ç±»ä¸­.</p>
</blockquote>
<p>æˆ‘ä»¬ç°åœ¨å» runtime.h ä¸­å»çœ‹ä¸€ä¸‹ Class æ˜¯æ€ä¹ˆå®šä¹‰çš„.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class isa  OBJC_ISA_<span class="built_in">AVAILABILITY</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹é¢çš„å˜é‡æ˜¯ä¸ºäº†å…¼å®¹ Objective-C 2.0 ä¹‹å‰çš„ç‰ˆæœ¬ å¯ä»¥å¿½ç•¥</span></span><br><span class="line"><span class="preprocessor">#if !__OBJC2__</span></span><br><span class="line">    <span class="comment">// çˆ¶ç±»</span></span><br><span class="line">    Class super_class                                        OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// ç±»å</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name                                         OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ é»˜è®¤æ˜¯ 0</span></span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// ç±»ä¿¡æ¯,ä¾›è¿è¡ŒæœŸé—´ä½¿ç”¨çš„ä½æ ‡ç¤º</span></span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// ç±»çš„å®ä¾‹å˜é‡å¤§å°</span></span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// å­˜å‚¨ç±»çš„æˆå‘˜å˜é‡çš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list *ivars                             OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// æ–¹æ³•å®šä¹‰çš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">struct</span> objc_method_list **methodLists                    OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// å¸¸ç”¨æ–¹æ³•çš„ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">struct</span> objc_cache *cache                                 OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// åè®®çš„é“¾è¡¨</span></span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list *protocols                     OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line"><span class="preprocessor">#endif</span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br></pre></td></tr></table></figure>
<p>ä½ ä¼šå‘ç° Class ç±»é‡Œå±…ç„¶åªæœ‰ä¸€ä¸ª isa æŒ‡é’ˆ,åˆšåˆšä¸æ˜¯è¯´äº† isa æ˜¯æŒ‡å‘è¯¥å¯¹è±¡çš„ç±»ä¹ˆ?ä¸ºä»€ä¹ˆç±»ä¹Ÿä¼šæœ‰ isa å‘¢?æ ¹æ®ä¸‡ç‰©çš†å¯¹è±¡,å…¶å® Class ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡, é‚£ä¹ˆä»–å¿…é¡»æ˜¯å¦ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å¯¹è±¡,é‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ <code>å…ƒç±»</code>(metaclass).å…ƒç±»å­˜å‚¨ç€ç±»æ–¹æ³•åˆ—è¡¨,å…ƒç±»çš„ isa æŒ‡é’ˆåˆæŒ‡å‘äº† <code>æ ¹å…ƒç±»</code>(root metaclass).<br>æœ‰ä¸€å¼ å…³äº isa å’Œç»§æ‰¿å…³ç³»çš„å›¾,å¯èƒ½ä¼šè®©å¤§å®¶ç†è§£çš„æ›´æ¸…æ™°ä¸€äº›:<br><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Objective-C_Runtime/class-diagram.jpg" alt=""></p>
<p>isa æŒ‡é’ˆçš„å€¼æ˜¯å¯ä»¥è¢«åŠ¨æ€ä¿®æ”¹.iOS ä¸­çš„ KVO çš„å®ç°æœºåˆ¶å°±æ˜¯å°†è¢«è§‚å¯Ÿå¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»è€Œä¸æ˜¯æˆ‘ä»¬æ‰€è§‚å¯Ÿçš„ç±»,è¿™å°±æ˜¯ <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOImplementation.html" target="_blank" rel="external">isa-swizzling</a>.</p>
<hr>
<p>è™½ç„¶ Objective-C 2.0 æ²¡æœ‰æš´éœ²,object_class æ›´å¤šçš„ç»†èŠ‚,æˆ‘ä»¬ä»ç„¶å¯ä»¥ä» Objective-C 1.0 çš„å®šä¹‰ä¸­è·å–æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯.<br><em>Ivar</em> è¡¨ç¤ºç±»çš„æˆå‘˜å˜é‡</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_ivar &#123;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡çš„åå­—</span></span><br><span class="line">    <span class="keyword">char</span> *ivar_name                                          OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">char</span> *ivar_type                                          OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡åœ¨é“¾è¡¨ä¸­çš„ä½ç½®</span></span><br><span class="line">    <span class="keyword">int</span> ivar_offset                                          OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line"><span class="preprocessor">#ifdef __LP64__</span></span><br><span class="line">    <span class="keyword">int</span> space                                                OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line"><span class="preprocessor">#endif</span></span><br><span class="line">&#125;                                                            OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br></pre></td></tr></table></figure>
<p><em>Method</em> è¡¨ç¤ºç±»çš„æ–¹æ³•</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_method &#123;</span><br><span class="line">    <span class="comment">// æ–¹æ³•å</span></span><br><span class="line">    SEL method_name                                          OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// é™æ€æ–¹æ³• / å®ä¾‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">char</span> *method_types                                       OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">    <span class="comment">// æ–¹æ³•å®ç° (å‡½æ•°æŒ‡é’ˆ)</span></span><br><span class="line">    IMP method_imp                                           OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br><span class="line">&#125;                                                            OBJC2_UN<span class="built_in">AVAILABLE</span>;</span><br></pre></td></tr></table></figure>
<p><em>IMP</em> å…¶å®å°±æ˜¯ <code>objc_sendMsg(receiver, selector, arg1, arg2, ...)</code> çš„æŒ‡é’ˆ</p>
<h3 id="Runtime__u6D88_u606F_u5904_u7406_u673A_u5236"><a href="#Runtime__u6D88_u606F_u5904_u7406_u673A_u5236" class="headerlink" title="Runtime æ¶ˆæ¯å¤„ç†æœºåˆ¶"></a>Runtime æ¶ˆæ¯å¤„ç†æœºåˆ¶</h3><p>ä½ æ˜¯å¦æƒ³è¿‡ Objective-C ä¸ºä»€ä¹ˆæŠŠå¯¹è±¡è°ƒç”¨æ–¹æ³•ç§°ä½œ <code>æ¶ˆæ¯ä¼ é€’</code>(æˆ– <code>å‘é€æ¶ˆæ¯</code>) (pass a message).å…¶å®ç¼–è¯‘å™¨ä¼šå°†æˆ‘ä»¬çš„ <code>[receiver selector]</code> ç¿»è¯‘æˆä¸€ä¸ª C å‡½æ•°è°ƒç”¨</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">objc_msgSend</span><span class="params">(receiver, selector)</span></span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥æ·»ä¸Šå‚æ•°</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">objc_sendMsg</span><span class="params">(receiver, selector, arg1, arg2, ...)</span></span></span><br></pre></td></tr></table></figure>
<p>å‘é€æ¶ˆæ¯ä¹‹åä¸€èˆ¬ä¼šç»è¿‡ä¸‹é¢å‡ ä¸ªæ­¥éª¤:</p>
<ol>
<li>é€šè¿‡ receiver çš„ isa æŒ‡é’ˆæ‰¾åˆ°å®ƒçš„ Class </li>
<li>åœ¨ Class çš„ method list æ‰¾ selector </li>
<li>å¦‚æœ Class ä¸­æ²¡åˆ° foo,ç»§ç»­å¾€å®ƒçš„ superclass ä¸­æ‰¾ </li>
<li>ä¸€æ—¦æ‰¾åˆ° selector è¿™ä¸ªå‡½æ•°ï¼Œå°±å»æ‰§è¡Œå®ƒçš„å®ç°IMP<br>ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªæ–¹æ³•æŸ¥æ‰¾çš„æµç¨‹å›¾:</li>
</ol>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Objective-C_Runtime/messaging.PNG" alt=""></p>
<p>å¦‚æœæ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½ç»è¿‡è¿™æ ·ä¸€ä¸ªä¼ é€’é“¾,å…¶å®æ•ˆç‡æ˜¯å¾ˆä½.å› ä¸º class å¾€å¾€åªæœ‰ 20% çš„å‡½æ•°ä¼šè¢«ç»å¸¸è°ƒç”¨,å¦‚æœæŠŠç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•°ç¼“å­˜ä¸‹æ¥,é‚£å¯ä»¥å¤§å¤§æé«˜å‡½æ•°æŸ¥è¯¢çš„æ•ˆç‡.è¿™ä¹Ÿå°±æ˜¯ objc_class ä¸­å¦ä¸€ä¸ªé‡è¦æˆå‘˜ objc_cache åšçš„äº‹æƒ…,å½“å†æ¬¡æ”¶åˆ° selector æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨ cache é‡Œæ‰¾åˆ°ï¼Œé¿å…å»éå† objc_method_list.</p>
<h3 id="Runtime__u6D88_u606F_u8F6C_u53D1_u673A_u5236"><a href="#Runtime__u6D88_u606F_u8F6C_u53D1_u673A_u5236" class="headerlink" title="Runtime æ¶ˆæ¯è½¬å‘æœºåˆ¶"></a>Runtime æ¶ˆæ¯è½¬å‘æœºåˆ¶</h3><p>å¦‚æœèµ°å®Œæ‰€æœ‰æ­¥éª¤,å¦‚æœ selector è¿˜æ˜¯æ²¡æœ‰è¢«æ‰¾åˆ°ä¼šå‘ç”Ÿä»€ä¹ˆ?ç¨‹åºä¼šåœ¨è¿è¡Œæ—¶æŒ‚æ‰å¹¶æŠ›å‡º unrecognized selector çš„å¼‚å¸¸?å…¶å®åœ¨å¼‚å¸¸æŠ›å‡ºå‰,Runtime ä¼šç»™ä½ ä¸‰æ¬¡æ‹¯æ•‘ç¨‹åºçš„æœºä¼šï¼š</p>
<ul>
<li>Method resolution // åŠ¨æ€æ–¹æ³•è§£æ</li>
<li>Fast forwarding        // æ¶ˆæ¯è½¬å‘</li>
<li>Normal forwarding // æ¶ˆæ¯è½¬å‘</li>
</ul>
<p><img src="https://raw.githubusercontent.com/broccolii/broccolii.github.io/master/images/Objective-C_Runtime/Forwarding.png" alt=""><br><em>Method resolution</em><br>é¦–å…ˆï¼ŒObjective-C è¿è¡Œæ—¶ä¼šè°ƒç”¨ <code>+resolveInstanceMethod:</code> æˆ–è€… <code>+resolveClassMethod:</code>,è®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°.å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å› YES,é‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)aSEL &#123;</span><br><span class="line">    <span class="keyword">if</span>(aSEL == <span class="keyword">@selector</span>(foo:))&#123;</span><br><span class="line">        class_addMethod([<span class="keyword">self</span> class], aSEL, (IMP)fooMethod, <span class="string">"v@:"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:aSEL];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> fooMethod(<span class="keyword">id</span> obj, SEL _cmd) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Doing foo"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ resolve æ–¹æ³•æ²¡æœ‰å®ç°æˆ–è€… return NO,å°±ä¼šè¿›åˆ°ä¸‹ä¸€æ­¥ <em>Message Forwarding</em>(æ¶ˆæ¯è½¬å‘)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (id)<span class="string">forwardingTargetForSelector:</span>(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span>(aSelector == <span class="annotation">@selector</span>(<span class="string">foo:</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> alternateObject;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> <span class="string">forwardingTargetForSelector:</span>aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>Normal forwarding</em> ä½ æ˜¯æœ€åä¸€ä¸ªå®ç°æ–¹æ³•çš„æœºä¼š<br>é¦–å…ˆå®ƒä¼šå‘é€ <code>-methodSignatureForSelector:</code> æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹.å¦‚æœ <code>-methodSignatureForSelector:</code> è¿”å› nil,Runtime åˆ™ä¼šå‘å‡º <code>-doesNotRecognizeSelector:</code> æ¶ˆæ¯,ç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†.<br>å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾å,Runtime å°±ä¼šåˆ›å»ºä¸€ä¸ª <code>NSInvocation</code> å¯¹è±¡å¹¶å‘é€ <code>-forwardInvocation:</code> æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡<br><code>NSInvocation</code> å®é™…ä¸Šå°±æ˜¯å¯¹ä¸€ä¸ªæ¶ˆæ¯çš„æè¿°,åŒ…æ‹¬ selector ä»¥åŠå‚æ•°ç­‰ä¿¡æ¯.æ‰€ä»¥ä½ å¯ä»¥åœ¨ <code>-forwardInvocation:</code> é‡Œä¿®æ”¹ä¼ è¿›æ¥çš„ NSInvocation å¯¹è±¡ï¼Œç„¶åå‘é€ -invokeWithTarget: æ¶ˆæ¯ç»™å®ƒï¼Œä¼ è¿›å»ä¸€ä¸ªæ–°çš„ç›®æ ‡</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (NSMethodSignature *)<span class="string">methodSignatureForSelector:</span>(SEL)aSelector</span><br><span class="line">&#123;</span><br><span class="line">    NSMethodSignature *methodSignature = [<span class="keyword">super</span> <span class="string">methodSignatureForSelector:</span>aSelector];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!methodSignature) &#123;</span><br><span class="line">        methodSignature = [NSMethodSignature <span class="string">signatureWithObjCTypes:</span><span class="string">"v@:*"</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> methodSignature;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="typename">void</span>)<span class="string">forwardInvocation:</span>(NSInvocation *)anInvocation</span><br><span class="line">&#123;</span><br><span class="line">    MessageForwarding *messageForwarding = [MessageForwarding <span class="keyword">new</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([messageForwarding <span class="string">respondsToSelector:</span>anInvocation.selector]) &#123;</span><br><span class="line">        [anInvocation <span class="string">invokeWithTarget:</span>messageForwarding];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><em>Method Resolution</em>:ç”±äºMethod Resolutionä¸èƒ½åƒæ¶ˆæ¯è½¬å‘é‚£æ ·å¯ä»¥äº¤ç»™å…¶ä»–å¯¹è±¡æ¥å¤„ç†,æ‰€ä»¥åªé€‚ç”¨äºåœ¨åŸæ¥çš„ç±»ä¸­ä»£æ›¿æ‰.<br><em>Fast Forwarding</em>:å®ƒå¯ä»¥å°†æ¶ˆæ¯å¤„ç†è½¬å‘ç»™å…¶ä»–å¯¹è±¡,ä½¿ç”¨èŒƒå›´æ›´å¹¿,ä¸åªæ˜¯é™äºåŸæ¥çš„å¯¹è±¡.<br><em>Normal Forwarding</em>:å®ƒè·ŸFast Forwardingä¸€æ ·å¯ä»¥æ¶ˆæ¯è½¬å‘,ä½†å®ƒèƒ½é€šè¿‡NSInvocationå¯¹è±¡è·å–æ›´å¤šæ¶ˆæ¯å‘é€çš„ä¿¡æ¯,ä¾‹å¦‚:targetã€selectorã€argumentså’Œè¿”å›å€¼ç­‰ä¿¡æ¯.</p>
<h3 id="Method_Swizzling"><a href="#Method_Swizzling" class="headerlink" title="Method Swizzling"></a>Method Swizzling</h3><p>Objective-C ä¸­çš„ Method Swizzling æ˜¯ä¸€é¡¹å¼‚å¸¸å¼ºå¤§çš„æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å…è®¸æˆ‘ä»¬åŠ¨æ€åœ°æ›¿æ¢æ–¹æ³•çš„å®ç°.å½“æˆ‘ä»¬æƒ³ä¿®æ”¹ç³»ç»Ÿæä¾›çš„ç±»æ—¶,æˆ‘ä»¬èƒ½æœ‰ä»€ä¹ˆåŠæ³•å‘¢ï¼Ÿç»§æ‰¿ç±»å¹¶é‡å†™æ–¹æ³•æ˜¯ä¸€ç§å¯è¡Œçš„åŠæ³•,ä½†æ˜¯å¹¶ä¸èƒ½ç§°ä¸ºæœ€ä¼˜è§£.æˆ‘ä»¬å¯ä»¥é€šè¿‡ Runtime çš„ Method Swizzling,å®ƒé€šè¿‡äº¤æ¢ä¸¤ä¸ª selector çš„ IMP ä»è€Œè¾¾åˆ°<code>å¼ å† ææˆ´</code>çš„æ•ˆ.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/runtime.h&gt;</span> </span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">UIViewController</span> (<span class="title">Tracking</span>) </span></span><br><span class="line"> </span><br><span class="line">+ (<span class="keyword">void</span>)load &#123; </span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken; </span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123; </span><br><span class="line">        Class aClass = [<span class="keyword">self</span> class]; </span><br><span class="line"> </span><br><span class="line">        SEL originalSelector = <span class="keyword">@selector</span>(viewWillAppear:); </span><br><span class="line">        SEL swizzledSelector = <span class="keyword">@selector</span>(xxx_viewWillAppear:); </span><br><span class="line"> </span><br><span class="line">        Method originalMethod = class_getInstanceMethod(aClass, originalSelector); </span><br><span class="line">        Method swizzledMethod = class_getInstanceMethod(aClass, swizzledSelector); </span><br><span class="line">     </span><br><span class="line">        <span class="built_in">BOOL</span> didAddMethod = </span><br><span class="line">            class_addMethod(aClass, </span><br><span class="line">                originalSelector, </span><br><span class="line">                method_getImplementation(swizzledMethod), </span><br><span class="line">                method_getTypeEncoding(swizzledMethod)); </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (didAddMethod) &#123; </span><br><span class="line">            class_replaceMethod(aClass, </span><br><span class="line">                swizzledSelector, </span><br><span class="line">                method_getImplementation(originalMethod), </span><br><span class="line">                method_getTypeEncoding(originalMethod)); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            method_exchangeImplementations(originalMethod, swizzledMethod); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="preprocessor">#pragma mark - Method Swizzling</span></span><br><span class="line">- (<span class="keyword">void</span>)xxx_viewWillAppear:(<span class="built_in">BOOL</span>)animated &#123; </span><br><span class="line">    [<span class="keyword">self</span> xxx_viewWillAppear:animated]; </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"viewWillAppear: %@"</span>, <span class="keyword">self</span>); </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡ Method Swizzling æ›¿æ¢æ‰äº†,ç³»ç»ŸåŸæœ¬çš„ <code>viewWillAppear</code>.</p>
<h3 id="Objective-C_Associated_Objects"><a href="#Objective-C_Associated_Objects" class="headerlink" title="Objective-C Associated Objects"></a>Objective-C Associated Objects</h3><p>æˆ‘ä»¬å¯ä»¥ç”¨ Category å¯¹å·²å­˜åœ¨çš„ç±»æ·»åŠ å®ä¾‹æ–¹æ³•æˆ–ç±»æ–¹æ³•,è€Œä¸é€‚åˆæ·»åŠ é¢å¤–çš„å±æ€§.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Associated Objects æ¥ç»™å·²å­˜åœ¨çš„ç±» Category æ·»åŠ è‡ªå®šä¹‰çš„å±æ€§.<br>Associated Objectsæä¾›ä¸‰ä¸ªAPIæ¥å‘å¯¹è±¡æ·»åŠ ã€è·å–å’Œåˆ é™¤å…³è”å€¼ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OBJC_EXPORT <span class="keyword">void</span> objc_setAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy)</span><br><span class="line">OBJC_EXPORT <span class="keyword">id</span> objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span>(__MAC_10_6, __IPHONE_3_1);</span><br><span class="line">OBJC_EXPORT <span class="keyword">void</span> objc_removeAssociatedObjects(<span class="keyword">id</span> object)</span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span>(__MAC_10_6, __IPHONE_3_1);</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ <code>objc_removeAssociatedObjects</code> è¿™ä¸ªæ–¹æ³•ä¼š remove æ‰æ‰€æœ‰è¯¥å¯¹è±¡çš„ Associated Objects, æ‰€ä»¥è¦è°¨æ…ä½¿ç”¨.ä¸‹é¢æˆ‘ä»¬è¯•ç€ç»™ NSObject æ·»åŠ ä¸€ä¸ª <code>associatedObject</code> å±æ€§.<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// NSObject+AssociatedObject.h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">AssociatedObject</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="keyword">id</span> associatedObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">// NSObject+AssociatedObject.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">AssociatedObject</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setAssociatedObject:(<span class="keyword">id</span>)associatedObject</span><br><span class="line">&#123;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="keyword">@selector</span>(associatedObject), associatedObject, OBJC_ASSO<span class="built_in">CIATION_RETAIN_NONATOMIC</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)associatedObject</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, _cmd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>Associated Objects çš„ key è¦æ±‚æ˜¯å”¯ä¸€å¹¶ä¸”æ˜¯å¸¸é‡,è€ŒSELæ˜¯æ»¡è¶³è¿™ä¸ªè¦æ±‚çš„,æ‰€ä»¥ä¸Šé¢çš„é‡‡ç”¨éšè—å‚æ•° <code>_cmd</code> ä½œä¸º key.</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/02/19/Objective-C_Runtime/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[iOS ä¸­çš„ RunLoop]]></title>
      <link>http://broccolii.github.io/2015/01/31/iOS_Runloop/</link>
      <guid>http://broccolii.github.io/2015/01/31/iOS_Runloop/</guid>
      <pubDate>Fri, 30 Jan 2015 18:11:12 GMT</pubDate>
      <description>
      <![CDATA[<p>æœ€è¿‘å¬äº† <a href="http://blog.sunnyxx.com/" target="_blank" rel="external">sunnyxx</a> å¤§ç¥å…³äº RunLoop çš„åˆ†äº«ä¼š,æ€»ç»“ä¸€ä¸‹ iOS ä¸­çš„ RunLoop.</p>
<h3 id="u4E]]>
      </description>
      <content:encoded><![CDATA[<p>æœ€è¿‘å¬äº† <a href="http://blog.sunnyxx.com/" target="_blank" rel="external">sunnyxx</a> å¤§ç¥å…³äº RunLoop çš„åˆ†äº«ä¼š,æ€»ç»“ä¸€ä¸‹ iOS ä¸­çš„ RunLoop.</p>
<h3 id="u4EC0_u4E48_u662F_RunLoop"><a href="#u4EC0_u4E48_u662F_RunLoop" class="headerlink" title="ä»€ä¹ˆæ˜¯ RunLoop"></a>ä»€ä¹ˆæ˜¯ RunLoop</h3><p>RunLoop é¡¾åæ€ä¹‰æŒ‡çš„æ˜¯è¿è¡Œçš„å¾ªç¯,æŒ‡ä¸€ä¸ªäº‹ä»¶å¤„ç†çš„å¾ªç¯,ç”¨æ¥ä¸åœåœ°è°ƒåŠ¨å·¥ä½œä»¥åŠå¤„ç†è¾“å…¥äº‹ä»¶.é€šä¿—ç‚¹è¯´RunLoop å¥½æ¯”ä¸€ä¸ª While å¾ªç¯,ä¸åœåœ°åœ¨ç›‘å¬äº‹ä»¶,å¤„ç†äº‹ä»¶.ä¸è¿‡ Apple åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†å¤§é‡ä¼˜åŒ–,ä½¿å¾—å¤§å¤§å‡å°‘äº† CPU çš„å ç”¨.æ¯”å¦‚ç»™ RunLoop æ·»åŠ äº†ä¸åŒäº‹ä»¶æº,ä¸åŒçš„ mode,ä½¿å…¶åœ¨ä¸å·¥ä½œæ—¶ä¼‘çœ ç­‰.ä¸è¿‡ RunLoop å¹¶ä¸æ˜¯ iOS / OS X æ‰€ç‰¹æœ‰çš„,åœ¨ä»»ä½•å¹³å°çš„å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­,ä¸ºäº†å¤„ç†å¼‚æ­¥æ¶ˆæ¯,éƒ½æœ‰è¿™æ ·ä¸€ä¸ªç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ¦‚å¿µ,æ¯”å¦‚ Android ä¸­çš„ Looper.</p>
<h3 id="RunLoop__u548C_u7EBF_u7A0B_u7684_u5173_u7CFB"><a href="#RunLoop__u548C_u7EBF_u7A0B_u7684_u5173_u7CFB" class="headerlink" title="RunLoop å’Œçº¿ç¨‹çš„å…³ç³»"></a>RunLoop å’Œçº¿ç¨‹çš„å…³ç³»</h3><p>RunLoop å’Œ iOS çš„çº¿ç¨‹æ˜¯ç´§å¯†ç›¸è¿çš„,åœ¨ iOS ä¸­ä»»ä½•çº¿ç¨‹,å¦‚æœè¦ç›‘å¬å¤„ç†ä¸€äº›äº‹ä»¶éƒ½éœ€è¦äº§ç”Ÿä¸€ä¸ª RunLoop çš„å¯¹è±¡.ä¸»çº¿ç¨‹ä¸­çš„ RunLoop åœ¨ App å¯åŠ¨æ—¶äº§ç”Ÿå¹¶è¿è¡Œ,å­çº¿ç¨‹ä¸­éœ€è¦æ‰‹åŠ¨åˆ›å»ºå¹¶è¿è¡Œ(<code>[NSRunLoop currentRunLoop];</code> ä¼šåˆ¤æ–­æ˜¯å¦æœ‰ RunLoop ,è€Œè‡ªåŠ¨åˆ›å»º).ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªçº¿ç¨‹ä¸­éƒ½å¯ä»¥è·å– RunLoop å¯¹è±¡ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ RunLoop çš„å®ä¾‹å¯¹è±¡.</p>
<h3 id="RunLoop_mode"><a href="#RunLoop_mode" class="headerlink" title="RunLoop mode"></a>RunLoop mode</h3><p>RunLoop è¿è¡Œæ—¶,å®ƒä¼šæ˜¾å¼æˆ–éšå¼åœ°æŒ‡å®šä¸€ä¸ªmode.å¹¶åªèƒ½ä»¥ä¸€ç§å›ºå®šçš„æ¨¡å¼è¿è¡Œ,åªä¼šç›‘å¬è¿™ä¸ª mode ä¸‹æ·»åŠ çš„ Time Source å’Œ Input Source.å¦‚æœè¿™ä¸ªæ¨¡å¼ä¸‹æ²¡æœ‰æ·»åŠ äº‹ä»¶æº,RunLoopä¼šç«‹åˆ»é€€å‡º.å¤§å¤šæ•°æ—¶å€™,Run Loop éƒ½æ˜¯è¿è¡Œåœ¨ç³»ç»Ÿå®šä¹‰çš„é»˜è®¤æ¨¡å¼ä¸Š.åŒç†ä¹Ÿåªæœ‰ä¸è¿™ä¸ª mode å…³è”çš„ observer æ‰ä¼šè¢«é€šçŸ¥.å’Œå…¶ä»– mode å…³è”çš„äº‹ä»¶æºåªæœ‰å½“ Run Loop è¿è¡Œåœ¨å¯¹åº”çš„ mode ä¸‹æ‰ä¼šåˆ†å‘ç›¸åº”çš„äº‹ä»¶è¿‡æ¥ï¼Œå¦åˆ™å°±å¤„äºæš‚åœçŠ¶æ€ã€‚<br>åœ¨ Cocoa ä¸­å®šä¹‰çš„ mode ä¸»è¦çš„æ˜¯é‚£ä¹ˆå‡ ç§:</p>
<blockquote>
<ol>
<li>CFRunLoopDefaultMode: è¿™ä¸ªæ˜¯é»˜è®¤ mode,ä¹Ÿæ˜¯ç©ºé—²çŠ¶æ€.ä¸»çº¿ç¨‹é€šå¸¸åœ¨è¿™ä¸ª mode ä¸‹è¿è¡Œçš„</li>
<li>UITrackingRunLoopMode: å½“ ScrollView æ»šåŠ¨æ—¶å€™çš„æ¨¡å¼</li>
<li>UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ç¨‹åºæ—¶è¿›å…¥çš„ç¬¬ä¸€ä¸ª mode,å¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨</li>
<li>GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨çš„ mode</li>
<li>CFRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªé›†åˆ,åŒ…å«äº† 1,2 ä¸¤ç§æ¨¡å¼</li>
</ol>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ CFRunLoopCommonModes å…¶å®å¹¶ä¸æ˜¯ä¸€ç§ mode,è€Œæ˜¯ä¸€ä¸ªé›†åˆ.å› æ­¤ RunLoop å¹¶ä¸èƒ½åœ¨CFRunLoopCommonModesä¸‹è¿è¡Œ.ä½†æ˜¯ä½ å¯ä»¥å°†éœ€è¦è¾“å…¥çš„äº‹ä»¶æºæ·»åŠ ä¸ºè¿™ä¸ª mode,è¿™æ ·æ— è®º RunLoop è¿è¡Œåœ¨å“ªä¸ª mode ä¸‹éƒ½å¯ä»¥å“åº”è¿™ä¸ªè¾“å…¥äº‹ä»¶,å¦åˆ™è¿™ä¸ªäº‹ä»¶å°†ä¸ä¼šå¾—åˆ°å“åº”.</p>
<p>è¿™é‡Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€äº› RunLoop çš„å‘:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[NSTimer <span class="string">scheduledTimerWithTimeInterval:</span><span class="number">1.0</span> <span class="string">target:</span>self <span class="string">selector:</span><span class="annotation">@selector</span>(foo) <span class="string">userInfo:</span>nil <span class="string">repeats:</span>YES];</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨,ä½†æ˜¯æˆ‘ä»¬ç”¨è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ NSTimer ä¼šè¢«åŠ åˆ° CFRunLoopDefaultMode ä¸­,æ­¤æ—¶,å¦‚æœé¡µé¢å¼€å§‹æ»šåŠ¨ ä¸»çº¿ç¨‹ RunLoop çš„ mode ä¼šåˆ‡æ¢åˆ° UITrackingRunLoopMode,æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ NSTimer å°±ä¸ä¼šè¿è¡Œ.æˆ‘ä»¬å¯ä»¥å°†æ–°å»ºçš„ NSTimer æ”¾åˆ°<br> CFRunLoopCommonModes ä¸­,è¿™æ ·ä¸è®ºåœ¨ä»€ä¹ˆçŠ¶æ€éƒ½æ˜¯å¯ä»¥æ‰§è¡Œçš„.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSTimer *timer = [NSTimer <span class="string">timerWithTimeInterval:</span><span class="number">1.0</span> <span class="string">target:</span>self <span class="string">selector:</span><span class="annotation">@selector</span>(foo) <span class="string">userInfo:</span>nil <span class="string">repeats:</span>YES];</span><br><span class="line">[[NSRunLoop currentRunLoop] <span class="string">addTimer:</span>timer <span class="string">forMode:</span>NSRunLoopCommonModes];</span><br></pre></td></tr></table></figure>
<h3 id="RunLoop_sources"><a href="#RunLoop_sources" class="headerlink" title="RunLoop sources"></a>RunLoop sources</h3><p>ä¸‹å›¾å±•ç¤ºäº† RunLoop çš„æ¨¡å‹: å¯ä»¥çœ‹å‡º RunLoop æ˜¯çº¿ç¨‹ä¸­çš„ä¸€ä¸ªå¾ªç¯,å¹¶æ¥æ”¶ä¸¤ä¸ªäº‹ä»¶æºçš„æ¶ˆæ¯:<br>Input sources å’Œ Timer sources<br><img src="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Multithreading/Art/runloop.jpg" alt=""><br><strong>Input sources:</strong><br>Input source ç”¨æ¥æŠ•é€’å¼‚æ­¥æ¶ˆæ¯,é€šå¸¸æ¶ˆæ¯æ¥è‡ªå¦å¤–çš„çº¿ç¨‹æˆ–è€…ç¨‹åº.<br>æ¶ˆæ¯ç±»å‹åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§:</p>
<p><em>1) Port Input Source</em></p>
<p>Cocoa å’Œ Core Foundation æä¾›äº† Mach Port ç”¨äºçº¿ç¨‹æˆ–è¿›ç¨‹é—´çš„é€šä¿¡.<br>å¦‚æœè¦å»ºç«‹å’Œ NSMachPort å¯¹è±¡çš„æœ¬åœ°è¿æ¥,ä½ éœ€è¦åˆ›å»ºç«¯å£å¯¹è±¡å¹¶åŠ å…¥ä¸»çº¿ç¨‹çš„ RunLoop é‡Œ.å½“è¿è¡Œå­çº¿ç¨‹çš„æ—¶å€™,ä½ ä¼ é€’ç«¯å£å¯¹è±¡åˆ°å­çº¿ç¨‹çš„å…¥å£.å­çº¿ç¨‹é€šè¿‡ç«¯å£å¯¹è±¡å°†æ¶ˆæ¯ä¼ å…¥ä¸»çº¿ç¨‹.</p>
<p>é¦–å…ˆåœ¨ä¸»çº¿ç¨‹å»ºç«‹ç«¯å£å¯¹è±¡,å¹¶åœ¨æ¬¡çº¿ç¨‹çš„å¯åŠ¨æ—¶å°†ç«¯å£å¯¹è±¡ä¼ å…¥:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®ä¸»çº¿ç¨‹ port,å­çº¿ç¨‹é€šè¿‡æ­¤ç«¯å£å‘é€æ¶ˆæ¯ç»™ä¸»çº¿ç¨‹</span></span><br><span class="line"><span class="built_in">NSPort</span> *myPort = [<span class="built_in">NSMachPort</span> port];</span><br><span class="line"><span class="keyword">if</span> (myPort) &#123;</span><br><span class="line">    myPort<span class="variable">.delegate</span> = <span class="keyword">self</span>;</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addPort:myPort forMode:<span class="built_in">NSDefaultRunLoopMode</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯åŠ¨å­çº¿ç¨‹,å¹¶ä¼ å…¥ç«¯å£ä¿¡æ¯</span></span><br><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(launchThreadWithPort:) toTarget:	 [MyWorkerClass class] withObject:myPort];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>2) Cocoa Perform Selector Sources</em></p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(void)</span>performSelectorOnMainThread:<span class="params">(<span class="variable">SEL</span>)</span>aSelector withObject:<span class="params">(nullable id)</span>arg waitUntilDone:<span class="params">(<span class="variable">BOOL</span>)</span>wait modes:<span class="params">(nullable <span class="variable">NSArray</span>&lt;<span class="variable">NSString</span> *&gt; *)</span>array;</span><br><span class="line">- <span class="params">(void)</span>performSelectorOnMainThread:<span class="params">(<span class="variable">SEL</span>)</span>aSelector withObject:<span class="params">(nullable id)</span>arg waitUntilDone:<span class="params">(<span class="variable">BOOL</span>)</span>wait;</span><br><span class="line">- <span class="params">(void)</span>performSelector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector onThread:<span class="params">(<span class="variable">NSThread</span> *)</span>thr withObject:<span class="params">(nullable id)</span>arg waitUntilDone:<span class="params">(<span class="variable">BOOL</span>)</span>wait modes:<span class="params">(nullable <span class="variable">NSArray</span>&lt;<span class="variable">NSString</span> *&gt; *)</span>array NS_AVAILABLE<span class="params">(<span class="number">10</span>_5, <span class="number">2</span>_0)</span>;</span><br><span class="line">- <span class="params">(void)</span>performSelector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector onThread:<span class="params">(<span class="variable">NSThread</span> *)</span>thr withObject:<span class="params">(nullable id)</span>arg waitUntilDone:<span class="params">(<span class="variable">BOOL</span>)</span>wait NS_AVAILABLE<span class="params">(<span class="number">10</span>_5, <span class="number">2</span>_0)</span>;</span><br><span class="line">- <span class="params">(void)</span>performSelector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector withObject:<span class="params">(nullable id)</span>anArgument afterDelay:<span class="params">(<span class="variable">NSTimeInterval</span>)</span>delay inModes:<span class="params">(<span class="variable">NSArray</span>&lt;<span class="variable">NSString</span> *&gt; *)</span>modes;</span><br><span class="line">- <span class="params">(void)</span>performSelector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector withObject:<span class="params">(nullable id)</span>anArgument afterDelay:<span class="params">(<span class="variable">NSTimeInterval</span>)</span>delay;</span><br><span class="line">+ <span class="params">(void)</span>cancelPreviousPerformRequestsWithTarget:<span class="params">(id)</span>aTarget selector:<span class="params">(<span class="variable">SEL</span>)</span>aSelector object:<span class="params">(nullable id)</span>anArgument;</span><br><span class="line">+ <span class="params">(void)</span>cancelPreviousPerformRequestsWithTarget:<span class="params">(id)</span>aTarget;</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº› API ä¸­,æœ€åä¸¤ä¸ªæ˜¯å–æ¶ˆå½“å‰çº¿ç¨‹ä¸­çš„ aSelector è°ƒç”¨,å…¶ä»–çš„ API æ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡ŒæŒ‡å®šçš„ aSelector</p>
<p><strong>Timer source:</strong></p>
<p>Timer Source ç±»å‹çš„äº‹ä»¶æº,å°±æ˜¯åˆ›å»ºTimeræ·»åŠ åˆ°RunLoopä¸­.åœ¨Cocoaé‡Œ,ä½¿ç”¨NSTimeråˆ›å»ºå®šæ—¶å™¨åŠ å…¥ RunLoop,åœ¨ Core Foundation é‡Œä½¿ç”¨ CFRunLoopTimerRef ç±»å‹,æœ¬è´¨ä¸Š NSTimer æ˜¯CFRunLoopTimerRefçš„ç®€å•æ‰©å±•.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSTimer *timer = [NSTimer <span class="string">timerWithTimeInterval:</span><span class="number">1.0</span> <span class="string">target:</span>self <span class="string">selector:</span><span class="annotation">@selector</span>(foo) <span class="string">userInfo:</span>nil <span class="string">repeats:</span>YES];</span><br><span class="line">[[NSRunLoop currentRunLoop] <span class="string">addTimer:</span>timer <span class="string">forMode:</span>NSRunLoopCommonModes]</span><br></pre></td></tr></table></figure>
<h3 id="RunLoop_Observer"><a href="#RunLoop_Observer" class="headerlink" title="RunLoop Observer"></a>RunLoop Observer</h3><p>å¯¹æ¯”ä¸Šé¢è¯´çš„ sources,å®ƒä»¬æ˜¯åœ¨ç‰¹å®šçš„åŒæ­¥äº‹ä»¶æˆ–å¼‚æ­¥äº‹ä»¶å‘ç”Ÿæ—¶è¢«è§¦å‘,RunLoop observer å°±ä¸ä¸€æ ·äº†,å®ƒæ˜¯åœ¨ RunLoop æ‰§è¡Œè‡ªå·±çš„ä»£ç åˆ°æŸä¸€ä¸ªæŒ‡å®šçŠ¶æ€æ—¶è¢«è§¦å‘.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">CF_OPTIONS</span><span class="params">(CFOptionFlags, CFRunLoopActivity)</span> </span>&#123;</span><br><span class="line">    kCFRunLoopEntry = (<span class="number">1U</span>L &lt;&lt; <span class="number">0</span>),</span><br><span class="line">    kCFRunLoopBeforeTimers = (<span class="number">1U</span>L &lt;&lt; <span class="number">1</span>),</span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1U</span>L &lt;&lt; <span class="number">2</span>),</span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1U</span>L &lt;&lt; <span class="number">5</span>),</span><br><span class="line">    kCFRunLoopAfterWaiting = (<span class="number">1U</span>L &lt;&lt; <span class="number">6</span>),</span><br><span class="line">    kCFRunLoopExit = (<span class="number">1U</span>L &lt;&lt; <span class="number">7</span>),</span><br><span class="line">    kCFRunLoopAllActivities = <span class="number">0x0FFFFFFF</span>U</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CFRunLoopObserverContext</span>  context = &#123;<span class="number">0</span>, (__bridge <span class="keyword">void</span> *)(<span class="keyword">self</span>), <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"><span class="built_in">CFRunLoopObserverRef</span> observer = <span class="built_in">CFRunLoopObserverCreate</span>(k<span class="built_in">CFAllocatorDefault</span>, k<span class="built_in">CFRunLoopBeforeTimers</span>, <span class="literal">YES</span>, <span class="number">0</span>, &amp;runLoopObserver, &amp;context);</span><br><span class="line"><span class="keyword">if</span> (observer) &#123;</span><br><span class="line">	<span class="built_in">CFRunLoopAddObserver</span>(<span class="built_in">CFRunLoopGetCurrent</span>(), observer, k<span class="built_in">CFRunLoopCommonModes</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content:encoded>
      <comments>http://broccolii.github.io/2015/01/31/iOS_Runloop/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[iOS ä¸­çš„å¤šçº¿ç¨‹]]></title>
      <link>http://broccolii.github.io/2014/09/29/iOS_multithreading/</link>
      <guid>http://broccolii.github.io/2014/09/29/iOS_multithreading/</guid>
      <pubDate>Mon, 29 Sep 2014 15:56:35 GMT</pubDate>
      <description>
      <![CDATA[<p>æ•´ç†äº†ä¸€ä¸‹ iOS å¼€å‘ä¸­ä¼šé‡åˆ°çš„å‡ ç§å¤šçº¿ç¨‹.</p>
<h3 id="iOS__u4E2D_u7684_u591A_u7EBF_u7A0B_u7F16_u7A0B"><a href="#iOS__u4E2D_u7684_u591A_u7EBF_u7A0B_u7F16_u7]]>
      </description>
      <content:encoded><![CDATA[<p>æ•´ç†äº†ä¸€ä¸‹ iOS å¼€å‘ä¸­ä¼šé‡åˆ°çš„å‡ ç§å¤šçº¿ç¨‹.</p>
<h3 id="iOS__u4E2D_u7684_u591A_u7EBF_u7A0B_u7F16_u7A0B"><a href="#iOS__u4E2D_u7684_u591A_u7EBF_u7A0B_u7F16_u7A0B" class="headerlink" title="iOS ä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹"></a>iOS ä¸­çš„å¤šçº¿ç¨‹ç¼–ç¨‹</h3><p>iOS ä¸­çš„å¤šçº¿ç¨‹åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§: NSThread, NSOperation/NSOperationQueue, GCD. å…¶ä¸­ NSOperation/NSOperationQueue æ˜¯å¯¹ GCD çš„é¢å‘å¯¹è±¡å°è£….</p>
<h3 id="u57FA_u672C_u6982_u5FF5"><a href="#u57FA_u672C_u6982_u5FF5" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h3><h3 id="u7EBF_u7A0B_/__u8FDB_u7A0B"><a href="#u7EBF_u7A0B_/__u8FDB_u7A0B" class="headerlink" title="çº¿ç¨‹ / è¿›ç¨‹"></a>çº¿ç¨‹ / è¿›ç¨‹</h3><ul>
<li>è¿›ç¨‹(Process):æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½,è®¡ç®—æœºä¸­å·²è¿è¡Œç¨‹åºçš„å®ä½“.</li>
<li>çº¿ç¨‹(thread):æ“ä½œç³»ç»Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½,å®ƒè¢«åŒ…å«åœ¨è¿›ç¨‹ä¹‹ä¸­,æ˜¯è¿›ç¨‹ä¸­çš„å®é™…è¿ä½œå•ä½.ä¸€ä¸ªè¿›ç¨‹ä¸­è‡³å°‘åŒ…å«ä¸€æ¡çº¿ç¨‹,å³ä¸»çº¿ç¨‹.</li>
</ul>
<h4 id="u540C_u6B65_/__u5F02_u6B65"><a href="#u540C_u6B65_/__u5F02_u6B65" class="headerlink" title="åŒæ­¥ / å¼‚æ­¥"></a>åŒæ­¥ / å¼‚æ­¥</h4><ul>
<li>åŒæ­¥:åŒæ­¥æ“ä½œä¼šç­‰å¾…æ“ä½œæ‰§è¡Œå®Œæˆå,å†ç»§ç»­æ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç .(ä¼šå µå¡å½“å‰çº¿ç¨‹)    </li>
<li>å¼‚æ­¥:å¼‚æ­¥æ“ä½œåœ¨è°ƒç”¨åç«‹å³è¿”å›,ä¸ä¼šç­‰å¾…æ“ä½œçš„æ‰§è¡Œç»“æœ.(ä¸ä¼šå µå¡å½“å‰çº¿ç¨‹)</li>
</ul>
<h4 id="u4E32_u884C_u961F_u5217_/__u5E76_u884C_u961F_u5217"><a href="#u4E32_u884C_u961F_u5217_/__u5E76_u884C_u961F_u5217" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ— / å¹¶è¡Œé˜Ÿåˆ—"></a>ä¸²è¡Œé˜Ÿåˆ— / å¹¶è¡Œé˜Ÿåˆ—</h4><ul>
<li>é˜Ÿåˆ—: é˜Ÿåˆ— (queue),æ˜¯å…ˆè¿›å…ˆå‡ºï¼ˆFIFO, First-In-First-Outï¼‰çš„çº¿æ€§è¡¨.</li>
<li>ä¸²è¡Œé˜Ÿåˆ—: ä¸²è¡Œé˜Ÿåˆ—æ˜¯æŒ‡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ˜¯æŒ‰ç…§å…ˆåé¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œçš„,é˜Ÿé¦–çš„ä»»åŠ¡æ‰§è¡Œåæ‰ä¼šæ‰§è¡Œå…¶åçš„ä»»åŠ¡,ç›´è‡³æ‰§è¡Œåˆ°é˜Ÿå°¾çš„ä»»åŠ¡.</li>
<li>å¹¶è¡Œé˜Ÿåˆ—:å¹¶è¡Œé˜Ÿåˆ—æ˜¯æŒ‡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¯ä»¥åŒæ—¶åœ°æ‰§è¡Œ,å³å¼€å§‹æ‰§è¡Œé˜Ÿé¦–çš„ä»»åŠ¡å,ä¸å¿…ç­‰å…¶æ‰§è¡Œå®Œæ¯•å°±å¯ä»¥æ¥ç€å¼€å§‹æ‰§è¡Œé˜Ÿé¦–ä¹‹åçš„ä»»åŠ¡,å› æ­¤åœ¨æŸä¸€æ—¶åˆ»å¯èƒ½å­˜åœ¨åŒæ—¶æ‰§è¡Œçš„å¤šä¸ªä»»åŠ¡.</li>
</ul>
<p><strong>åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­è¿›è¡Œå¼‚æ­¥æ“ä½œ,ä¼šå‘ç”Ÿä»€ä¹ˆ?</strong></p>
<blockquote>
<ol>
<li>åŠ å…¥çš„ä¸²è¡Œé˜Ÿåˆ—æ˜¯æ‰‹åŠ¨åˆ›å»ºçš„,é‚£ä¹ˆä¼šå¦å¼€çº¿ç¨‹æ‰§è¡Œ,ä»è€Œä¸ä¼šå µå¡å½“å‰çº¿ç¨‹.</li>
<li>å¦‚æœåŠ å…¥çš„æ˜¯å½“å‰çº¿ç¨‹çš„ä¸²è¡Œé˜Ÿåˆ—,é‚£ä¹ˆä¼šå µå¡å½“å‰çº¿ç¨‹.æ¯”å¦‚: å°†å¼‚æ­¥æ“ä½œæ”¾åˆ° main é˜Ÿåˆ—(é€šè¿‡ GCD çš„ <code>dispatch_get_main_queue()</code> è·å–).</li>
</ol>
</blockquote>
<p><strong>åœ¨å¹¶è¡Œé˜Ÿåˆ—ä¸­è¿›è¡ŒåŒæ­¥æ“ä½œ,ä¼šå‘ç”Ÿä»€ä¹ˆ?</strong><br>ç›´æ¥å µå¡å½“å‰çº¿ç¨‹,ç›´è‡³åŒæ­¥æ“ä½œæ‰§è¡Œå®Œ.</p>
<p>è¯¦ç»†ç»†èŠ‚è¯·çœ‹<a href="http://www.cnblogs.com/dsxniubility/p/4296937.html" target="_blank" rel="external">è‘£é“‚ç„¶çš„Blog</a><br>ä¸‹å›¾è¡¨<a href="https://github.com/ChenYilong/ParseSourceCodeStudy/blob/master/01_Parseçš„å¤šçº¿ç¨‹å¤„ç†æ€è·¯/GCDæ‰«ç›²ç¯‡.md" target="_blank" rel="external">å¼•ç”¨è‡ª ChenYilong çš„ GCD æ‰«ç›²ç¯‡</a></p>
<table>
<thead>
<tr>
<th>â€”</th>
<th>åŒæ­¥</th>
<th>å¼‚æ­¥ </th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸²è¡Œé˜Ÿåˆ—</td>
<td>ä¸ä¼šæ–°å»ºçº¿ç¨‹ï¼Œä¾ç„¶åœ¨å½“å‰çº¿ç¨‹ä¸Š<p></p>ç±»ä¼¼åŒæ­¥é”ï¼Œæ˜¯åŒæ­¥é”çš„æ›¿ä»£æ–¹æ¡ˆ<p></p>âœ… å¸¸ç”¨</td>
<td>ä¼šæ–°å»ºçº¿ç¨‹ï¼Œåªå¼€ä¸€æ¡çº¿ç¨‹<p></p>ä¸€æ¡çº¿ç¨‹å°±å¤Ÿäº†<p></p> æ¯æ¬¡ä½¿ç”¨ createDispatch æ–¹æ³•å°±ä¼šæ–°å»ºä¸€æ¡çº¿ç¨‹ï¼Œå¤šæ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä¼šåˆ›å»ºå¤šæ¡çº¿ç¨‹ï¼Œå¤šæ¡çº¿ç¨‹é—´ä¼šå¹¶è¡Œæ‰§è¡Œ</td>
</tr>
<tr>
<td>å¹¶è¡Œé˜Ÿåˆ—</td>
<td>ä¸ä¼šæ–°å»ºçº¿ç¨‹ï¼Œä¾ç„¶åœ¨å½“å‰çº¿ç¨‹ä¸Š<p></p></td>
<td>ä¼šæ–°å»ºçº¿ç¨‹ï¼Œå¯ä»¥å¼€å¤šæ¡çº¿ç¨‹<p></p> iOS7-SDK æ—¶ä»£ä¸€èˆ¬æ˜¯5ã€6æ¡ï¼Œ iOS8-SDK ä»¥åå¯ä»¥50ã€60æ¡ <p></p> âœ… å¸¸ç”¨</td>
</tr>
</tbody>
</table>
<h3 id="NSThread"><a href="#NSThread" class="headerlink" title="NSThread"></a>NSThread</h3><p>åœ¨ iOS ä¸­ä½¿ç”¨ NSThread å¯¹è±¡å»ºç«‹ä¸€ä¸ªçº¿ç¨‹éå¸¸æ–¹ä¾¿,ä½†æ˜¯çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸéœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç†,ä¹Ÿä¸ä¾¿äºç®¡ç†å¤šä¸ªçº¿ç¨‹.<br><strong>åˆ›å»º&amp;å¯åŠ¨</strong><br><em>ä¸¤ç§æ˜¾å¼è°ƒç”¨</em><br>1.å®ä¾‹æ–¹æ³•</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSThread *thread = [[NSThread alloc] <span class="string">initWithTarget:</span>self <span class="string">selector:</span><span class="annotation">@selector</span>(<span class="string">doSomething:</span>) <span class="string">object:</span>nil];</span><br><span class="line">[thread start];</span><br></pre></td></tr></table></figure>
<p>2.ç±»æ–¹æ³•</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[NSThread <span class="string">detachNewThreadSelector:</span><span class="annotation">@selector</span>(<span class="string">doSomething:</span>) <span class="string">toTarget:</span>self <span class="string">withObject:</span>nil];</span><br></pre></td></tr></table></figure>
<p><em>éšå¼è°ƒç”¨</em></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self <span class="string">performSelectorInBackground:</span><span class="annotation">@selector</span>(<span class="string">doSomething:</span>) <span class="string">withObject:</span>nil];</span><br></pre></td></tr></table></figure>
<p><strong>ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å¾—å½“å‰çº¿ç¨‹</span></span><br><span class="line">+ (<span class="built_in">NSThread</span> *)currentThread;</span><br><span class="line"><span class="comment">// çº¿ç¨‹ä¼‘çœ </span></span><br><span class="line">+ (<span class="keyword">void</span>)sleepForTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti;</span><br><span class="line"><span class="comment">// è·å–ä¸»çº¿ç¨‹</span></span><br><span class="line">+ (<span class="built_in">NSThread</span> *)mainThread;</span><br><span class="line"><span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸»çº¿ç¨‹</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isMainThread;</span><br><span class="line">+ (<span class="built_in">BOOL</span>)isMainThread;</span><br><span class="line"><span class="comment">// åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isExecuting;</span><br><span class="line"><span class="comment">// åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å·²ç»“æŸ</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)isFinished;</span><br></pre></td></tr></table></figure>
<h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><p>GCD æŒ‡çš„æ˜¯ Grand Central Dispatch, æ˜¯ Apple æä¾›çš„ä¸€ä¸ªå¤šæ ¸ç¼–ç¨‹çš„è§£å†³æ–¹æ¡ˆ.GCD æ˜¯åŸºäº C è¯­è¨€çš„æ¡†æ¶,å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸,æ˜¯ Apple æ¨èä½¿ç”¨çš„å¤šçº¿ç¨‹æŠ€æœ¯.ä»–ä¸éœ€è¦åƒ NSThread ä¸€æ ·éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ,å®ƒä¼šè‡ªåŠ¨ç®¡ç†.<br><strong>GCD ä¸­çš„é˜Ÿåˆ—</strong></p>
<ul>
<li>ä¸²è¡Œé˜Ÿåˆ—</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"serialQueue"</span>, DISPATCH_QUEUE_SERIAL);</span><br></pre></td></tr></table></figure>
<ul>
<li>å¹¶è¡Œé˜Ÿåˆ—</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"concurrentQueue"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—:</p>
<ul>
<li>main é˜Ÿåˆ—(ä¸²è¡Œé˜Ÿåˆ—)</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t mainQueue = <span class="function"><span class="title">dispatch_get_main_queue</span><span class="params">()</span></span>ï¼›</span><br></pre></td></tr></table></figure>
<p>å’Œ NSThread ä¸­çš„ <code>+ (NSThread *)mainThread;</code> ä¸€æ ·,ç”¨äºè·å– main é˜Ÿåˆ—, å³ å½“å‰è¿›ç¨‹çš„ä¸»çº¿ç¨‹.</p>
<blockquote>
<p>åœ¨ä¸»é˜Ÿåˆ—é‡Œé¢æ‰§è¡ŒåŒæ­¥æ‰§è¡Œä»»åŠ¡ä¼šé€ æˆæ­»é”ç°è±¡ <a href="http://www.brighttj.com/ios/ios-gcd-deadlock.html" target="_blank" rel="external">è¯¦æƒ…è¯·çœ‹</a></p>
</blockquote>
<ul>
<li>å…¨å±€é˜Ÿåˆ—(å¹¶è¡Œé˜Ÿåˆ—)<br>GCD é»˜è®¤å·²ç»æä¾›äº†å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—,ä¾›æ•´ä¸ªåº”ç”¨ä½¿ç”¨,ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º.</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤æƒé™çš„ å…¨å±€é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">dispatch_queue_t</span> defaultQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// æœ‰ä»¥ä¸‹å‡ ç§æƒé™</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> DISPATCH_QUEUE_PRIORITY_HIGH <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> DISPATCH_QUEUE_PRIORITY_DEFAULT <span class="number">0</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> DISPATCH_QUEUE_PRIORITY_LOW (-<span class="number">2</span>)</span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> DISPATCH_QUEUE_PRIORITY_BACKGROUND INT16_MIN</span></span><br></pre></td></tr></table></figure>
<p><strong>GCD çš„åŒæ­¥/å¼‚æ­¥</strong><br>åœ¨ é»˜è®¤æƒé™ä¸‹çš„å…¨å±€é˜Ÿåˆ— ä¸­æ‰§è¡Œ åŒæ­¥æ“ä½œ</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_sync<span class="list">(<span class="keyword">dispatch_get_global_queue</span><span class="list">(<span class="keyword">DISPATCH_QUEUE_PRIORITY_DEFAULT</span>, <span class="number">0</span>)</span>, ^&#123;</span><br><span class="line">        // åŒæ­¥æ‰§è¡Œçš„ä»£ç </span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ é»˜è®¤æƒé™ä¸‹çš„å…¨å±€é˜Ÿåˆ— ä¸­æ‰§è¡Œ å¼‚æ­¥æ“ä½œ</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async<span class="list">(<span class="keyword">dispatch_get_global_queue</span><span class="list">(<span class="keyword">DISPATCH_QUEUE_PRIORITY_DEFAULT</span>, <span class="number">0</span>)</span>, ^&#123;</span><br><span class="line">        // å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>dispatch_once</strong><br><code>dispatch_once</code> ä¿è¯åœ¨ App è¿è¡ŒæœŸé—´,block ä¸­çš„ä»£ç åªæ‰§è¡Œä¸€æ¬¡.<br>ä¸€èˆ¬ç”¨åœ¨å®ç°å•ä¾‹æ¨¡å¼ä¸Š:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">id</span> _instance;</span><br><span class="line"></span><br><span class="line">+ (instancetype)sharedSingleton&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        _instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (instancetype)allocWithZone:(<span class="keyword">struct</span> _<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        _instance = [<span class="keyword">super</span> allocWithZone:zone];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>dispatch_after</strong><br><code>dispatch_after</code> å»¶è¿Ÿä¸€æ®µæ—¶é—´æŠŠä¸€é¡¹ä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—ä¸­æ‰§è¡Œ,è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯: å»¶æ—¶çš„æ“ä½œæ˜¯æäº¤,è€Œä¸æ˜¯è¿è¡Œ.</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">dispatch_after</span>(<span class="function">dispatch_time</span>(DISPATCH_TIME_NOW, (int64_t)(<span class="number">10</span> * NSEC_PER_SEC)), <span class="tag">dispatch_get_main_queue</span>(), ^&#123;</span><br><span class="line">        <span class="comment">// å»¶è¿Ÿæ“ä½œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>dispatch_group</strong><br>æˆ‘ä»¬ä½¿ç”¨ <code>group</code> æ¥ç®¡ç†ä¸€ç»„å¼‚æ­¥ä»£ç ,å½“å®ƒä»¬éƒ½æ‰§è¡Œå®Œåä¼šè°ƒç”¨åŒæ­¥æˆ–è€…å¼‚æ­¥(<code>dispatch_group_notify</code>)å›è°ƒé€šçŸ¥æˆ‘ä»¬.</p>
<p><em>å¼‚æ­¥å›è°ƒ</em></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_group_t <span class="keyword">group</span> = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_notify(<span class="keyword">group</span>, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">   <span class="comment">// å½“æ‰€æœ‰å¼‚æ­¥æ‰§è¡Œçš„ä»£ç æ‰§è¡Œå®Œæ¯•ä¼šè¿›å…¥</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>åŒæ­¥å›è°ƒ</em></p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_group_t <span class="keyword">group</span> = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line">dispatch_group_async(<span class="keyword">group</span>, <span class="built_in">queue</span>, ^&#123;</span><br><span class="line">   <span class="comment">// å¼‚æ­¥æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">dispatch_group_wait(<span class="keyword">group</span>, DISPATCH_TIME_FOREVER);</span><br></pre></td></tr></table></figure>
<p>æ³¨: <code>dispatch_group_wait</code> ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¶…æ—¶æ—¶é—´. <code>DISPATCH_TIME_FOREVER</code> è¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æ—¶é—´.</p>
<p><strong>dispatch_apply</strong><br><code>dispatch_apply</code> ç”¨äºé‡å¤æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡,ä»¥åŒæ­¥çš„æ–¹å¼æŠŠä»»åŠ¡è¿½åŠ åˆ°é˜Ÿåˆ—å½“ä¸­.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_apply(<span class="number">3</span>, <span class="built_in">queue</span>, ^(<span class="keyword">size_t</span> index) &#123;</span><br><span class="line">   NSLog(@<span class="string">"%zu"</span>, index);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2016</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">18</span>:<span class="number">07</span>:<span class="number">35.923</span> MultithreadingDemo[<span class="number">5626</span>:<span class="number">397563</span>] <span class="number">0</span></span><br><span class="line"><span class="number">2016</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">18</span>:<span class="number">07</span>:<span class="number">35.923</span> MultithreadingDemo[<span class="number">5626</span>:<span class="number">397617</span>] <span class="number">1</span></span><br><span class="line"><span class="number">2016</span>-<span class="number">01</span>-<span class="number">08</span> <span class="number">18</span>:<span class="number">07</span>:<span class="number">35.923</span> MultithreadingDemo[<span class="number">5626</span>:<span class="number">397831</span>] <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p><strong>dispatch_suspend &amp; dispatch_resume</strong><br><code>dispatch_suspend</code> ç”¨äºæš‚åœé˜Ÿåˆ—<br><code>dispatch_resume</code> ç”¨äºæ¢å¤é˜Ÿåˆ—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// æŒ‚èµ·æŒ‡å®šçš„é˜Ÿåˆ—</span></span><br><span class="line">dispatch_suspend(<span class="built_in">queue</span>);</span><br><span class="line"><span class="comment">// æ¢å¤æŒ‡å®šé˜Ÿåˆ—</span></span><br><span class="line">dispatch_resume(<span class="built_in">queue</span>);</span><br></pre></td></tr></table></figure>
<h3 id="NSOperation/NSOperationQueue"><a href="#NSOperation/NSOperationQueue" class="headerlink" title="NSOperation/NSOperationQueue"></a>NSOperation/NSOperationQueue</h3><p>NSOperation/NSOperationQueue æ˜¯ Apple å¯¹ GCD çš„å°è£…,ä¸€ä¸ªå»ºç«‹åœ¨ GCD çš„åŸºç¡€ä¹‹ä¸Šçš„,é¢å‘å¯¹è±¡çš„è§£å†³æ–¹æ¡ˆ.ç›¸å¯¹ GCD æ¥è¯´,ä½¿ç”¨ NSOperation/NSOperationQueue ä¼šå¢åŠ ä¸€ç‚¹ç‚¹é¢å¤–çš„å¼€é”€,ä¸æ­¤åŒæ—¶ä¹Ÿä¹Ÿè·å¾—äº†æ›´å¥½çš„çµæ´»æ€§.æˆ‘ä»¬å¯ä»¥æŒ‡å®šå„ä¸ª NSOperation ä¹‹é—´çš„ä¾èµ–å…³ç³»,ä¹Ÿå¯ä»¥ç»§æ‰¿ NSOperation å®ç°å¯å¤ç”¨çš„é€»è¾‘æ¨¡å—.</p>
<p><strong>NSOperation</strong><br>NSOperation ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªéœ€è¦æ‰§è¡Œçš„ä»»åŠ¡.NSOperation æœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»,ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–,ä½†æ˜¯ç³»ç»Ÿæä¾›äº†ä¸¤ä¸ªå­ç±»ç”¨äºå°è£…ä»»åŠ¡.åˆ†åˆ«æ˜¯: NSInvocationOperation å’Œ NSBlockOperation,åŒæ—¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å­ç±».åˆ›å»ºä¸€ä¸ª NSOperation å¯¹è±¡å,éœ€è¦è°ƒç”¨ start æ–¹æ³•æ¥å¯åŠ¨ä»»åŠ¡,éœ€è¦æ³¨æ„çš„æ˜¯å®ƒä¼šé»˜è®¤åœ¨å½“å‰é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œ.</p>
<ul>
<li>NSInvocationOperation<br>é€šè¿‡ä¸€ä¸ª object å’Œ selector æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ›å»ºä¸€ä¸ª NSInvocationOperation.</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSInvocationOperation</span> *operation = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(doSomething) object:<span class="literal">nil</span>];</span><br><span class="line">[operation start];</span><br></pre></td></tr></table></figure>
<ul>
<li>NSBlockOperation<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨  NSBlockOperation æ¥å¹¶å‘æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ª block. å¯ä»¥é€šè¿‡NSBlockOperationçš„å®ä¾‹æ–¹æ³• <code>addExecutionBlock</code> å®ç°ç±»ä¼¼ GCD ä¸­çš„ <code>dispatch_group</code> çš„åŠŸèƒ½.</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSBlockOperation</span> *operation = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">   <span class="comment">// do something</span></span><br><span class="line">&#125;];</span><br><span class="line">[operation start];</span><br></pre></td></tr></table></figure>
<p><em>ä½¿ç”¨æœ‰ NSOperation æœ‰ä»€ä¹ˆçµæ´»æ€§å‘¢?</em><br>1.ä¾èµ–å…³ç³»<br>NSOperation æœ‰ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½,é‚£å°±æ˜¯æ·»åŠ ä¾èµ–.å®ƒå¯ä»¥è®©ä¸€ä¸ª operation åªæœ‰åœ¨å®ƒä¾èµ–çš„æ‰€æœ‰ operation éƒ½æ‰§è¡Œå®Œæˆåæ‰èƒ½å¼€å§‹æ‰§è¡Œ.</p>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="pp">- <span class="params">(void)</span>addDependency:<span class="params">(<span class="variable">NSOperation</span> *)</span>op;</span></span><br></pre></td></tr></table></figure>
<p>2.é˜Ÿåˆ—ä¸­çš„ä¼˜å…ˆçº§<br>å¯¹äºè¢«æ·»åŠ åˆ° queue ä¸­çš„ operation æ¥è¯´ï¼Œåœ¨ isReady(å–å†³äºä¾èµ–å…³ç³») çŠ¶æ€ä¸‹,å†³å®šå®ƒä»¬æ‰§è¡Œé¡ºåºä»–ä»¬åœ¨é˜Ÿåˆ—ä¸­çš„ä¼˜å…ˆçº§.é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ normal çš„,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é€šè¿‡ <code>setQueuePriority:</code> æ–¹æ³•æ¥æé«˜æˆ–é™ä½ operation çš„é˜Ÿåˆ—ä¼˜å…ˆçº§.æœ‰ä»¥ä¸‹å‡ ç§ä¼˜å…ˆçº§ç»™æˆ‘ä»¬é€‰æ‹©.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSOperationQueuePriority</span>) &#123;</span><br><span class="line">	<span class="built_in">NSOperationQueuePriorityVeryLow</span> = -<span class="number">8</span>L,</span><br><span class="line">	<span class="built_in">NSOperationQueuePriorityLow</span> = -<span class="number">4</span>L,</span><br><span class="line">	<span class="built_in">NSOperationQueuePriorityNormal</span> = <span class="number">0</span>,</span><br><span class="line">	<span class="built_in">NSOperationQueuePriorityHigh</span> = <span class="number">4</span>,</span><br><span class="line">	<span class="built_in">NSOperationQueuePriorityVeryHigh</span> = <span class="number">8</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>3.å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œè¿›è¡Œå›è°ƒ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[operation1 <span class="built_in">set</span>CompletionBlock:^&#123;</span><br><span class="line">    // <span class="keyword">do</span> something  </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>NSOperationQueue</strong><br>NSOperationQueue å¹¶ä¸åƒ GCD ä¸­çš„é˜Ÿåˆ—é‚£ä¹ˆå¤æ‚.é»˜è®¤éƒ½æ˜¯å¹¶è¡Œçš„,é€šè¿‡è®¾ç½® NSOperationQueue çš„ <code>maxConcurrentOperationCount</code> å±æ€§ä¸ºä¸€.é‚£ä¹ˆå®ƒå°±å˜æˆäº†ä¸²è¡Œé˜Ÿåˆ—.NSOperationQueue æä¾›äº†è·å– main é˜Ÿåˆ—çš„æ–¹æ³•.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ (NSOperationQueue *)<span class="function">mainQueue <span class="title">NS_AVAILABLE</span><span class="params">(<span class="number">10</span>_6, <span class="number">4</span>_0)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨ </p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSOperationQueue *queue = <span class="comment">[<span class="comment">[NSOperationQueue alloc]</span> init]</span>;</span><br></pre></td></tr></table></figure>
<p>è¿›è¡Œåˆå§‹åŒ–åˆ›å»º,ç„¶åé€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹æ³•æ·»åŠ ä»»åŠ¡,å¦‚æœä½¿ç”¨äº†ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•,é‚£ä¹ˆè‡ªåŠ¨æ‰§è¡Œäº† NSOperation çš„ <code>start</code> æ–¹æ³•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ ä¸€ä¸ªNSOperation</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperation:(NSOperation *)op;</span><br><span class="line"><span class="comment">// æ·»åŠ ä¸€ç»„NSOperation</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperations:(NSArray&lt;NSOperation *&gt; *)ops waitUntilFinished:(BOOL)<span class="function">wait <span class="title">NS_AVAILABLE</span><span class="params">(<span class="number">10</span>_6, <span class="number">4</span>_0)</span></span>;</span><br><span class="line"><span class="comment">// ä»¥ block çš„å½¢å¼ æ·»åŠ ä»»åŠ¡(ä»£æ›¿ NSBlockOperation)</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperationWithBlock:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))<span class="function">block <span class="title">NS_AVAILABLE</span><span class="params">(<span class="number">10</span>_6, <span class="number">4</span>_0)</span></span>;</span><br></pre></td></tr></table></figure>
]]></content:encoded>
      <comments>http://broccolii.github.io/2014/09/29/iOS_multithreading/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[Objective-C ä¸­çš„ Block]]></title>
      <link>http://broccolii.github.io/2014/07/28/Objective-C_Block/</link>
      <guid>http://broccolii.github.io/2014/07/28/Objective-C_Block/</guid>
      <pubDate>Sun, 27 Jul 2014 17:11:02 GMT</pubDate>
      <description>
      <![CDATA[<h3 id="u4EC0_u4E48_u662F_Block"><a href="#u4EC0_u4E48_u662F_Block" class="headerlink" title="ä»€ä¹ˆæ˜¯ Block"></a>ä»€ä¹ˆæ˜¯ Block</h3><p>Block ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯å—]]>
      </description>
      <content:encoded><![CDATA[<h3 id="u4EC0_u4E48_u662F_Block"><a href="#u4EC0_u4E48_u662F_Block" class="headerlink" title="ä»€ä¹ˆæ˜¯ Block"></a>ä»€ä¹ˆæ˜¯ Block</h3><p>Block ç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯å—,é¡¾åæ€ä¹‰æŒ‡çš„æ˜¯ä»£ç å—.ä¸å‡½æ•°ç±»ä¼¼,æœ‰å‚æ•°,æœ‰è¿”å›å€¼.åªä¸è¿‡æ˜¯ç›´æ¥å®ç°åœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œçš„,åŒæ—¶å¯ä»¥è·å–è¯¥å‡½æ•°çš„å±€éƒ¨å˜é‡. Block åªæ˜¯ Objective-C å¯¹é—­åŒ…çš„å®ç°.</p>
<blockquote>
<p>è®²äººè¯:  Block å°±æ˜¯ä¸€æ®µèƒ½å¤Ÿåœ¨å°†æ¥è¢«æ‰§è¡Œçš„ä»£ç . Block æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ Objective-C å¯¹è±¡.æ­£å› ä¸ºå®ƒæ˜¯å¯¹è±¡ï¼ŒBlock å¯ä»¥è¢«ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå¯ä»¥ä½œä¸ºè¿”å›å€¼ä»ä¸€ä¸ªæ–¹æ³•è¿”å›ï¼Œå¯ä»¥ç”¨æ¥ç»™å˜é‡èµ‹å€¼</p>
</blockquote>
<h3 id="Block__u7684_u7533_u660E_u5B9A_u4E49"><a href="#Block__u7684_u7533_u660E_u5B9A_u4E49" class="headerlink" title="Block çš„ç”³æ˜å®šä¹‰"></a>Block çš„ç”³æ˜å®šä¹‰</h3><p>å¯ä»¥å…ˆçœ‹ä¸€ä¸‹ <a href="http://fuckingblocksyntax.com" target="_blank" rel="external">How Do I Declare A Block in Objective-C?</a><br>Block çš„å£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">returnType (^blockName)(parameterTypes) = ^returnType(parameters) <span class="decorator">&#123;...&#125;</span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ªåŠ æ³•åŠŸèƒ½çš„ Block</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> (^addBlock)(<span class="keyword">int</span> a, <span class="keyword">int</span> b) = ^(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">   <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååƒå‡½æ•°ä¸€æ ·è°ƒç”¨è¿™ä¸ª Block </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> add = addBlock(<span class="number">1</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Block__u7684_u53D8_u91CF"><a href="#Block__u7684_u53D8_u91CF" class="headerlink" title="Block çš„å˜é‡"></a>Block çš„å˜é‡</h3><p>è¿˜è®°å¾—æˆ‘ä»¬åˆšåˆšè¯´è¿‡ Block ä¼šè·å–å®ç°å®ƒçš„å‡½æ•°å†…çš„å±€éƒ¨å˜é‡,å¹¶ä¸”å¯¹è¿™äº›æ ˆå˜é‡è¿›è¡Œä¸€æ¬¡åªè¯»æ‹·è´ï¼Œç„¶ååœ¨  Block å—å†…ä½¿ç”¨è¯¥åªè¯»æ‹·è´.</p>
<ol>
<li>åªè¯»: ä¸èƒ½è¢«ä¿®æ”¹å€¼</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    <span class="keyword">int</span> stackVariables = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> (^addBlock)(<span class="keyword">int</span> a, <span class="keyword">int</span> b) = ^ <span class="keyword">int</span> (<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">        stackVariables++; <span class="comment">// ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> add = addBlock(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.copy: åœ¨å®šä¹‰å®Œ Block å ä¿®æ”¹äº† stackVariables çš„å€¼, ä½†æ˜¯ Block å¹¶ä¸å—å½±å“</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    <span class="keyword">int</span> stackVariables = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> (^addBlock)(<span class="keyword">int</span> a, <span class="keyword">int</span> b) = ^ <span class="keyword">int</span> (<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"stack variable = %ld"</span>, (<span class="keyword">long</span>)stackVariables);</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹ stackVariables çš„å€¼</span></span><br><span class="line">    stackVariables = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> add = addBlock(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦åœ¨ Block ä¸­ä¿®æ”¹å±€éƒ¨å˜é‡çš„å€¼, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ __block å…³é”®å­—æ¥ä¿®é¥°å˜é‡,è¿™æ ·å°±å¯ä»¥åœ¨ Block ä¸­ä¿®æ”¹å˜é‡äº†.å¯¹äºç”¨ __block ä¿®é¥°çš„å±€éƒ¨å˜é‡ï¼ŒBlock ä¸ºå…¶ç”Ÿæˆäº†ä¸€ä¸ª Struct æ¥å­˜å‚¨å¼•ç”¨åœ°å€.å…·ä½“ç»†èŠ‚å¯ä»¥çœ‹å”å·§å¤§ç¥å†™çš„<a href="http://blog.devtang.com/blog/2013/07/28/a-look-inside-blocks/" target="_blank" rel="external">è°ˆObjective-C Blockçš„å®ç°</a></p>
<h3 id="retain_cycle"><a href="#retain_cycle" class="headerlink" title="retain cycle"></a>retain cycle</h3><p>Block ä½¿ç”¨æ—¶,ä¸ä»”ç»†æ€é‡,å°±å¾ˆå®¹æ˜“å‡ºç°å¾ªç¯å¼•ç”¨,å¯¼è‡´å†…å­˜æ³„éœ².é‚£åˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿå¾ªç¯å¼•ç”¨å‘¢?<br>æˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸‹åˆšåˆšçš„ Block å°†ä»–å®šä¹‰æˆ å½“å‰ç±»çš„ä¸€ä¸ªå±æ€§,åŒæ—¶åœ¨ Block å®šä¹‰æ—¶,æ‰“å°å½“å‰ç±»çš„ä¸€ä¸ªå±æ€§</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (^AddBlock)(<span class="keyword">int</span> a, <span class="keyword">int</span> b);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) AddBlock addBlock;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSString</span> *memberVariable;</span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    <span class="keyword">int</span> stackVariables = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">  	 _addBlock = ^ <span class="keyword">int</span> (<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">      	<span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, _memberVariable);</span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹ stackVariables çš„å€¼</span></span><br><span class="line">    stackVariables = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> add = addBlock(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨ foo ä¸­å®šä¹‰äº†ä¸€ä¸ª æ ˆ Block ç„¶åæŠŠå®ƒå¤åˆ¶åˆ° _addBlock ä¸­å», ç”±äºæ˜¯ä»æ ˆ copy åˆ°å †,(è¿™é‡Œè¦è¯´ä¸€ä¸‹: åœ¨å¼€å¯äº† ARC çš„æƒ…å†µä¸‹,å› ä¸ºç¼–è¯‘å™¨è‡ªåŠ¨å¸®æˆ‘ä»¬ copy äº†,æ‰€ä»¥æˆ‘ä»¬å†™ Block çš„å±æ€§è¯æ—¶,ç”¨ copy å’Œ strong éƒ½æ˜¯ä¸€æ ·çš„, ä½†æ˜¯è¿˜æ˜¯æ¨èä½¿ç”¨ copy å•¦,å¯ä»¥æé†’æˆ‘ä»¬ç¼–è¯‘å™¨æ›¿æˆ‘ä»¬åšäº† copy æ“ä½œğŸ˜Š)  Block ä¼šæŒæœ‰ Block ä¸­çš„å˜é‡.åœ¨ ARC ä¸‹, Block ä¸­å¦‚æœå¼•ç”¨äº† __strong ä¿®é¥°ç¬¦çš„è‡ªåŠ¨å˜é‡,åˆ™ç›¸å½“äº Block å¯¹è¯¥å˜é‡çš„å¼•ç”¨è®¡æ•°+1. ç”±äº self æ˜¯ __strong ä¿®é¥°.å› æ­¤ self æŒæœ‰äº† Block, åŒæ—¶ Block ä¹ŸæŒæœ‰äº† self.å½“ self é‡Šæ”¾çš„æ—¶å€™,éœ€è¦ Block é‡Šæ”¾åæ‰ä¼šå¯¹ self è¿›è¡Œé‡Šæ”¾,ä½†æ˜¯ Block çš„é‡Šæ”¾åˆéœ€è¦ç­‰ self çš„ dealloc æ–¹æ³•ä¸­æ‰ä¼šé‡Šæ”¾.å¦‚æ­¤ä¸€æ¥å˜å½¢æˆäº†å¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ³„éœ².</p>
<p>ä½ å¯èƒ½è¦é—®äº†,æˆ‘è¿™é‡Œå¹¶æ²¡æœ‰å‡ºç° self ?ä¸ºä»€ä¹ˆ self ä¼šè¢« Block æŒæœ‰?</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å…¶å® <span class="constant">_memberVariable </span>ç­‰ä»·äº <span class="keyword">self</span>-&gt;memberVariable</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æ‰“ç ´å¾ªç¯,æˆ‘ä»¬éœ€è¦å–æ¶ˆå¼•ç”¨å¯ä»¥å°† self ç”¨ __weak æ‰€ä¿®é¥°</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> (^AddBlock)(<span class="keyword">int</span> a, <span class="keyword">int</span> b);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) AddBlock addBlock;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSString</span> *memberVariable;</span><br><span class="line">...</span><br><span class="line">- (<span class="keyword">void</span>)foo &#123;</span><br><span class="line">    <span class="keyword">int</span> stackVariables = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">	 __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">  	 _addBlock = ^ <span class="keyword">int</span> (<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">      	<span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, weakSelf<span class="variable">.memberVariable</span>);</span><br><span class="line">     </span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹ stackVariables çš„å€¼</span></span><br><span class="line">    stackVariables = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> add = addBlock(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>__weak å˜é‡æœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯å®ƒä¸ä¼šå½±å“æ‰€æŒ‡å‘å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ,å› æ­¤å¯ä»¥ä½¿ç”¨å®ƒæ¥ç”Ÿæˆä¸€ä¸ªå¯¹è‡ªèº«å¯¹è±¡çš„å¼±å¼•ç”¨. åº”è¯¥æ²¡æœ‰äººçš„é¡¹ç›®ç°åœ¨è¿˜ä¸æ”¯æŒ ARC, å¦‚æœæœ‰, é‚£å¯ä»¥ä½¿ç”¨ __block æ¥æ‰“ç ´å¾ªç¯. é‚£ä¹ˆ__block typeof(self) weakSelf = self å°±è¡¨ç¤º Block åˆ«å†å¯¹ self å¯¹è±¡ retain å•¦,è¿™å°±æ‰“ç ´äº†å¾ªç¯å¼•ç”¨.</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2014/07/28/Objective-C_Block/#disqus_thread</comments>
    </item>
    
    <item>
      <title><![CDATA[ç”¨ GitHub & Hexo åœ¨ Mac ä¸Šæ­å»ºåšå®¢]]></title>
      <link>http://broccolii.github.io/2014/07/08/GitHub_Hexo-Blog/</link>
      <guid>http://broccolii.github.io/2014/07/08/GitHub_Hexo-Blog/</guid>
      <pubDate>Tue, 08 Jul 2014 15:22:12 GMT</pubDate>
      <description>
      <![CDATA[<p>æƒ³æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢æ¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´,å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜,åˆ†äº«ä¸€ä¸‹å°ç»éªŒ.è¿™ç¯‡æ–‡ç« ä½œä¸º blog çš„ç¬¬ä¸€ç¯‡,åˆ†äº«ä¸€ä¸‹å¦‚ä½•åŸºäº <a href="https://github.com" target="_blank" rel="external">GitHub</a> å’Œ]]>
      </description>
      <content:encoded><![CDATA[<p>æƒ³æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢æ¥è®°å½•ä¸€ä¸‹è‡ªå·±å­¦ä¹ çš„ç‚¹æ»´,å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜,åˆ†äº«ä¸€ä¸‹å°ç»éªŒ.è¿™ç¯‡æ–‡ç« ä½œä¸º blog çš„ç¬¬ä¸€ç¯‡,åˆ†äº«ä¸€ä¸‹å¦‚ä½•åŸºäº <a href="https://github.com" target="_blank" rel="external">GitHub</a> å’Œ <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a> åœ¨ Mac ä¸‹æ­å»ºå±äºè‡ªå·±çš„åšå®¢.</p>
<h3 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h3><p>åœ¨æ­å»ºä¹‹å‰ä½ éœ€è¦ä¸€ä¸ª <a href="https://github.com" target="_blank" rel="external">GitHub</a> è´¦å·,å› ä¸º blog çš„æ–‡ä»¶éƒ½æ˜¯æ‰˜ç®¡åœ¨ GitHub ä¸Šçš„.ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªä»“åº“ <code>+ New repository</code>,åç§°ä¸º <code>GitHubç”¨æˆ·å.github.io</code></p>
<h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå¤šæ¬¡ä½¿ç”¨åˆ° <a href="http://brew.sh" target="_blank" rel="external">homebrew</a></p>
<p>å®‰è£… <code>Homebrew</code> ç›´æ¥ä½¿ç”¨ Mac è‡ªå¸¦çš„ <code>ruby</code> è„šæœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby <span class="operator">-e</span> <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure>
<h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><p>æˆ‘ä»¬éœ€è¦å®‰è£… <code>Git</code> ç”¨æ¥æäº¤æœ¬åœ°æ–‡ä»¶åˆ° GitHub çš„ä»“åº“ä¸­</p>
<p>æ¨èä½¿ç”¨ <a href="http://brew.sh" target="_blank" rel="external">homebrew</a> æ¥å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install git</span><br></pre></td></tr></table></figure>
<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>å› ä¸º <code>Hexo</code> æ˜¯åŸºäº <code>Node.js</code> çš„ï¼Œæ‰€ä»¥å¿…é¡»å®‰è£… <code>Node.js</code> </p>
<p>ç»§ç»­æ¨èä½¿ç”¨ <a href="http://brew.sh" target="_blank" rel="external">homebrew</a> æ¥å®‰è£…</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install <span class="keyword">node</span><span class="identifier"></span><span class="title"></span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å› ä¸ºå„ç§åŸå› å®‰è£…å¤±è´¥,åˆæ‰¾ä¸åˆ°è§£å†³åŠæ³•.å¯ä»¥è¯•ä¸€ä¸‹ç›´æ¥ä¸‹è½½å®‰è£…åŒ….<a href="https://nodejs.org/en/" target="_blank" rel="external">Node.js</a>å®˜ç½‘ä¸‹è½½ <code>.pkg</code> å®‰è£…åŒ…,åŒå‡»å®‰è£….</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¾“å‡ºç‰ˆæœ¬å·æ¥éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">node</span><span class="identifier"> </span><span class="title">-v</span></span><br><span class="line">$ npm -v</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h1><h4 id="Hexo__u5B89_u88C5"><a href="#Hexo__u5B89_u88C5" class="headerlink" title="Hexo å®‰è£…"></a>Hexo å®‰è£…</h4><p><code>Hexo</code> æ˜¯åŸºäº <code>Node.js</code> å®ç°çš„ä¸€æ¬¾å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶.</p>
<p>ç›´æ¥ä½¿ç”¨ <code>Node.js</code> è‡ªå¸¦çš„åŒ…ç®¡ç†å·¥å…· <code>npm</code> è¿›è¡Œå®‰è£…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> hexo-cli</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå› ä¸ºæƒé™é—®é¢˜å¯ä»¥ä½¿ç”¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm <span class="operator"><span class="keyword">install</span> -<span class="keyword">g</span> hexo-cli</span></span><br></pre></td></tr></table></figure>
<h4 id="Hexo__u8BBE_u7F6E"><a href="#Hexo__u8BBE_u7F6E" class="headerlink" title="Hexo è®¾ç½®"></a>Hexo è®¾ç½®</h4><p>ä»¥ä¸‹æ“ä½œéœ€è¦åœ¨ä½ å¸Œæœ› blog ç”Ÿæˆçš„è·¯å¾„ä¸‹è¿›è¡Œ<br>1.æ–°å»ºåšå®¢ç›®å½• </p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>hexo init <span class="variable">$&#123;</span>blog çš„æœ¬åœ°ç›®å½•å&#125;</span><br></pre></td></tr></table></figure>
<p>2.æ ¹æ®å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç”Ÿæˆé™æ€ç½‘é¡µ</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>hexo generate</span><br></pre></td></tr></table></figure>
<p>3.åˆå§‹åŒ–ä¾èµ–</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure>
<p>4.å¯åŠ¨æœåŠ¡</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo <span class="keyword">server</span></span><br></pre></td></tr></table></figure>
<p>æ“ä½œåˆ°è¿™é‡Œæ—¶,å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ <a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> çœ‹åˆ°ç”Ÿæˆçš„å¥½çš„ blog</p>
<h4 id="u6258_u7BA1_u5230_GitHub__u4E0A"><a href="#u6258_u7BA1_u5230_GitHub__u4E0A" class="headerlink" title="æ‰˜ç®¡åˆ° GitHub ä¸Š"></a>æ‰˜ç®¡åˆ° GitHub ä¸Š</h4><p>æ‰“å¼€ <code>_config.yml</code>, é…ç½® <code>GitHub</code> ä¿¡æ¯ PS: yml æ˜¯æœ‰ä¸¥æ ¼çš„æ ¼å¼è¦æ±‚,æ‰€ä»¥ä¸€å®šè¦ä¸¤ä¸ªç©ºæ ¼å“¦~</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="comment">#éƒ¨ç½²ç±»å‹, æœ¬æ–‡ä½¿ç”¨Github</span></span><br><span class="line">  <span class="operator">type</span>: git    		</span><br><span class="line">  <span class="comment">#éƒ¨ç½²çš„ä»“åº“çš„é“¾æ¥         </span></span><br><span class="line">  repository: <span class="tag">&lt;GitHubç”¨æˆ·å.github.io è¿™ä¸ªä»“åº“æ‰€åœ¨çš„è·¯å¾„&gt;</span>.git</span><br><span class="line">  <span class="comment">#éƒ¨ç½²åˆ†æ”¯,ä¸€èˆ¬ä½¿ç”¨masterä¸»åˆ†æ”¯      </span></span><br><span class="line">  branch: <span class="literal">master</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨å‘½ä»¤:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>hexo deploy</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰§è¡Œ hexo deploy å,å‡ºç° error deployer not found:git çš„é”™è¯¯å¤„ç†</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="operator"><span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span></span><br></pre></td></tr></table></figure>
<p>å°†ç½‘é¡µå‘å¸ƒåˆ° GitHub ä¸Š,ç„¶åå¯ä»¥åœ¨ <a href="http://GitHubç”¨æˆ·å.github.io" target="_blank" rel="external">http://GitHubç”¨æˆ·å.github.io</a> çœ‹åˆ°å‘å¸ƒæˆåŠŸçš„ Blog</p>
]]></content:encoded>
      <comments>http://broccolii.github.io/2014/07/08/GitHub_Hexo-Blog/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
